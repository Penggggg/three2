"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var delayeringGood = function (x) {
    var stock = x.stock;
    var price = x.price;
    var priceGap = 0;
    if (x.standards.length === 0) {
        stock = x.stock;
        price = x.price;
    }
    else if (x.standards.length === 1) {
        stock = x.standards[0].stock;
        price = x.standards[0].price;
    }
    else if (x.standards.length > 1) {
        var sortedPrice = x.standards.sort(function (x, y) { return x.price - y.price; });
        if (sortedPrice[0].price === sortedPrice[sortedPrice.length - 1].price) {
            price = sortedPrice[0].price;
        }
        else {
            price = sortedPrice[0].price + "~" + sortedPrice[sortedPrice.length - 1].price;
        }
        var sortedStock = x.standards.filter(function (i) { return i.stock !== undefined && i.stock !== null; }).sort(function (x, y) { return x.stock - y.stock; });
        if (sortedStock.length === 1) {
            stock = "" + sortedStock[0].stock;
        }
        else if (sortedStock.length > 1) {
            if (sortedStock[0].stock === sortedStock[sortedStock.length - 1].stock) {
                stock = "" + sortedStock[0].stock;
            }
            else {
                stock = sortedStock[0].stock + "~" + sortedStock[sortedStock.length - 1].stock;
            }
        }
    }
    if (x.standards.length === 0) {
        if (x.groupPrice !== null && x.groupPrice !== undefined) {
            priceGap = x.price - x.groupPrice;
        }
        else {
            priceGap = 0;
        }
    }
    else {
        var groupPrice = x.standards.filter(function (x) { return x.groupPrice !== null && x.groupPrice !== undefined; });
        if (groupPrice.length > 0) {
            var sortedGroupPrice = groupPrice.sort(function (x, y) { return ((x.groupPrice - x.price) - (y.groupPrice - y.price)); });
            if ((sortedGroupPrice[0].groupPrice - sortedGroupPrice[0].price) ===
                (sortedGroupPrice[sortedGroupPrice.length - 1].groupPrice - sortedGroupPrice[sortedGroupPrice.length - 1].price)) {
                priceGap = (sortedGroupPrice[0].price - sortedGroupPrice[0].groupPrice);
            }
            else {
                priceGap = sortedGroupPrice[sortedGroupPrice.length - 1].price - sortedGroupPrice[sortedGroupPrice.length - 1].groupPrice + "~" + (sortedGroupPrice[0].price - sortedGroupPrice[0].groupPrice);
            }
        }
        else {
            priceGap = 0;
        }
    }
    return Object.assign({}, x, {
        stock$: stock,
        price$: price,
        priceGap: price
    });
};
exports.delayeringGood = delayeringGood;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnb29kcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBLElBQU0sY0FBYyxHQUFHLFVBQUEsQ0FBQztJQUdwQixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBQ3BCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDcEIsSUFBSSxRQUFRLEdBQVEsQ0FBQyxDQUFDO0lBR3RCLElBQUssQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFHO1FBQzVCLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ2hCLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO0tBR25CO1NBQU0sSUFBSyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUc7UUFDbkMsS0FBSyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUUsQ0FBQyxDQUFFLENBQUMsS0FBSyxDQUFDO1FBQy9CLEtBQUssR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFFLENBQUMsQ0FBRSxDQUFDLEtBQUssQ0FBQztLQUdsQztTQUFPLElBQUssQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFHO1FBR2xDLElBQU0sV0FBVyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBTSxPQUFBLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBakIsQ0FBaUIsQ0FBRSxDQUFDO1FBQ3JFLElBQUssV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxXQUFXLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUUsQ0FBQyxLQUFLLEVBQUc7WUFDdkUsS0FBSyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7U0FDaEM7YUFBTTtZQUNI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LENBQUMsS0FBSyxHQUFHLGdCQUFnQixDQUFFLGdCQUFnQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUUsQ0FBQyxVQUFVLFVBQUksZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBRSxDQUFDO2FBQ3BNO1NBQ0o7YUFBTTtZQUNILFFBQVEsR0FBRyxDQUFDLENBQUM7U0FDaEI7S0FDSjtJQUVELE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFHLEVBQUUsQ0FBQyxFQUFFO1FBQ3pCLE1BQU0sRUFBRSxLQUFLO1FBQ2IsTUFBTSxFQUFFLEtBQUs7UUFDYixRQUFRLEVBQUUsS0FBSztLQUNsQixDQUFDLENBQUE7QUFFTixDQUFDLENBQUM7QUFHRSx3Q0FBYyIsInNvdXJjZXNDb250ZW50IjpbIlxuLyoqIFxuICog5ZWG5ZOBIO+9niDovazmiYHlubPljJbku7fmoLzjgIHlupPlrZjjgIHlt67ku7dcbiAqICEg5beu5Lu35o6S5bqP6K6h566X5pyJ6Zeu6aKY77yM5rKh5pyJ5qC55o2u5beu5Lu35o6S5bqPXG4gKi9cbmNvbnN0IGRlbGF5ZXJpbmdHb29kID0geCA9PiB7XG4gICAgXG4gICAgLy8g6K6+572u5Z6L5Y+344CB5bqT5a2Y55qE5Lu35qC8XG4gICAgbGV0IHN0b2NrID0geC5zdG9jaztcbiAgICBsZXQgcHJpY2UgPSB4LnByaWNlO1xuICAgIGxldCBwcmljZUdhcDogYW55ID0gMDtcblxuICAgIC8vIOayoeacieWei+WPt1xuICAgIGlmICggeC5zdGFuZGFyZHMubGVuZ3RoID09PSAwICkge1xuICAgICAgICBzdG9jayA9IHguc3RvY2s7XG4gICAgICAgIHByaWNlID0geC5wcmljZTtcblxuICAgIC8vIOWei+WPt+WPquaciTHnp41cbiAgICB9IGVsc2UgaWYgKCB4LnN0YW5kYXJkcy5sZW5ndGggPT09IDEgKSB7XG4gICAgICAgIHN0b2NrID0geC5zdGFuZGFyZHNbIDAgXS5zdG9jaztcbiAgICAgICAgcHJpY2UgPSB4LnN0YW5kYXJkc1sgMCBdLnByaWNlO1xuICAgIFxuICAgIC8vIOWei+WPt+Wkp+S6jjHnp41cbiAgICB9ICBlbHNlIGlmICggeC5zdGFuZGFyZHMubGVuZ3RoID4gMSApIHtcblxuICAgICAgICAvLyDlpITnkIbku7fmoLxcbiAgICAgICAgY29uc3Qgc29ydGVkUHJpY2UgPSB4LnN0YW5kYXJkcy5zb3J0KCggeCwgeSApID0+IHgucHJpY2UgLSB5LnByaWNlICk7XG4gICAgICAgIGlmICggc29ydGVkUHJpY2VbMF0ucHJpY2UgPT09IHNvcnRlZFByaWNlW3NvcnRlZFByaWNlLmxlbmd0aCAtIDEgXS5wcmljZSApIHtcbiAgICAgICAgICAgIHByaWNlID0gc29ydGVkUHJpY2VbMF0ucHJpY2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcmljZSA9IGAke3NvcnRlZFByaWNlWzBdLnByaWNlfX4ke3NvcnRlZFByaWNlW3NvcnRlZFByaWNlLmxlbmd0aCAtIDEgXS5wcmljZX1gO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyDlpITnkIbotKflrZhcbiAgICAgICAgY29uc3Qgc29ydGVkU3RvY2sgPSB4LnN0YW5kYXJkcy5maWx0ZXIoaSA9PiBpLnN0b2NrICE9PSB1bmRlZmluZWQgJiYgaS5zdG9jayAhPT0gbnVsbCkuc29ydCgoeCwgeSkgPT4geC5zdG9jayAtIHkuc3RvY2spO1xuICAgICAgICAvLyDmnInlupPlrZjlnovlj7dcbiAgICAgICAgaWYgKCBzb3J0ZWRTdG9jay5sZW5ndGggPT09IDEgKSB7XG4gICAgICAgICAgICBzdG9jayA9IGAke3NvcnRlZFN0b2NrWzBdLnN0b2NrfWA7XG4gICAgICAgIH0gZWxzZSBpZiAoIHNvcnRlZFN0b2NrLmxlbmd0aCA+IDEgKSB7XG4gICAgICAgICAgaWYgKCBzb3J0ZWRTdG9ja1swXS5zdG9jayA9PT0gc29ydGVkU3RvY2tbc29ydGVkU3RvY2subGVuZ3RoIC0gMV0uc3RvY2sgKSB7XG4gICAgICAgICAgICAgIHN0b2NrID0gYCR7c29ydGVkU3RvY2tbMF0uc3RvY2t9YDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBzdG9jayA9IGAke3NvcnRlZFN0b2NrWzBdLnN0b2NrfX4ke3NvcnRlZFN0b2NrW3NvcnRlZFN0b2NrLmxlbmd0aCAtIDFdLnN0b2NrfWA7XG4gICAgICAgICAgfVxuICAgICAgICB9ICAgICAgICAgICAgXG4gICAgfVxuXG4gICAgaWYgKCB4LnN0YW5kYXJkcy5sZW5ndGggPT09IDAgKSB7XG4gICAgICAgIC8vIOacieWboui0reeahFxuICAgICAgICBpZiAoIHguZ3JvdXBQcmljZSAhPT0gbnVsbCAmJiB4Lmdyb3VwUHJpY2UgIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICBwcmljZUdhcCA9IHgucHJpY2UgLSB4Lmdyb3VwUHJpY2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcmljZUdhcCA9IDA7XG4gICAgICAgIH1cbiAgICAvLyDmnInlnovlj7dcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBncm91cFByaWNlID0geC5zdGFuZGFyZHMuZmlsdGVyKCB4ID0+IHguZ3JvdXBQcmljZSAhPT0gbnVsbCAmJiB4Lmdyb3VwUHJpY2UgIT09IHVuZGVmaW5lZCApO1xuICAgICAgICAvLyDlnovlj7fph4zpnaLmnInlm6LotK3nmoRcbiAgICAgICAgaWYgKCBncm91cFByaWNlLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICBjb25zdCBzb3J0ZWRHcm91cFByaWNlID0gZ3JvdXBQcmljZS5zb3J0KCggeCwgeSApID0+ICgoIHguZ3JvdXBQcmljZSAtIHgucHJpY2UgKSAtICggeS5ncm91cFByaWNlIC0geS5wcmljZSApKSk7XG4gICAgICAgICAgICBpZiAoKCBzb3J0ZWRHcm91cFByaWNlWzBdLmdyb3VwUHJpY2UgLSBzb3J0ZWRHcm91cFByaWNlWzBdLnByaWNlICkgPT09XG4gICAgICAgICAgICAgICAgKCBzb3J0ZWRHcm91cFByaWNlWyBzb3J0ZWRHcm91cFByaWNlLmxlbmd0aCAtIDEgXS5ncm91cFByaWNlIC0gc29ydGVkR3JvdXBQcmljZVsgc29ydGVkR3JvdXBQcmljZS5sZW5ndGggLSAxIF0ucHJpY2UgKSkge1xuICAgICAgICAgICAgICAgIHByaWNlR2FwID0gKCBzb3J0ZWRHcm91cFByaWNlWzBdLnByaWNlIC0gc29ydGVkR3JvdXBQcmljZVswXS5ncm91cFByaWNlICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHByaWNlR2FwID0gYCR7c29ydGVkR3JvdXBQcmljZVsgc29ydGVkR3JvdXBQcmljZS5sZW5ndGggLSAxIF0ucHJpY2UgLSBzb3J0ZWRHcm91cFByaWNlWyBzb3J0ZWRHcm91cFByaWNlLmxlbmd0aCAtIDEgXS5ncm91cFByaWNlfX4ke3NvcnRlZEdyb3VwUHJpY2VbMF0ucHJpY2UgLSBzb3J0ZWRHcm91cFByaWNlWzBdLmdyb3VwUHJpY2V9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHByaWNlR2FwID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHsgfSwgeCwge1xuICAgICAgICBzdG9jayQ6IHN0b2NrLFxuICAgICAgICBwcmljZSQ6IHByaWNlLFxuICAgICAgICBwcmljZUdhcDogcHJpY2VcbiAgICB9KVxuXG59O1xuXG5leHBvcnQge1xuICAgIGRlbGF5ZXJpbmdHb29kXG59Il19