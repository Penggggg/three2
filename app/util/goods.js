"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var delayeringGood = function (x) {
    if (!x) {
        return null;
    }
    var stock = x.stock;
    var price = x.price;
    var priceGap = 0;
    if (x.standards.length === 0) {
        stock = x.stock;
        price = x.price;
    }
    else if (x.standards.length === 1) {
        stock = x.standards[0].stock;
        price = x.standards[0].price;
    }
    else if (x.standards.length > 1) {
        var sortedPrice = x.standards.sort(function (x, y) { return x.price - y.price; });
        if (sortedPrice[0].price === sortedPrice[sortedPrice.length - 1].price) {
            price = sortedPrice[0].price;
        }
        else {
            price = sortedPrice[0].price + "~" + sortedPrice[sortedPrice.length - 1].price;
        }
        var sortedStock = x.standards.filter(function (i) { return i.stock !== undefined && i.stock !== null; }).sort(function (x, y) { return x.stock - y.stock; });
        if (sortedStock.length === 1) {
            stock = "" + sortedStock[0].stock;
        }
        else if (sortedStock.length > 1) {
            if (sortedStock[0].stock === sortedStock[sortedStock.length - 1].stock) {
                stock = "" + sortedStock[0].stock;
            }
            else {
                stock = sortedStock[0].stock + "~" + sortedStock[sortedStock.length - 1].stock;
            }
        }
    }
    if (x.standards.length === 0) {
        if (x.groupPrice !== null && x.groupPrice !== undefined) {
            priceGap = x.price - x.groupPrice;
        }
        else {
            priceGap = 0;
        }
    }
    else {
        var groupPrice = x.standards.filter(function (x) { return x.groupPrice !== null && x.groupPrice !== undefined; });
        if (groupPrice.length > 0) {
            var sortedGroupPrice = groupPrice.sort(function (x, y) { return ((x.groupPrice - x.price) - (y.groupPrice - y.price)); });
            if ((sortedGroupPrice[0].groupPrice - sortedGroupPrice[0].price) ===
                (sortedGroupPrice[sortedGroupPrice.length - 1].groupPrice - sortedGroupPrice[sortedGroupPrice.length - 1].price)) {
                priceGap = (sortedGroupPrice[0].price - sortedGroupPrice[0].groupPrice);
            }
            else {
                priceGap = sortedGroupPrice[sortedGroupPrice.length - 1].price - sortedGroupPrice[sortedGroupPrice.length - 1].groupPrice + "~" + (sortedGroupPrice[0].price - sortedGroupPrice[0].groupPrice);
            }
        }
        else {
            priceGap = 0;
        }
    }
    return Object.assign({}, x, {
        stock$: stock,
        price$: price,
        priceGap: price
    });
};
exports.delayeringGood = delayeringGood;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnb29kcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBLElBQU0sY0FBYyxHQUFHLFVBQUEsQ0FBQztJQUVwQixJQUFLLENBQUMsQ0FBQyxFQUFHO1FBQ04sT0FBTyxJQUFJLENBQUE7S0FDZDtJQUdELElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDcEIsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUNwQixJQUFJLFFBQVEsR0FBUSxDQUFDLENBQUM7SUFHdEIsSUFBSyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUc7UUFDNUIsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDaEIsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7S0FHbkI7U0FBTSxJQUFLLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRztRQUNuQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBRSxDQUFDLENBQUUsQ0FBQyxLQUFLLENBQUM7UUFDL0IsS0FBSyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUUsQ0FBQyxDQUFFLENBQUMsS0FBSyxDQUFDO0tBR2xDO1NBQU8sSUFBSyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUc7UUFHbEMsSUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFNLE9BQUEsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFqQixDQUFpQixDQUFFLENBQUM7UUFDckUsSUFBSyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLFdBQVcsQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBRSxDQUFDLEtBQUssRUFBRztZQUN2RSxLQUFLLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztTQUNoQzthQUFNO1lBQ0gsS0FBSyxHQUFNLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQUksV0FBVyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFFLENBQUMsS0FBTyxDQUFDO1NBQ25GO1FBR0QsSUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsS0FBSyxLQUFLLFNBQVMsSUFBSSxDQUFDLENBQUMsS0FBSyxLQUFLLElBQUksRUFBekMsQ0FBeUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQWpCLENBQWlCLENBQUMsQ0FBQztRQUV6SCxJQUFLLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFHO1lBQzVCLEtBQUssR0FBRyxLQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFPLENBQUM7U0FDckM7YUFBTSxJQUFLLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFHO1lBQ25DLElBQUssV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxXQUFXLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUc7Z0JBQ3RFLEtBQUssR0FBRyxLQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFPLENBQUM7YUFDckM7aUJBQU07Z0JBQ0gsS0FBSyxHQUFNLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQUksV0FBVyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBTyxDQUFDO2FBQ2xGO1NBQ0Y7S0FDSjtJQUVELElBQUssQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFHO1FBRTVCLElBQUssQ0FBQyxDQUFDLFVBQVUsS0FBSyxJQUFJLElBQUksQ0FBQyxDQUFDLFVBQVUsS0FBSyxTQUFTLEVBQUc7WUFDdEQsUUFBUSxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLFVBQVUsQ0FBQztTQUN0QzthQUFNO1lBQ0gsUUFBUSxHQUFHLENBQUMsQ0FBQztTQUNoQjtLQUVKO1NBQU07UUFDSCxJQUFNLFVBQVUsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBRSxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxVQUFVLEtBQUssSUFBSSxJQUFJLENBQUMsQ0FBQyxVQUFVLEtBQUssU0FBUyxFQUFuRCxDQUFtRCxDQUFFLENBQUM7UUFFbEcsSUFBSyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRztZQUN6QixJQUFNLGdCQUFnQixHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFNLE9BQUEsQ0FBQyxDQUFFLENBQUMsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBRSxHQUFHLENBQUUsQ0FBQyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFFLENBQUMsRUFBekQsQ0FBeUQsQ0FBQyxDQUFDO1lBQ2hILElBQUksQ0FBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFFO2dCQUM5RCxDQUFFLGdCQUFnQixDQUFFLGdCQUFnQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUUsQ0FBQyxVQUFVLEdBQUcsZ0JBQWdCLENBQUUsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBRSxDQUFDLEtBQUssQ0FBRSxFQUFFO2dCQUN4SCxRQUFRLEdBQUcsQ0FBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFFLENBQUM7YUFDN0U7aUJBQU07Z0JBQ0gsUUFBUSxHQUFNLGdCQUFnQixDQUFFLGdCQUFnQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUUsQ0FBQyxLQUFLLEdBQUcsZ0JBQWdCLENBQUUsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBRSxDQUFDLFVBQVUsVUFBSSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFFLENBQUM7YUFDcE07U0FDSjthQUFNO1lBQ0gsUUFBUSxHQUFHLENBQUMsQ0FBQztTQUNoQjtLQUNKO0lBRUQsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUcsRUFBRSxDQUFDLEVBQUU7UUFDekIsTUFBTSxFQUFFLEtBQUs7UUFDYixNQUFNLEVBQUUsS0FBSztRQUNiLFFBQVEsRUFBRSxLQUFLO0tBQ2xCLENBQUMsQ0FBQTtBQUVOLENBQUMsQ0FBQztBQUdFLHdDQUFjIiwic291cmNlc0NvbnRlbnQiOlsiXG4vKiogXG4gKiDllYblk4Eg772eIOi9rOaJgeW5s+WMluS7t+agvOOAgeW6k+WtmOOAgeW3ruS7t1xuICogISDlt67ku7fmjpLluo/orqHnrpfmnInpl67popjvvIzmsqHmnInmoLnmja7lt67ku7fmjpLluo9cbiAqL1xuY29uc3QgZGVsYXllcmluZ0dvb2QgPSB4ID0+IHtcblxuICAgIGlmICggIXggKSB7XG4gICAgICAgIHJldHVybiBudWxsXG4gICAgfVxuICAgIFxuICAgIC8vIOiuvue9ruWei+WPt+OAgeW6k+WtmOeahOS7t+agvFxuICAgIGxldCBzdG9jayA9IHguc3RvY2s7XG4gICAgbGV0IHByaWNlID0geC5wcmljZTtcbiAgICBsZXQgcHJpY2VHYXA6IGFueSA9IDA7XG5cbiAgICAvLyDmsqHmnInlnovlj7dcbiAgICBpZiAoIHguc3RhbmRhcmRzLmxlbmd0aCA9PT0gMCApIHtcbiAgICAgICAgc3RvY2sgPSB4LnN0b2NrO1xuICAgICAgICBwcmljZSA9IHgucHJpY2U7XG5cbiAgICAvLyDlnovlj7flj6rmnIkx56eNXG4gICAgfSBlbHNlIGlmICggeC5zdGFuZGFyZHMubGVuZ3RoID09PSAxICkge1xuICAgICAgICBzdG9jayA9IHguc3RhbmRhcmRzWyAwIF0uc3RvY2s7XG4gICAgICAgIHByaWNlID0geC5zdGFuZGFyZHNbIDAgXS5wcmljZTtcbiAgICBcbiAgICAvLyDlnovlj7flpKfkuo4x56eNXG4gICAgfSAgZWxzZSBpZiAoIHguc3RhbmRhcmRzLmxlbmd0aCA+IDEgKSB7XG5cbiAgICAgICAgLy8g5aSE55CG5Lu35qC8XG4gICAgICAgIGNvbnN0IHNvcnRlZFByaWNlID0geC5zdGFuZGFyZHMuc29ydCgoIHgsIHkgKSA9PiB4LnByaWNlIC0geS5wcmljZSApO1xuICAgICAgICBpZiAoIHNvcnRlZFByaWNlWzBdLnByaWNlID09PSBzb3J0ZWRQcmljZVtzb3J0ZWRQcmljZS5sZW5ndGggLSAxIF0ucHJpY2UgKSB7XG4gICAgICAgICAgICBwcmljZSA9IHNvcnRlZFByaWNlWzBdLnByaWNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcHJpY2UgPSBgJHtzb3J0ZWRQcmljZVswXS5wcmljZX1+JHtzb3J0ZWRQcmljZVtzb3J0ZWRQcmljZS5sZW5ndGggLSAxIF0ucHJpY2V9YDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8g5aSE55CG6LSn5a2YXG4gICAgICAgIGNvbnN0IHNvcnRlZFN0b2NrID0geC5zdGFuZGFyZHMuZmlsdGVyKGkgPT4gaS5zdG9jayAhPT0gdW5kZWZpbmVkICYmIGkuc3RvY2sgIT09IG51bGwpLnNvcnQoKHgsIHkpID0+IHguc3RvY2sgLSB5LnN0b2NrKTtcbiAgICAgICAgLy8g5pyJ5bqT5a2Y5Z6L5Y+3XG4gICAgICAgIGlmICggc29ydGVkU3RvY2subGVuZ3RoID09PSAxICkge1xuICAgICAgICAgICAgc3RvY2sgPSBgJHtzb3J0ZWRTdG9ja1swXS5zdG9ja31gO1xuICAgICAgICB9IGVsc2UgaWYgKCBzb3J0ZWRTdG9jay5sZW5ndGggPiAxICkge1xuICAgICAgICAgIGlmICggc29ydGVkU3RvY2tbMF0uc3RvY2sgPT09IHNvcnRlZFN0b2NrW3NvcnRlZFN0b2NrLmxlbmd0aCAtIDFdLnN0b2NrICkge1xuICAgICAgICAgICAgICBzdG9jayA9IGAke3NvcnRlZFN0b2NrWzBdLnN0b2NrfWA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgc3RvY2sgPSBgJHtzb3J0ZWRTdG9ja1swXS5zdG9ja31+JHtzb3J0ZWRTdG9ja1tzb3J0ZWRTdG9jay5sZW5ndGggLSAxXS5zdG9ja31gO1xuICAgICAgICAgIH1cbiAgICAgICAgfSAgICAgICAgICAgIFxuICAgIH1cblxuICAgIGlmICggeC5zdGFuZGFyZHMubGVuZ3RoID09PSAwICkge1xuICAgICAgICAvLyDmnInlm6LotK3nmoRcbiAgICAgICAgaWYgKCB4Lmdyb3VwUHJpY2UgIT09IG51bGwgJiYgeC5ncm91cFByaWNlICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgcHJpY2VHYXAgPSB4LnByaWNlIC0geC5ncm91cFByaWNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcHJpY2VHYXAgPSAwO1xuICAgICAgICB9XG4gICAgLy8g5pyJ5Z6L5Y+3XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZ3JvdXBQcmljZSA9IHguc3RhbmRhcmRzLmZpbHRlciggeCA9PiB4Lmdyb3VwUHJpY2UgIT09IG51bGwgJiYgeC5ncm91cFByaWNlICE9PSB1bmRlZmluZWQgKTtcbiAgICAgICAgLy8g5Z6L5Y+36YeM6Z2i5pyJ5Zui6LSt55qEXG4gICAgICAgIGlmICggZ3JvdXBQcmljZS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgY29uc3Qgc29ydGVkR3JvdXBQcmljZSA9IGdyb3VwUHJpY2Uuc29ydCgoIHgsIHkgKSA9PiAoKCB4Lmdyb3VwUHJpY2UgLSB4LnByaWNlICkgLSAoIHkuZ3JvdXBQcmljZSAtIHkucHJpY2UgKSkpO1xuICAgICAgICAgICAgaWYgKCggc29ydGVkR3JvdXBQcmljZVswXS5ncm91cFByaWNlIC0gc29ydGVkR3JvdXBQcmljZVswXS5wcmljZSApID09PVxuICAgICAgICAgICAgICAgICggc29ydGVkR3JvdXBQcmljZVsgc29ydGVkR3JvdXBQcmljZS5sZW5ndGggLSAxIF0uZ3JvdXBQcmljZSAtIHNvcnRlZEdyb3VwUHJpY2VbIHNvcnRlZEdyb3VwUHJpY2UubGVuZ3RoIC0gMSBdLnByaWNlICkpIHtcbiAgICAgICAgICAgICAgICBwcmljZUdhcCA9ICggc29ydGVkR3JvdXBQcmljZVswXS5wcmljZSAtIHNvcnRlZEdyb3VwUHJpY2VbMF0uZ3JvdXBQcmljZSApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwcmljZUdhcCA9IGAke3NvcnRlZEdyb3VwUHJpY2VbIHNvcnRlZEdyb3VwUHJpY2UubGVuZ3RoIC0gMSBdLnByaWNlIC0gc29ydGVkR3JvdXBQcmljZVsgc29ydGVkR3JvdXBQcmljZS5sZW5ndGggLSAxIF0uZ3JvdXBQcmljZX1+JHtzb3J0ZWRHcm91cFByaWNlWzBdLnByaWNlIC0gc29ydGVkR3JvdXBQcmljZVswXS5ncm91cFByaWNlfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcmljZUdhcCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7IH0sIHgsIHtcbiAgICAgICAgc3RvY2skOiBzdG9jayxcbiAgICAgICAgcHJpY2UkOiBwcmljZSxcbiAgICAgICAgcHJpY2VHYXA6IHByaWNlXG4gICAgfSlcblxufTtcblxuZXhwb3J0IHtcbiAgICBkZWxheWVyaW5nR29vZFxufSJdfQ==