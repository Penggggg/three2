"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var delayeringGood = function (x) {
    if (!x) {
        return null;
    }
    var stock = x.stock;
    var price = x.price;
    var priceGap = 0;
    var lowest_price = x.groupPrice || x.price;
    if (x.standards.length === 0) {
        stock = x.stock;
        price = x.price;
    }
    else if (x.standards.length === 1) {
        stock = x.standards[0].stock;
        price = x.standards[0].price;
        if (!x.standards[0].groupPrice) {
            lowest_price = lowest_price < x.standards[0].price ?
                lowest_price :
                x.standards[0].price;
        }
        else {
            lowest_price = lowest_price < x.standards[0].groupPrice ?
                lowest_price :
                x.standards[0].groupPrice;
        }
    }
    else if (x.standards.length > 1) {
        var sortedPrice = x.standards.sort(function (x, y) { return x.price - y.price; });
        if (sortedPrice[0].price === sortedPrice[sortedPrice.length - 1].price) {
            price = sortedPrice[0].price;
        }
        else {
            price = sortedPrice[0].price + "~" + sortedPrice[sortedPrice.length - 1].price;
        }
        var sortedStock = x.standards.filter(function (i) { return i.stock !== undefined && i.stock !== null; }).sort(function (x, y) { return x.stock - y.stock; });
        if (sortedStock.length === 1) {
            stock = "" + sortedStock[0].stock;
        }
        else if (sortedStock.length > 1) {
            if (sortedStock[0].stock === sortedStock[sortedStock.length - 1].stock) {
                stock = "" + sortedStock[0].stock;
            }
            else {
                stock = sortedStock[0].stock + "~" + sortedStock[sortedStock.length - 1].stock;
            }
        }
        var priceList_1 = [];
        x.standards.map(function (s) {
            if (!s.groupPrice) {
                priceList_1.push(s.price);
            }
            else {
                priceList_1.push(s.groupPrice < s.price ?
                    s.groupPrice :
                    s.price);
            }
        });
        priceList_1 = priceList_1.sort(function (x, y) { return x - y; });
        lowest_price = priceList_1[0];
    }
    if (x.standards.length === 0) {
        if (x.groupPrice !== null && x.groupPrice !== undefined) {
            priceGap = x.price - x.groupPrice;
        }
        else {
            priceGap = 0;
        }
    }
    else {
        var groupPrice = x.standards.filter(function (x) { return x.groupPrice !== null && x.groupPrice !== undefined; });
        if (groupPrice.length > 0) {
            var sortedGroupPrice = groupPrice.sort(function (x, y) { return ((x.groupPrice - x.price) - (y.groupPrice - y.price)); });
            if ((sortedGroupPrice[0].groupPrice - sortedGroupPrice[0].price) ===
                (sortedGroupPrice[sortedGroupPrice.length - 1].groupPrice - sortedGroupPrice[sortedGroupPrice.length - 1].price)) {
                priceGap = (sortedGroupPrice[0].price - sortedGroupPrice[0].groupPrice);
            }
            else {
                priceGap = sortedGroupPrice[sortedGroupPrice.length - 1].price - sortedGroupPrice[sortedGroupPrice.length - 1].groupPrice + "~" + (sortedGroupPrice[0].price - sortedGroupPrice[0].groupPrice);
            }
        }
        else {
            priceGap = 0;
        }
    }
    return Object.assign({}, x, {
        pid: x._id,
        stock$: stock,
        price$: price,
        priceGap: priceGap,
        lowest_price$: lowest_price
    });
};
exports.delayeringGood = delayeringGood;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnb29kcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQU1BLElBQU0sY0FBYyxHQUFHLFVBQUEsQ0FBQztJQUNwQixJQUFLLENBQUMsQ0FBQyxFQUFHO1FBQ04sT0FBTyxJQUFJLENBQUE7S0FDZDtJQUdELElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDcEIsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUNwQixJQUFJLFFBQVEsR0FBUSxDQUFDLENBQUM7SUFDdEIsSUFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFDLFVBQVUsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDO0lBSTNDLElBQUssQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFHO1FBQzVCLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ2hCLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO0tBR25CO1NBQU0sSUFBSyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUc7UUFDbkMsS0FBSyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUUsQ0FBQyxDQUFFLENBQUMsS0FBSyxDQUFDO1FBQy9CLEtBQUssR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFFLENBQUMsQ0FBRSxDQUFDLEtBQUssQ0FBQztRQUcvQixJQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBRSxDQUFDLENBQUUsQ0FBQyxVQUFVLEVBQUc7WUFDaEMsWUFBWSxHQUFHLFlBQVksR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFFLENBQUMsQ0FBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNsRCxZQUFZLENBQUMsQ0FBQztnQkFDZCxDQUFDLENBQUMsU0FBUyxDQUFFLENBQUMsQ0FBRSxDQUFDLEtBQUssQ0FBQztTQUU5QjthQUFNO1lBQ0gsWUFBWSxHQUFHLFlBQVksR0FBRyxDQUFD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TTtnQkFDSCxRQUFRLEdBQU0sZ0JBQWdCLENBQUUsZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBRSxDQUFDLEtBQUssR0FBRyxnQkFBZ0IsQ0FBRSxnQkFBZ0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFFLENBQUMsVUFBVSxVQUFJLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUUsQ0FBQzthQUNwTTtTQUNKO2FBQU07WUFDSCxRQUFRLEdBQUcsQ0FBQyxDQUFDO1NBQ2hCO0tBQ0o7SUFFRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRyxFQUFFLENBQUMsRUFBRTtRQUN6QixHQUFHLEVBQUUsQ0FBQyxDQUFDLEdBQUc7UUFFVixNQUFNLEVBQUUsS0FBSztRQUViLE1BQU0sRUFBRSxLQUFLO1FBRWIsUUFBUSxVQUFBO1FBRVIsYUFBYSxFQUFFLFlBQVk7S0FDOUIsQ0FBQyxDQUFBO0FBRU4sQ0FBQyxDQUFDO0FBR0Usd0NBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8qKiBcbiAqIOWVhuWTgSDvvZ4g5Lu35qC85Yy66Ze044CB5bqT5a2Y5Yy66Ze044CB5beu5Lu344CB5pyA5L2O5Lu35qC877yI5ZCr5Zui6LSt5Lu377yJXG4gKiAhIOW3ruS7t+aOkuW6j+iuoeeul+aciemXrumimO+8jOayoeacieagueaNruW3ruS7t+aOkuW6j1xuICogISDmraTlpITpu5jorqQg5Zui6LSt5Lu35bCP5LqO5Y6f5Lu377yM5L2G5LiN5LiA5a6a5pyJ5Zui6LSt5Lu3XG4gKi9cbmNvbnN0IGRlbGF5ZXJpbmdHb29kID0geCA9PiB7XG4gICAgaWYgKCAheCApIHtcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gICAgXG4gICAgLy8g5Yid5aeL5YyWIOW6k+WtmOOAgeS7t+agvOOAgeW3ruS7t+OAgeacgOS9juS7t+agvFxuICAgIGxldCBzdG9jayA9IHguc3RvY2s7XG4gICAgbGV0IHByaWNlID0geC5wcmljZTtcbiAgICBsZXQgcHJpY2VHYXA6IGFueSA9IDA7XG4gICAgbGV0IGxvd2VzdF9wcmljZSA9IHguZ3JvdXBQcmljZSB8fCB4LnByaWNlO1xuXG4gICAgLy8g5aSE55CGIOW6k+WtmOOAgeS7t+agvOOAgeacgOS9juS7t+agvFxuICAgIC8vIOayoeacieWei+WPt1xuICAgIGlmICggeC5zdGFuZGFyZHMubGVuZ3RoID09PSAwICkge1xuICAgICAgICBzdG9jayA9IHguc3RvY2s7XG4gICAgICAgIHByaWNlID0geC5wcmljZTtcblxuICAgIC8vIOWei+WPt+WPquaciTHnp41cbiAgICB9IGVsc2UgaWYgKCB4LnN0YW5kYXJkcy5sZW5ndGggPT09IDEgKSB7XG4gICAgICAgIHN0b2NrID0geC5zdGFuZGFyZHNbIDAgXS5zdG9jaztcbiAgICAgICAgcHJpY2UgPSB4LnN0YW5kYXJkc1sgMCBdLnByaWNlO1xuICAgICAgICBcbiAgICAgICAgLy8g5Z6L5Y+35rKh5pyJ5Zui6LSt5Lu3XG4gICAgICAgIGlmICggIXguc3RhbmRhcmRzWyAwIF0uZ3JvdXBQcmljZSApIHtcbiAgICAgICAgICAgIGxvd2VzdF9wcmljZSA9IGxvd2VzdF9wcmljZSA8IHguc3RhbmRhcmRzWyAwIF0ucHJpY2UgP1xuICAgICAgICAgICAgICAgIGxvd2VzdF9wcmljZSA6XG4gICAgICAgICAgICAgICAgeC5zdGFuZGFyZHNbIDAgXS5wcmljZTtcbiAgICAgICAgLy8g5Z6L5Y+35pyJ5Zui6LSt5Lu3XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb3dlc3RfcHJpY2UgPSBsb3dlc3RfcHJpY2UgPCB4LnN0YW5kYXJkc1sgMCBdLmdyb3VwUHJpY2UgP1xuICAgICAgICAgICAgICAgIGxvd2VzdF9wcmljZSA6XG4gICAgICAgICAgICAgICAgeC5zdGFuZGFyZHNbIDAgXS5ncm91cFByaWNlO1xuICAgICAgICB9XG4gICAgXG4gICAgLy8g5Z6L5Y+35aSn5LqOMeenjVxuICAgIH0gIGVsc2UgaWYgKCB4LnN0YW5kYXJkcy5sZW5ndGggPiAxICkge1xuXG4gICAgICAgIC8vIOWkhOeQhuS7t+agvFxuICAgICAgICBjb25zdCBzb3J0ZWRQcmljZSA9IHguc3RhbmRhcmRzLnNvcnQoKCB4LCB5ICkgPT4geC5wcmljZSAtIHkucHJpY2UgKTtcbiAgICAgICAgaWYgKCBzb3J0ZWRQcmljZVswXS5wcmljZSA9PT0gc29ydGVkUHJpY2Vbc29ydGVkUHJpY2UubGVuZ3RoIC0gMSBdLnByaWNlICkge1xuICAgICAgICAgICAgcHJpY2UgPSBzb3J0ZWRQcmljZVswXS5wcmljZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHByaWNlID0gYCR7c29ydGVkUHJpY2VbMF0ucHJpY2V9fiR7c29ydGVkUHJpY2Vbc29ydGVkUHJpY2UubGVuZ3RoIC0gMSBdLnByaWNlfWA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIOWkhOeQhui0p+WtmFxuICAgICAgICBjb25zdCBzb3J0ZWRTdG9jayA9IHguc3RhbmRhcmRzLmZpbHRlcihpID0+IGkuc3RvY2sgIT09IHVuZGVmaW5lZCAmJiBpLnN0b2NrICE9PSBudWxsKS5zb3J0KCh4LCB5KSA9PiB4LnN0b2NrIC0geS5zdG9jayk7XG4gICAgICAgIC8vIOacieW6k+WtmOWei+WPt1xuICAgICAgICBpZiAoIHNvcnRlZFN0b2NrLmxlbmd0aCA9PT0gMSApIHtcbiAgICAgICAgICAgIHN0b2NrID0gYCR7c29ydGVkU3RvY2tbMF0uc3RvY2t9YDtcbiAgICAgICAgfSBlbHNlIGlmICggc29ydGVkU3RvY2subGVuZ3RoID4gMSApIHtcbiAgICAgICAgICBpZiAoIHNvcnRlZFN0b2NrWzBdLnN0b2NrID09PSBzb3J0ZWRTdG9ja1tzb3J0ZWRTdG9jay5sZW5ndGggLSAxXS5zdG9jayApIHtcbiAgICAgICAgICAgICAgc3RvY2sgPSBgJHtzb3J0ZWRTdG9ja1swXS5zdG9ja31gO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHN0b2NrID0gYCR7c29ydGVkU3RvY2tbMF0uc3RvY2t9fiR7c29ydGVkU3RvY2tbc29ydGVkU3RvY2subGVuZ3RoIC0gMV0uc3RvY2t9YDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gICAgXG4gICAgICAgIFxuICAgICAgICAvLyDmi7/liLDlnovlj7fliJfooajnmoTmnIDkvY7ku7fmoLzvvIzlkKvlm6LotK3ku7dcbiAgICAgICAgbGV0IHByaWNlTGlzdDogbnVtYmVyW10gPSBbIF07XG4gICAgICAgIHguc3RhbmRhcmRzLm1hcCggcyA9PiB7XG4gICAgICAgICAgICBpZiAoICFzLmdyb3VwUHJpY2UgKSB7XG4gICAgICAgICAgICAgICAgcHJpY2VMaXN0LnB1c2goIHMucHJpY2UgKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwcmljZUxpc3QucHVzaCggcy5ncm91cFByaWNlIDwgcy5wcmljZSA/XG4gICAgICAgICAgICAgICAgICAgIHMuZ3JvdXBQcmljZSA6XG4gICAgICAgICAgICAgICAgICAgIHMucHJpY2VcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBwcmljZUxpc3QgPSBwcmljZUxpc3Quc29ydCgoIHgsIHkgKSA9PiB4IC0geSApO1xuICAgICAgICBsb3dlc3RfcHJpY2UgPSBwcmljZUxpc3RbIDAgXTtcbiAgICAgICAgXG4gICAgfVxuXG4gICAgLy8g5aSE55CG5beu5Lu3XG4gICAgaWYgKCB4LnN0YW5kYXJkcy5sZW5ndGggPT09IDAgKSB7XG4gICAgICAgIC8vIOacieWboui0reeahFxuICAgICAgICBpZiAoIHguZ3JvdXBQcmljZSAhPT0gbnVsbCAmJiB4Lmdyb3VwUHJpY2UgIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICBwcmljZUdhcCA9IHgucHJpY2UgLSB4Lmdyb3VwUHJpY2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcmljZUdhcCA9IDA7XG4gICAgICAgIH1cbiAgICAvLyDmnInlnovlj7dcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBncm91cFByaWNlID0geC5zdGFuZGFyZHMuZmlsdGVyKCB4ID0+IHguZ3JvdXBQcmljZSAhPT0gbnVsbCAmJiB4Lmdyb3VwUHJpY2UgIT09IHVuZGVmaW5lZCApO1xuICAgICAgICAvLyDlnovlj7fph4zpnaLmnInlm6LotK3nmoRcbiAgICAgICAgaWYgKCBncm91cFByaWNlLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICBjb25zdCBzb3J0ZWRHcm91cFByaWNlID0gZ3JvdXBQcmljZS5zb3J0KCggeCwgeSApID0+ICgoIHguZ3JvdXBQcmljZSAtIHgucHJpY2UgKSAtICggeS5ncm91cFByaWNlIC0geS5wcmljZSApKSk7XG4gICAgICAgICAgICBpZiAoKCBzb3J0ZWRHcm91cFByaWNlWzBdLmdyb3VwUHJpY2UgLSBzb3J0ZWRHcm91cFByaWNlWzBdLnByaWNlICkgPT09XG4gICAgICAgICAgICAgICAgKCBzb3J0ZWRHcm91cFByaWNlWyBzb3J0ZWRHcm91cFByaWNlLmxlbmd0aCAtIDEgXS5ncm91cFByaWNlIC0gc29ydGVkR3JvdXBQcmljZVsgc29ydGVkR3JvdXBQcmljZS5sZW5ndGggLSAxIF0ucHJpY2UgKSkge1xuICAgICAgICAgICAgICAgIHByaWNlR2FwID0gKCBzb3J0ZWRHcm91cFByaWNlWzBdLnByaWNlIC0gc29ydGVkR3JvdXBQcmljZVswXS5ncm91cFByaWNlICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHByaWNlR2FwID0gYCR7c29ydGVkR3JvdXBQcmljZVsgc29ydGVkR3JvdXBQcmljZS5sZW5ndGggLSAxIF0ucHJpY2UgLSBzb3J0ZWRHcm91cFByaWNlWyBzb3J0ZWRHcm91cFByaWNlLmxlbmd0aCAtIDEgXS5ncm91cFByaWNlfX4ke3NvcnRlZEdyb3VwUHJpY2VbMF0ucHJpY2UgLSBzb3J0ZWRHcm91cFByaWNlWzBdLmdyb3VwUHJpY2V9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHByaWNlR2FwID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHsgfSwgeCwge1xuICAgICAgICBwaWQ6IHguX2lkLFxuICAgICAgICAvLyDlupPlrZjljLrpl7RcbiAgICAgICAgc3RvY2skOiBzdG9jayxcbiAgICAgICAgLy8g5Lu35qC85Yy66Ze0XG4gICAgICAgIHByaWNlJDogcHJpY2UsXG4gICAgICAgIC8vIOW3ruS7t1xuICAgICAgICBwcmljZUdhcCxcbiAgICAgICAgLy8g5pyA5L2O5Lu35qC877yI5ZCr5Zui6LSt5Lu377yJXG4gICAgICAgIGxvd2VzdF9wcmljZSQ6IGxvd2VzdF9wcmljZVxuICAgIH0pXG5cbn07XG5cbmV4cG9ydCB7XG4gICAgZGVsYXllcmluZ0dvb2Rcbn0iXX0=