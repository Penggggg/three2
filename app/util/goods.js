"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var delayeringGood = function (x) {
    if (!x) {
        return null;
    }
    var allPriceArr = [];
    var allStockArr = [];
    var decorateItem = function (good) {
        allPriceArr.push(good.price);
        if (good.stock) {
            allStockArr.push(good.stock);
        }
        if (good.groupPrice) {
            allPriceArr.push(good.groupPrice);
        }
    };
    var decorateItem2 = function (activities) {
        if (Array.isArray(activities)) {
            activities.map(function (ac) {
                allPriceArr.push(ac.ac_price);
                if (ac.ac_groupPrice) {
                    allPriceArr.push(ac.ac_groupPrice);
                }
            });
        }
    };
    decorateItem2(x.activities);
    if (!x.standards || x.standards.length === 0) {
        decorateItem(x);
    }
    else {
        x.standards.map(decorateItem);
    }
    allPriceArr = allPriceArr.sort(function (x, y) { return x - y; });
    allStockArr = allStockArr.sort(function (x, y) { return x - y; });
    return Object.assign({}, x, {
        pid: x._id,
        stock$: allStockArr.length === 0 ?
            allStockArr[0] :
            allStockArr[0] + " ~ " + allStockArr[allStockArr.length - 1],
        price$: allPriceArr.length === 0 ?
            allPriceArr[0] :
            allPriceArr[0] === allPriceArr[allPriceArr.length - 1] ?
                allPriceArr[0] :
                allPriceArr[0] + " ~ " + allPriceArr[allPriceArr.length - 1],
        priceGap: allPriceArr.length === 0 ?
            0 :
            "" + (allPriceArr[allPriceArr.length - 1] - allPriceArr[0]),
        lowest_price$: allPriceArr[0],
        hasActivity: !!x.activity || (Array.isArray(x.activities) && x.activities.length > 0),
        goodPins: dealGoodPin(x),
        tagText: x.tag.join('„ÄÅ')
    });
};
exports.delayeringGood = delayeringGood;
var dealGoodPin = function (good) {
    var activities = good.activities, standards = good.standards, price = good.price, groupPrice = good.groupPrice;
    if (!standards || standards.length === 0) {
        return {
            list: [{
                    price: price,
                    groupPrice: groupPrice
                }],
            maxDelta: price - groupPrice
        };
    }
    else {
        var meta = standards.map(function (standard) {
            var acTarget = activities.find(function (ac) { return ac.pid === standard.pid && ac.sid === standard._id; });
            if ((!!acTarget && !!acTarget.ac_groupPrice) || standard.groupPrice) {
                if (acTarget) {
                    return {
                        price: acTarget.ac_price,
                        groupPrice: acTarget.ac_groupPrice
                    };
                }
                else {
                    return {
                        price: standard.price,
                        groupPrice: standard.groupPrice
                    };
                }
            }
            return null;
        }).filter(function (x) { return !!x; });
        var deltas = meta.map(function (x) {
            return x.price - x.groupPrice;
        }).sort(function (x, y) { return y - x; });
        return {
            list: meta,
            maxDelta: deltas[0],
            maxGap: deltas[deltas.length - 1] + " ~ " + deltas[0]
        };
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnb29kcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUlBLElBQU0sY0FBYyxHQUFHLFVBQUEsQ0FBQztJQUVwQixJQUFLLENBQUMsQ0FBQyxFQUFHO1FBQ04sT0FBTyxJQUFJLENBQUE7S0FDZDtJQUdELElBQUksV0FBVyxHQUFXLEVBQUcsQ0FBQztJQUc5QixJQUFJLFdBQVcsR0FBWSxFQUFHLENBQUM7SUFHL0IsSUFBTSxZQUFZLEdBQUcsVUFBQSxJQUFJO1FBRXJCLFdBQVcsQ0FBQyxJQUFJLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBRSxDQUFDO1FBRS9CLElBQUssSUFBSSxDQUFDLEtBQUssRUFBRztZQUNkLFdBQVcsQ0FBQyxJQUFJLENBQUUsSUFBSSxDQUFDLEtBQUssQ0FBRSxDQUFDO1NBQ2xDO1FBRUQsSUFBSyxJQUFJLENBQUMsVUFBVSxFQUFHO1lBQ25CLFdBQVcsQ0FBQyxJQUFJLENBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBRSxDQUFDO1NBQ3ZDO0lBRUwsQ0FBQyxDQUFDO0lBR0YsSUFBTSxhQUFhLEdBQUcsVUFBQSxVQUFVO1FBQzVCLElBQUssS0FBSyxDQUFDLE9BQU8sQ0FBRSxVQUFVLENBQUUsRUFBRTtZQUM5QixVQUFVLENBQUMsR0FBRyxDQUFFLFVBQUEsRUFBRTtnQkFDZCxXQUFXLENBQUMsSUFBSSxDQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUUsQ0FBQztnQkFFaEMsSUFBSyxFQUFFLENBQUMsYUFBYSxFQUFHO29CQUNwQixXQUFXLENBQUMsSUFBSSxDQUFFLEVBQUUsQ0FBQyxhQUFhLENBQUUsQ0FBQztpQkFDeEM7WUFDTCxDQUFDLENBQUMsQ0FBQztTQUNOO0lBQ0wsQ0FBQyxDQUFBO0lBR0QsYUFBYSxDQUFFLENBQUMsQ0FBQyxVQUFVLENBQUUsQ0FBQztJQUc5QixJQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLE1B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Q0FBQyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUUsSUFBSSxRQUFRLENBQUMsVUFBVSxFQUFHO2dCQUNwRSxJQUFLLFFBQVEsRUFBRztvQkFDWixPQUFPO3dCQUNILEtBQUssRUFBRSxRQUFRLENBQUMsUUFBUTt3QkFDeEIsVUFBVSxFQUFFLFFBQVEsQ0FBQyxhQUFhO3FCQUNyQyxDQUFBO2lCQUNKO3FCQUFNO29CQUNILE9BQU87d0JBQ0gsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLO3dCQUNyQixVQUFVLEVBQUUsUUFBUSxDQUFDLFVBQVU7cUJBQ2xDLENBQUE7aUJBQ0o7YUFDSjtZQUNELE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBRSxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxDQUFDLEVBQUgsQ0FBRyxDQUFFLENBQUM7UUFFdEIsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBRSxVQUFBLENBQUM7WUFDdEIsT0FBQSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxVQUFVO1FBQXRCLENBQXNCLENBQ3pCLENBQUMsSUFBSSxDQUFDLFVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBTSxPQUFBLENBQUMsR0FBRyxDQUFDLEVBQUwsQ0FBSyxDQUFFLENBQUM7UUFFM0IsT0FBTztZQUNILElBQUksRUFBRSxJQUFJO1lBQ1YsUUFBUSxFQUFFLE1BQU0sQ0FBRSxDQUFDLENBQUU7WUFDckIsTUFBTSxFQUFLLE1BQU0sQ0FBRSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBRSxXQUFNLE1BQU0sQ0FBRSxDQUFDLENBQUk7U0FDNUQsQ0FBQztLQUNMO0FBQ0wsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXG4vKiogXG4gKiDllYblk4Eg772eIOS7t+agvOWMuumXtOOAgeW6k+WtmOWMuumXtOOAgeW3ruS7t+OAgeacgOS9juS7t+agvO+8iOWQq+Wboui0reS7ty/kuIDlj6Pku7fvvIlcbiAqL1xuY29uc3QgZGVsYXllcmluZ0dvb2QgPSB4ID0+IHtcbiBcbiAgICBpZiAoICF4ICkge1xuICAgICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIC8vIOWIneWni+WMlu+8muS7t+agvOaVsOe7hO+8iOWQq+Wboui0reS7t+OAgeeJueS7t++8iVxuICAgIGxldCBhbGxQcmljZUFycjogYW55WyBdID0gWyBdO1xuXG4gICAgLy8g5Yid5aeL5YyW77ya5bqT5a2Y5YiX6KGoXG4gICAgbGV0IGFsbFN0b2NrQXJyOiBhbnlbIF0gID0gWyBdO1xuXG4gICAgLy8g5peg5p2h5Lu25rOo5YWlIOS4u+S6p+WTgS/lnovlj7fku7fmoLzjgIHlm6LotK3ku7dcbiAgICBjb25zdCBkZWNvcmF0ZUl0ZW0gPSBnb29kID0+IHtcblxuICAgICAgICBhbGxQcmljZUFyci5wdXNoKCBnb29kLnByaWNlICk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIGdvb2Quc3RvY2sgKSB7XG4gICAgICAgICAgICBhbGxTdG9ja0Fyci5wdXNoKCBnb29kLnN0b2NrICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIGdvb2QuZ3JvdXBQcmljZSApIHtcbiAgICAgICAgICAgIGFsbFByaWNlQXJyLnB1c2goIGdvb2QuZ3JvdXBQcmljZSApO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgLy8g5peg5p2h5Lu25rOo5YWlIOeJueS7t+a0u+WKqOeahOS7t+agvOOAgeWboui0reS7t1xuICAgIGNvbnN0IGRlY29yYXRlSXRlbTIgPSBhY3Rpdml0aWVzID0+IHtcbiAgICAgICAgaWYgKCBBcnJheS5pc0FycmF5KCBhY3Rpdml0aWVzICkpIHtcbiAgICAgICAgICAgIGFjdGl2aXRpZXMubWFwKCBhYyA9PiB7XG4gICAgICAgICAgICAgICAgYWxsUHJpY2VBcnIucHVzaCggYWMuYWNfcHJpY2UgKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoIGFjLmFjX2dyb3VwUHJpY2UgKSB7XG4gICAgICAgICAgICAgICAgICAgIGFsbFByaWNlQXJyLnB1c2goIGFjLmFjX2dyb3VwUHJpY2UgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIOaXoOadoeS7tuazqOWFpSDnibnku7fmtLvliqjnmoTku7fmoLzjgIHlm6LotK3ku7dcbiAgICBkZWNvcmF0ZUl0ZW0yKCB4LmFjdGl2aXRpZXMgKTtcblxuICAgIC8vIOayoeacieWei+WPt1xuICAgIGlmICggIXguc3RhbmRhcmRzIHx8IHguc3RhbmRhcmRzLmxlbmd0aCA9PT0gMCApIHtcbiAgICAgICAgZGVjb3JhdGVJdGVtKCB4ICk7XG4gICAgXG4gICAgLy8g5pyJ5Z6L5Y+3XG4gICAgfSBlbHNlIHtcbiAgICAgICAgeC5zdGFuZGFyZHMubWFwKCBkZWNvcmF0ZUl0ZW0gKTtcbiAgICB9XG5cbiAgICAvLyDph43mlrDmjpLluo/ku7fmoLzlkozlupPlrZhcbiAgICBhbGxQcmljZUFyciA9IGFsbFByaWNlQXJyLnNvcnQoKCB4LCB5ICkgPT4geCAtIHkgKTtcbiAgICBhbGxTdG9ja0FyciA9IGFsbFN0b2NrQXJyLnNvcnQoKCB4LCB5ICkgPT4geCAtIHkgKTtcblxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHsgfSwgeCwge1xuICAgICAgICBwaWQ6IHguX2lkLFxuICAgICAgICAvLyDlupPlrZjljLrpl7RcbiAgICAgICAgc3RvY2skOiBhbGxTdG9ja0Fyci5sZW5ndGggPT09IDAgP1xuICAgICAgICAgICAgYWxsU3RvY2tBcnJbIDAgXSA6XG4gICAgICAgICAgICBgJHthbGxTdG9ja0FyclsgMCBdfSB+ICR7YWxsU3RvY2tBcnJbIGFsbFN0b2NrQXJyLmxlbmd0aCAtIDEgXX1gLFxuICAgICAgICAvLyDku7fmoLzljLrpl7RcbiAgICAgICAgcHJpY2UkOiBhbGxQcmljZUFyci5sZW5ndGggPT09IDAgP1xuICAgICAgICAgICAgYWxsUHJpY2VBcnJbIDAgXSA6XG4gICAgICAgICAgICAgICAgYWxsUHJpY2VBcnJbIDAgXSA9PT0gYWxsUHJpY2VBcnJbIGFsbFByaWNlQXJyLmxlbmd0aCAtIDEgXSA/IFxuICAgICAgICAgICAgICAgICAgICBhbGxQcmljZUFyclsgMCBdIDpcbiAgICAgICAgICAgICAgICAgICAgYCR7YWxsUHJpY2VBcnJbIDAgXX0gfiAke2FsbFByaWNlQXJyWyBhbGxQcmljZUFyci5sZW5ndGggLSAxIF19YCxcbiAgICAgICAgLy8g5pyA5aSn5bmF5bqm5beu5Lu3XG4gICAgICAgIHByaWNlR2FwOiBhbGxQcmljZUFyci5sZW5ndGggPT09IDAgP1xuICAgICAgICAgICAgMCA6XG4gICAgICAgICAgICBgJHthbGxQcmljZUFyclsgYWxsUHJpY2VBcnIubGVuZ3RoIC0gMSBdIC0gYWxsUHJpY2VBcnJbIDAgXX1gLFxuICAgICAgICAvLyDmnIDkvY7ku7fmoLzvvIjlkKvlm6LotK3ku7fvvIlcbiAgICAgICAgbG93ZXN0X3ByaWNlJDogYWxsUHJpY2VBcnJbIDAgXSxcbiAgICAgICAgLyoqIOaYr+WQpuaciea0u+WKqCAqL1xuICAgICAgICBoYXNBY3Rpdml0eTogISF4LmFjdGl2aXR5IHx8IChBcnJheS5pc0FycmF5KCB4LmFjdGl2aXRpZXMgKSAmJiB4LmFjdGl2aXRpZXMubGVuZ3RoID4gMCksXG4gICAgICAgIC8qKiDmi7zlm6Lkv6Hmga8gKi9cbiAgICAgICAgZ29vZFBpbnM6IGRlYWxHb29kUGluKCB4ICksXG4gICAgICAgIC8qKiDmoIfnrb4gKi9cbiAgICAgICAgdGFnVGV4dDogeC50YWcuam9pbign44CBJylcbiAgICB9KVxuXG59O1xuXG4vKiog5aSE55CG5ZWG5ZOB55qE5ou85Zui5beu5Lu377yM6L+U5Zue5ou85Zui5YiX6KGo5ZKM5ou85Zui5beu5Lu35Yy66Ze077yI5ZCr54m55Lu377yJICovXG5jb25zdCBkZWFsR29vZFBpbiA9IGdvb2QgPT4ge1xuICAgIGNvbnN0IHsgYWN0aXZpdGllcywgc3RhbmRhcmRzLCBwcmljZSwgZ3JvdXBQcmljZSB9ID0gZ29vZDtcblxuICAgIC8vIOWNleWTgSBcbiAgICBpZiAoICFzdGFuZGFyZHMgfHwgc3RhbmRhcmRzLmxlbmd0aCA9PT0gMCApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGxpc3Q6IFt7XG4gICAgICAgICAgICAgICAgcHJpY2UsXG4gICAgICAgICAgICAgICAgZ3JvdXBQcmljZVxuICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICBtYXhEZWx0YTogcHJpY2UgLSBncm91cFByaWNlXG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuXG4gICAgICAgIGNvbnN0IG1ldGEgPSBzdGFuZGFyZHMubWFwKCBzdGFuZGFyZCA9PiB7XG4gICAgICAgICAgICBjb25zdCBhY1RhcmdldCA9IGFjdGl2aXRpZXMuZmluZCggYWMgPT4gYWMucGlkID09PSBzdGFuZGFyZC5waWQgJiYgYWMuc2lkID09PSBzdGFuZGFyZC5faWQgKTtcbiAgICAgICAgICAgIGlmICgoICEhYWNUYXJnZXQgJiYgISFhY1RhcmdldC5hY19ncm91cFByaWNlICkgfHwgc3RhbmRhcmQuZ3JvdXBQcmljZSApIHtcbiAgICAgICAgICAgICAgICBpZiAoIGFjVGFyZ2V0ICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2U6IGFjVGFyZ2V0LmFjX3ByaWNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBQcmljZTogYWNUYXJnZXQuYWNfZ3JvdXBQcmljZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlOiBzdGFuZGFyZC5wcmljZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwUHJpY2U6IHN0YW5kYXJkLmdyb3VwUHJpY2VcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9KS5maWx0ZXIoIHggPT4gISF4ICk7XG5cbiAgICAgICAgY29uc3QgZGVsdGFzID0gbWV0YS5tYXAoIHggPT4gXG4gICAgICAgICAgICB4LnByaWNlIC0geC5ncm91cFByaWNlXG4gICAgICAgICkuc29ydCgoIHgsIHkgKSA9PiB5IC0geCApO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBsaXN0OiBtZXRhLFxuICAgICAgICAgICAgbWF4RGVsdGE6IGRlbHRhc1sgMCBdLFxuICAgICAgICAgICAgbWF4R2FwOiBgJHtkZWx0YXNbIGRlbHRhcy5sZW5ndGggLSAxIF19IH4gJHtkZWx0YXNbIDAgXX1gXG4gICAgICAgIH07XG4gICAgfVxufVxuXG5leHBvcnQge1xuICAgIGRlbGF5ZXJpbmdHb29kXG59Il19