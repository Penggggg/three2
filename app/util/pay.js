"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("./http");
exports.wxPay = function (total_fee, successCB, completeCB) {
    if (!total_fee) {
        successCB && successCB({
            prepay_id: 0
        });
        completeCB && completeCB();
        return;
    }
    http_1.http({
        url: 'common_wxpay',
        data: {
            total_fee: Math.floor(total_fee * 100)
        },
        errMsg: '支付失败，请重试',
        success: function (res1) {
            if (res1.status !== 200) {
                wx.showToast({
                    icon: 'none',
                    title: '支付失败，请重试'
                });
                completeCB && completeCB();
                return;
            }
            var _a = res1.data, nonce_str = _a.nonce_str, paySign = _a.paySign, prepay_id = _a.prepay_id, timeStamp = _a.timeStamp;
            wx.requestPayment({
                paySign: paySign,
                timeStamp: timeStamp,
                signType: 'MD5',
                nonceStr: nonce_str,
                package: "prepay_id=" + prepay_id,
                success: function (res) {
                    var errMsg = res.errMsg;
                    if (errMsg === 'requestPayment:ok') {
                        successCB && successCB(res1.data);
                    }
                },
                fail: function (err) {
                    wx.showToast({
                        icon: 'none',
                        title: '支付失败，请重试'
                    });
                },
                complete: function () { completeCB && completeCB(); }
            });
        }
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGF5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsK0JBQThCO0FBR2pCLFFBQUEsS0FBSyxHQUFHLFVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVO0lBRW5ELElBQUssQ0FBQyxTQUFTLEVBQUc7UUFFZCxTQUFTLElBQUksU0FBUyxDQUFDO1lBQ25CLFNBQVMsRUFBRSxDQUFDO1NBQ2YsQ0FBQyxDQUFDO1FBQ0gsVUFBVSxJQUFJLFVBQVUsRUFBRyxDQUFDO1FBQzVCLE9BQU87S0FDVjtJQUVELFdBQUksQ0FBQztRQUNELEdBQUcsRUFBRSxjQUFjO1FBQ25CLElBQUksRUFBRTtZQUNGLFNBQVMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFFLFNBQVMsR0FBRyxHQUFHLENBQUU7U0FDM0M7UUFDRCxNQUFNLEVBQUUsVUFBVTtRQUNsQixPQUFPLEVBQUUsVUFBQSxJQUFJO1lBQ1QsSUFBSyxJQUFJLENBQUMsTUFBTSxLQUFLLEdBQUcsRUFBRztnQkFDdkIsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDVCxJQUFJLEVBQUUsTUFBTTtvQkFDWixLQUFLLEVBQUUsVUFBVTtpQkFDcEIsQ0FBQyxDQUFDO2dCQUNILFVBQVUsSUFBSSxVQUFVLEVBQUcsQ0FBQztnQkFDNUIsT0FBTzthQUNWO1lBQ0ssSUFBQSxjQUF3RCxFQUF0RCx3QkFBUyxFQUFFLG9CQUFPLEVBQUUsd0JBQVMsRUFBRSx3QkFBdUIsQ0FBQztZQUMvRCxFQUFFLENBQUMsY0FBYyxDQUFDO2dCQUNkLE9BQU8sU0FBQTtnQkFDUCxTQUFTLFdBQUE7Z0JBQ1QsUUFBUSxFQUFFLEtBQUs7Z0JBQ2YsUUFBUSxFQUFFLFNBQVM7Z0JBQ25CLE9BQU8sRUFBRSxlQUFhLFNBQVc7Z0JBQ2pDLE9BQU8sRUFBRSxVQUFBLEdBQUc7b0JBQ0EsSUFBQSxtQkFBTSxDQUFTO29CQUN2QixJQUFLLE1BQU0sS0FBSyxtQkFBbUIsRUFBRzt3QkFFbEMsU0FBUyxJQUFJLFNBQVMsQ0FBRSxJQUFJLENBQUMsSUFBSSxDQUFFLENBQUM7cUJBQ3ZDO2dCQUNMLENBQUM7Z0JBQ0QsSUFBSSxFQUFFLFVBQUEsR0FBRztvQkFDTCxFQUFFLENBQUMsU0FBUyxDQUFDO3dCQUNULElBQUksRUFBRSxNQUFNO3dCQUNaLEtBQUssRUFBRSxVQUFVO3FCQUNwQixDQUFDLENBQUM7Z0JBQ1AsQ0FBQztnQkFDRCxRQUFRLEVBQUUsY0FBUyxVQUFVLElBQUksVUFBVSxFQUFHLENBQUMsQ0FBQSxDQUFDO2FBQ25ELENBQUMsQ0FBQztRQUNQLENBQUM7S0FDSixDQUFDLENBQUE7QUFDTixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBodHRwIH0gZnJvbSAnLi9odHRwJztcblxuLyoqIOWPkei1t+W+ruS/oeaUr+S7mCAqL1xuZXhwb3J0IGNvbnN0IHd4UGF5ID0gKCB0b3RhbF9mZWUsIHN1Y2Nlc3NDQiwgY29tcGxldGVDQiApID0+IHtcblxuICAgIGlmICggIXRvdGFsX2ZlZSApIHtcbiAgICAgICAgLy8g5pSv5LuY5oiQ5YqfXG4gICAgICAgIHN1Y2Nlc3NDQiAmJiBzdWNjZXNzQ0Ioe1xuICAgICAgICAgICAgcHJlcGF5X2lkOiAwXG4gICAgICAgIH0pO1xuICAgICAgICBjb21wbGV0ZUNCICYmIGNvbXBsZXRlQ0IoICk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBodHRwKHtcbiAgICAgICAgdXJsOiAnY29tbW9uX3d4cGF5JyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdG90YWxfZmVlOiBNYXRoLmZsb29yKCB0b3RhbF9mZWUgKiAxMDAgKSAvLyDov5nph4znmoTljZXkvY3mmK/liIbvvIzkuI3mmK/lhYNcbiAgICAgICAgfSxcbiAgICAgICAgZXJyTXNnOiAn5pSv5LuY5aSx6LSl77yM6K+36YeN6K+VJyxcbiAgICAgICAgc3VjY2VzczogcmVzMSA9PiB7XG4gICAgICAgICAgICBpZiAoIHJlczEuc3RhdHVzICE9PSAyMDAgKSB7XG4gICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+aUr+S7mOWksei0pe+8jOivt+mHjeivlSdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZUNCICYmIGNvbXBsZXRlQ0IoICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBub25jZV9zdHIsIHBheVNpZ24sIHByZXBheV9pZCwgdGltZVN0YW1wIH0gPSByZXMxLmRhdGE7XG4gICAgICAgICAgICB3eC5yZXF1ZXN0UGF5bWVudCh7XG4gICAgICAgICAgICAgICAgcGF5U2lnbixcbiAgICAgICAgICAgICAgICB0aW1lU3RhbXAsXG4gICAgICAgICAgICAgICAgc2lnblR5cGU6ICdNRDUnLFxuICAgICAgICAgICAgICAgIG5vbmNlU3RyOiBub25jZV9zdHIsXG4gICAgICAgICAgICAgICAgcGFja2FnZTogYHByZXBheV9pZD0ke3ByZXBheV9pZH1gLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgZXJyTXNnIH0gPSByZXM7XG4gICAgICAgICAgICAgICAgICAgIGlmICggZXJyTXNnID09PSAncmVxdWVzdFBheW1lbnQ6b2snICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5pSv5LuY5oiQ5YqfXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzQ0IgJiYgc3VjY2Vzc0NCKCByZXMxLmRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogZXJyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICdub25lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5pSv5LuY5aSx6LSl77yM6K+36YeN6K+VJ1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlOiAoICkgPT4geyBjb21wbGV0ZUNCICYmIGNvbXBsZXRlQ0IoICk7fVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KVxufSJdfQ==