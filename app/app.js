"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("./util/http");
App({
    globalData$: {
        role: 0,
        openid: '',
        isUserAuth: true,
        userInfo: null
    },
    globalData: {
        role: 0,
        openid: '',
        isUserAuth: true,
        userInfo: null
    },
    watchCallBack: {},
    watchingKeys: [],
    init: function () {
        var _this = this;
        wx.cloud.init({
            traceUser: true
        });
        this.globalData$ = Object.assign({}, this.globalData);
        wx.getSetting({
            success: function (res) {
                var isUserAuth = res.authSetting['scope.userInfo'];
                _this.setGlobalData({
                    isUserAuth: isUserAuth
                });
            }
        });
    },
    getWxUserInfo: function () {
        wx.getUserInfo({
            success: function (res) {
                console.log(res.userInfo);
                http_1.http({
                    data: res.userInfo,
                    url: 'api-user-edit',
                    success: function (res) {
                        console.log(res);
                    }
                });
            }
        });
    },
    getUserInfo: function () {
        var _this = this;
        wx.cloud.callFunction({
            name: 'login'
        }).then(function (res) {
            _this.setGlobalData(res.result);
        });
    },
    setGlobalData: function (obj) {
        var _this = this;
        Object.keys(obj).map(function (key) {
            _this.globalData[key] = obj[key];
        });
        this.globalData = Object.assign({}, this.globalData, __assign({}, obj));
    },
    watch$: function (key, cb) {
        var _a;
        this.watchCallBack = Object.assign({}, this.watchCallBack, (_a = {},
            _a[key] = this.watchCallBack[key] || [],
            _a));
        this.watchCallBack[key].push(cb);
        var old = this.globalData[key];
        cb(old, old);
        if (!this.watchingKeys.find(function (x) { return x === key; })) {
            var that_1 = this;
            this.watchingKeys.push(key);
            Object.defineProperty(this.globalData, key, {
                configurable: true,
                enumerable: true,
                set: function (val) {
                    var old = that_1.globalData$[key];
                    that_1.globalData$[key] = val;
                    that_1.watchCallBack[key].map(function (func) { return func(val, old); });
                },
                get: function () {
                    return that_1.globalData$[key];
                }
            });
        }
    },
    onLaunch: function () {
        this.init();
        this.getUserInfo();
    }
});
var Role;
(function (Role) {
    Role[Role["normal"] = 0] = "normal";
    Role[Role["admin"] = 1] = "admin";
})(Role || (Role = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSxvQ0FBbUM7QUFFbkMsR0FBRyxDQUFRO0lBR1AsV0FBVyxFQUFFO1FBRVQsSUFBSSxFQUFFLENBQUM7UUFFUCxNQUFNLEVBQUUsRUFBRTtRQUVWLFVBQVUsRUFBRSxJQUFJO1FBRWhCLFFBQVEsRUFBRSxJQUFJO0tBQ2pCO0lBR0QsVUFBVSxFQUFFO1FBQ1IsSUFBSSxFQUFFLENBQUM7UUFDUCxNQUFNLEVBQUUsRUFBRTtRQUNWLFVBQVUsRUFBRSxJQUFJO1FBQ2hCLFFBQVEsRUFBRSxJQUFJO0tBQ2pCO0lBR0QsYUFBYSxFQUFFLEVBQUc7SUFHbEIsWUFBWSxFQUFFLEVBQUc7SUFHakIsSUFBSTtRQUFKLGlCQW1CQztRQWpCRyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztZQUNWLFNBQVMsRUFBRSxJQUFJO1NBQ2xCLENBQUMsQ0FBQztRQUdILElBQUksQ0FBQyxXQUFXLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFHLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBRSxDQUFDO1FBR3hELEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDVixPQUFPLEVBQUUsVUFBQSxHQUFHO2dCQUVSLElBQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFDckQsS0FBSSxDQUFDLGFBQWEsQ0FBQztvQkFDZixVQUFVLFlBQUE7aUJBQ2IsQ0FBQyxDQUFDO1lBQ1AsQ0FBQztTQUNKLENBQUMsQ0FBQztJQUNQLENBQUM7SUFHRCxhQUFhO1FBQ1QsRUFBRSxDQUFDLFdBQVcsQ0FBQztZQUNYLE9BQU8sWUFBQyxHQUFHO2dCQUNQLE9BQU8sQ0FBQyxHQUFHLENBQUUsR0FBRyxDQUFDLFFBQVEsQ0FBRSxDQUFBO2dCQUUzQixXQUFJLENBQUM7b0JBQ0QsSUFBSSxFQUFFLEdBQUcsQ0FB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LEVBSEksSUFBSSxLQUFKLElBQUksUUFHUiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGh0dHAgfSBmcm9tICcuL3V0aWwvaHR0cCc7XG5cbkFwcDxNeUFwcD4oe1xuXG4gICAgLyoqIGZhZGUgZ2xvYmFsRGF0YSAqL1xuICAgIGdsb2JhbERhdGEkOiB7XG4gICAgICAgIC8vIOeZu+W9leS6uuadg+mZkFxuICAgICAgICByb2xlOiAwLFxuICAgICAgICAvLyDnmbvlvZXkurppZFxuICAgICAgICBvcGVuaWQ6ICcnLFxuICAgICAgICAvLyDmmK/lkKblt7Lnu4/mjojmnYPnlKjmiLfkv6Hmga9cbiAgICAgICAgaXNVc2VyQXV0aDogdHJ1ZSxcbiAgICAgICAgLy8g55So5oi35L+h5oGvXG4gICAgICAgIHVzZXJJbmZvOiBudWxsXG4gICAgfSxcblxuICAgIC8qKiDlhajlsYBzdG9yZSAqL1xuICAgIGdsb2JhbERhdGE6IHtcbiAgICAgICAgcm9sZTogMCxcbiAgICAgICAgb3BlbmlkOiAnJyxcbiAgICAgICAgaXNVc2VyQXV0aDogdHJ1ZSxcbiAgICAgICAgdXNlckluZm86IG51bGxcbiAgICB9LFxuXG4gICAgLyoqIOebkeWQrOWHveaVsOeahOWvueixoeaVsOe7hCAqL1xuICAgIHdhdGNoQ2FsbEJhY2s6IHsgfSxcblxuICAgIC8qKiDnm5HlkKzliJfooaggKi9cbiAgICB3YXRjaGluZ0tleXM6IFsgXSxcblxuICAgIC8qKiDliJ3lp4vljJYgKi9cbiAgICBpbml0KCApIHtcbiAgICAgICAgLy8g5LqRXG4gICAgICAgIHd4LmNsb3VkLmluaXQoe1xuICAgICAgICAgICAgdHJhY2VVc2VyOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8g5YWo5bGA5pWw5o2uXG4gICAgICAgIHRoaXMuZ2xvYmFsRGF0YSQgPSBPYmplY3QuYXNzaWduKHsgfSwgdGhpcy5nbG9iYWxEYXRhICk7XG5cbiAgICAgICAgLy8g55So5oi35L+h5oGvXG4gICAgICAgIHd4LmdldFNldHRpbmcoe1xuICAgICAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICAgICAgICAvLyDmmK/lkKblt7Lnu4/mjojmnYNcbiAgICAgICAgICAgICAgICBjb25zdCBpc1VzZXJBdXRoID0gcmVzLmF1dGhTZXR0aW5nWydzY29wZS51c2VySW5mbyddO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0R2xvYmFsRGF0YSh7XG4gICAgICAgICAgICAgICAgICAgIGlzVXNlckF1dGhcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKiDojrflj5blvq7kv6HnlKjmiLfnmbvlvZXkv6Hmga/jgIHmjojmnYPjgIHkuIrkvKDkv53lrZggKi9cbiAgICBnZXRXeFVzZXJJbmZvKCApIHtcbiAgICAgICAgd3guZ2V0VXNlckluZm8oe1xuICAgICAgICAgICAgc3VjY2VzcyhyZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggcmVzLnVzZXJJbmZvIClcbiAgICAgICAgICAgICAgICAvLyDkuIrkvKDmiJDlip/lkI7vvIxpc1VzZXJBdXRo6K6+5Li6dHJ1ZVxuICAgICAgICAgICAgICAgIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXMudXNlckluZm8sXG4gICAgICAgICAgICAgICAgICAgIHVybDogJ2FwaS11c2VyLWVkaXQnLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIHJlcyApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIC8qKiDojrflj5bnlKjmiLfmnYPpmZDkv6Hmga8gKi9cbiAgICBnZXRVc2VySW5mbyggKSB7XG4gICAgICAgIHd4LmNsb3VkLmNhbGxGdW5jdGlvbih7XG4gICAgICAgICAgICBuYW1lOiAnbG9naW4nXG4gICAgICAgIH0pLnRoZW4oKCByZXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRHbG9iYWxEYXRhKCByZXMucmVzdWx0ICk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKiog6K6+572u5YWo5bGA5pWw5o2uICovXG4gICAgc2V0R2xvYmFsRGF0YSggb2JqICkge1xuICAgICAgICBPYmplY3Qua2V5cyggb2JqICkubWFwKCBrZXkgPT4ge1xuICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhWyBrZXkgXSA9IG9ialsga2V5IF07XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmdsb2JhbERhdGEgPSBPYmplY3QuYXNzaWduKHsgfSwgdGhpcy5nbG9iYWxEYXRhLCB7IC4uLihvYmogYXMgb2JqZWN0KX0pO1xuICAgIH0sXG5cbiAgICAvKiogd2F0Y2jlh73mlbAgKi9cbiAgICB3YXRjaCQoIGtleSwgY2IgKSB7XG4gICAgICAgIHRoaXMud2F0Y2hDYWxsQmFjayA9IE9iamVjdC5hc3NpZ24oeyB9LCB0aGlzLndhdGNoQ2FsbEJhY2ssIHtcbiAgICAgICAgICAgIFsga2V5IF06IHRoaXMud2F0Y2hDYWxsQmFja1sga2V5IF0gfHwgWyBdXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLndhdGNoQ2FsbEJhY2tbIGtleSBdLnB1c2goIGNiICk7XG5cbiAgICAgICAgLy8g56uL6ams5omn6KGM5LiA5LiLY2JcbiAgICAgICAgY29uc3Qgb2xkID0gdGhpcy5nbG9iYWxEYXRhWyBrZXkgXTtcbiAgICAgICAgY2IoIG9sZCwgb2xkICk7XG5cbiAgICAgICAgLy8g5omn6KGM55qE5pe25YCZ77yMc2V055qE5pe25YCZ77yM5YaN5omn6KGM5LiA5LiLY2JcbiAgICAgICAgaWYgKCAhdGhpcy53YXRjaGluZ0tleXMuZmluZCggeCA9PiB4ID09PSBrZXkgKSkge1xuICAgICAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB0aGlzLndhdGNoaW5nS2V5cy5wdXNoKCBrZXkgKTtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcy5nbG9iYWxEYXRhLCBrZXksIHtcbiAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKCB2YWwgKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZCA9IHRoYXQuZ2xvYmFsRGF0YSRbIGtleSBdO1xuICAgICAgICAgICAgICAgICAgICB0aGF0Lmdsb2JhbERhdGEkWyBrZXkgXSA9IHZhbDtcbiAgICAgICAgICAgICAgICAgICAgdGhhdC53YXRjaENhbGxCYWNrWyBrZXkgXS5tYXAoZnVuYyA9PiBmdW5jKCB2YWwsIG9sZCApKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24oICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC5nbG9iYWxEYXRhJFtrZXldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgXG4gICAgLyoqIOeUn+WRveWRqOacnyAqL1xuICAgIG9uTGF1bmNoOiBmdW5jdGlvbiggKSB7XG4gICAgICB0aGlzLmluaXQoICk7XG4gICAgICB0aGlzLmdldFVzZXJJbmZvKCApO1xuICAgIH1cbn0pO1xuXG5leHBvcnQgaW50ZXJmYWNlIE15QXBwIHtcbiAgICBnbG9iYWxEYXRhOiBnbG9iYWxTdGF0ZSxcbiAgICBnbG9iYWxEYXRhJDogZ2xvYmFsU3RhdGUsXG4gICAgd2F0Y2hDYWxsQmFjazoge1xuICAgICAgICBbIGtleTogc3RyaW5nIF06ICgoIHZhbDE6IGFueSwgdmFsMjogYW55ICkgPT4gdm9pZClbIF1cbiAgICB9XG4gICAgd2F0Y2hpbmdLZXlzOiBzdHJpbmdbIF1cbiAgICBpbml0OiAoICkgPT4gdm9pZFxuICAgIGdldFVzZXJJbmZvOiAoICkgPT4gdm9pZCxcbiAgICBnZXRXeFVzZXJJbmZvOiAoICkgPT4gdm9pZCxcbiAgICBzZXRHbG9iYWxEYXRhOiA8SyBleHRlbmRzIGtleW9mIGdsb2JhbFN0YXRlPiggZGF0YTogZ2xvYmFsU3RhdGUgfCBQaWNrPGdsb2JhbFN0YXRlLCBLPiApID0+IHZvaWQsXG4gICAgd2F0Y2gkOiAoIGtleToga2V5b2YgZ2xvYmFsU3RhdGUsIGFueSApID0+IHZvaWRcbn1cblxuZW51bSBSb2xlIHtcbiAgICBub3JtYWwsXG4gICAgYWRtaW5cbn1cblxudHlwZSBnbG9iYWxTdGF0ZSA9IHtcbiAgICByb2xlOiBSb2xlLFxuICAgIG9wZW5pZDogc3RyaW5nLFxuICAgIGlzVXNlckF1dGg6IGJvb2xlYW4sXG4gICAgdXNlckluZm86IGFueVxufSJdfQ==