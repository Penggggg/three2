<view class="page-order-list">

    <!-- 顶部毛玻璃 -->
    <view
        class="pol-header-block"
        wx:if="{{ tripOrders.length !== 0 }}"
    >
    </view>

    <view
        wx:if="{{ loading }}"
        class="pol-loading-tips"
    >
        加载中...
    </view>

    <!-- 内容信息，订单、可能附带推荐、拼团信息 -->
    <view
        wx:if="{{ !loading }}"
        class="pol-content-block"
    >

        <!-- 上方tab -->
        <!-- <view class="pol-tabs">
            <view
                wx:for="{{ tabs }}"
                data-index="{{ index }}"
                wx:key="{{ index }}"
                class="pol-tabs-item {{ active === index ? 'active' : '' }}"
            >
                {{ item.label }}
            </view>
        </view> -->

        <!-- 订单列表，需要“加载更多”的按钮 -->
        <view class="pol-order-list-block">

            <!-- 为空的情况 -->
            <view
                class="pol-empty-block"
                wx:if="{{ tripOrders.length === 0 }}"
            >
                <!-- 图片 -->
                <view class="pol-empty-img-block">
                    <view class="pol-empty-img-container">
                        <image
                            mode="aspectFit"
                            class="pol-empty-img"
                            src="https://global-1257764567.cos.ap-guangzhou.myqcloud.com/hug.png"
                        />
                        <view class="pol-empty-color"></view>
                    </view>
                </view>

                <!-- 文案 -->
                <view class="pol-empty-tips">
                    空空如也
                </view>

                <!-- 文案 -->
                <view class="pol-empty-title">
                    请对自己好一点
                </view>

                <!-- 文案 -->
                <view
                    class="pol-empty-tips top"
                >
                    {{ shoppinglist.length > 0 ? '她们都给自己买了这些礼物～' : '挑选一份给自己的礼物～' }}
                </view>

                <!-- 行程清单 -->
                <swiper
                    autoplay="{{ true }}"
                    circular="{{ true }}"
                    duration="{{ 1000 }}"
                    interval="{{ 3000 }}"
                    class="pol-swiper {{ shoppinglist.length <= 3 ? shoppinglist.length === 1 ? 'one' : shoppinglist.length === 2 ? 'two' : shoppinglist.length === 3 ? 'three' : '' : '' }}"
                    display-multiple-items="{{ shoppinglist.length <= 3 ? shoppinglist.length : 3 }}"
                >
                    <block
                        wx:key="{{ index }}"
                        wx:for="{{ shoppinglist }}"
                    >
                        <swiper-item class="swiper-visible">
                            <view
                                class="pol-swiper-item"
                            >
                                <image
                                    src="{{ item.img }}"
                                    mode="widthFix"
                                    class="pol-swiper-image"
                                />
                                <view class="pol-swiper-title">
                                    {{ item.goodName }}
                                </view>
                                <view
                                    wx:if="{{ item.tag[ 0 ]}}"
                                    class="pol-swiper-tag"
                                >
                                    {{ item.tag[ 0 ]}}
                                </view>
                            </view>
                        </swiper-item>
                    </block>
                </swiper>

                <!-- 按钮 -->
                <view
                    class="pol-empty-link"
                    bindtap="goTripEntry"
                >
                    <view class="pol-empty-round">
                        <i-icon
                            size="22"
                            type="enter"
                            color="#fff"
                            class="pol-empty-icon"
                        />
                        <view class="pol-empty-round-outer"></view>
                    </view>
                </view>

            </view>

            <!-- 头部用户在行程的优惠情况 -->
            

            <!-- 行程订单 -->
            <view
                wx:key="{{ index }}"
                class="pol-order-item"
                wx:for="{{ tripOrders }}"
            >
                <!-- 行程订单头 -->
                <view class="pol-trip-header-block">
                    <view
                        bindtap="goTripEntry"
                        class="pol-trip-header-info"
                        data-isClosed="{{ item.isClosed }}"
                    >
                        <image
                            class="pol-trip-item-image"
                            src="cloud://dev-0822cd.6465-dev-0822cd/icon-img/header.png"
                        />
                        <view class="pol-trip-name">
                            {{ item.tripName }} <view class="pol-trip-time">( {{ item.tripTime }} )</view>
                        </view>
                        <view
                            class="pol-trip-icon"
                            wx:if="{{ !item.isClosed }}"
                        >
                            <wxc-icon
                                size="15"
                                color="#bfbfbf"
                                type="arrow-right"
                                class="pm-other-icon"
                            />
                        </view>
                    </view>
                    <view class="pol-trip-header-status">
                        {{ item.tripStatusCN }}
                    </view>
                </view>

                <!-- 订单列表 -->
                <view
                    wx:for-index="k"
                    wx:key="{{ k }}"
                    wx:for-item="order"
                    wx:for="{{ item.meta }}"
                    class="pol-trip-order-item {{ order.b === '4' || order.b === '5' ? 'disabled' : '' }}"
                    bindtap="goGoodDetail"
                    data-data="{{ order }}"
                >
                    <!-- 基本信息 -->
                    <view class="pol-trip-order-info">

                        <!-- 图片、状态 -->
                        <view class="pol-trip-img-block">
                            <image
                                mode="scaleToFill"
                                class="pol-trip-order-img"
                                src="{{ order.img[ 0 ]}}"
                            />
                            <view class="pol-trip-order-img-cover {{ order.b === '4' || order.b === '5' ? 'disabled' : '' }}"></view>
                            <!-- 异常状态再显示 -->
                            <view
                                wx:for-index="k"
                                wx:for-item="i"
                                wx:key="{{ k }}"
                                wx:for="{{ order.statusCN }}"
                                class="pol-trip-order-status-fix"
                                wx:if="{{ i === '支付过期' || i === '待付订金' || i === '已取消' || i === '货源不足' }}"
                            >
                                {{ i }}
                            </view>
                        </view>

                        <!-- 产品、型号 -->
                        <view class="pol-trip-order-title-block">
                            <view class="pol-trip-order-name {{ order.b === '4' || order.b === '5' ? 'disabled' : '' }}">
                                {{ order.name }}
                            </view>
                            <view class="pol-trip-order-standar">
                                {{ order.standername }}
                            </view>
                        </view>

                        <!-- 价格、数量 -->
                        <view class="pol-trip-order-price-block">
                            <view class="pol-trip-order-price {{ order.b === '4' || order.b === '5' ? 'disabled' : '' }}">
                                ¥ {{ order.allocatedPrice || order.price }}
                            </view>

                            <!-- 期待的采购量 -->
                            <view
                                class="pol-trip-order-count"
                            >
                                x {{ order.count }}
                            </view>
                            <!-- 被分配的采购量 -->
                            <view
                                class="pol-trip-order-count purple"
                                wx:if="{{ order.b === '1' && order.count - order.allocatedCount > 0 }}"
                            >
                                x {{ order.allocatedCount }}
                            </view>
                        </view>

                    </view>
                
                </view>

                <!-- 货款合计信息 -->
                <view class="pol-trip-order-sum-block">
                    <view class="pol-trip-order-sum">
                        共{{ item.sum }}件商品
                    </view>
                    <view class="pol-trip-order-totalprice mr">
                        已付订金：<view class="pol-totalprice">¥{{ item.hasPayDepositPrice }}</view>
                    </view>
                </view>

                <!-- 最大拼团优惠信息 -->
                <!-- <view
                    wx:if="{{ item.totalPrice - item.totalGroupPrice > 0 }}"
                    class="pol-trip-order-sum-block"
                >
                    <view class="pol-trip-order-sum">
                        共{{ item.sum }}件可拼团
                    </view>
                    <view class="pol-trip-order-totalprice">
                        省：<view class="pol-price">-¥{{ item.totalPrice - item.totalGroupPrice }}</view>
                    </view>
                </view> -->

                <!-- 优惠券：立减 -->
                <!-- <view
                    class="pol-trip-order-sum-block"
                    wx:if="{{ item.t_lijian.value > 0 }}"
                >
                    <image
                        mode="widthFix"
                        class="pol-tips-img"
                        wx:if="{{ item.t_lijian.canUsed }}"
                        src="https://global-1257764567.cos.ap-guangzhou.myqcloud.com/icon-right.png"                    />
                    <view class="pol-trip-order-sum">
                        无门槛立减：
                    </view>
                    <view class="pol-trip-order-totalprice">
                        <view class="pol-pay-price small">减¥{{ item.t_lijian.value }}</view>
                    </view>
                </view> -->

                <!-- 优惠券：满减 -->
                <!-- <view
                    class="pol-trip-order-sum-block"
                >
                    <image
                        mode="widthFix"
                        class="pol-tips-img"
                        wx:if="{{ item.t_manjian.canUsed }}"
                        src="https://global-1257764567.cos.ap-guangzhou.myqcloud.com/icon-right.png"
                    />
                    <view class="pol-trip-order-sum">
                        满减券：满¥{{ item.t_manjian.atleast }}
                    </view>
                    <view class="pol-trip-order-totalprice">
                        <view class="pol-pay-price small">减¥{{ item.t_manjian.value }}</view>
                    </view>
                </view> -->

                <!-- 优惠券：代金券 -->
                <!-- <view
                    class="pol-trip-order-sum-block"
                    wx:if="{{ item.t_daijin.value > 0 }}"
                >
                    <image
                        mode="widthFix"
                        class="pol-tips-img"
                        wx:if="{{ item.t_daijin.canUsed }}"
                        src="https://global-1257764567.cos.ap-guangzhou.myqcloud.com/icon-right.png"                    />
                    <view class="pol-trip-order-sum">
                        代金券：满¥{{ item.t_daijin.atleast }}
                    </view>
                    <view class="pol-trip-order-totalprice">
                        <view class="pol-pay-price small">减¥{{ item.t_daijin.value }}</view>
                    </view>
                </view> -->

                <!-- 预估最终结算信息 -->
                <!-- <view
                    wx:if="{{ item.tripStatusCN !== '待付尾款' }}"
                    class="pol-trip-order-sum-block"
                >
                    <view class="pol-trip-order-sum">
                        预计：
                    </view>
                    <view class="pol-trip-order-totalprice">
                        <view class="pol-pay-price">
                           
                            {{ 
                                item.totalGroupPrice ===  item.totalPrice ?
                                    '¥' + item.totalGroupPrice : 
                                    '¥' + item.totalGroupPrice + '~' + item.totalPrice
                            }}
                        </view>
                    </view>
                </view> -->

                <!-- 结算最终 -->
                <view
                    wx:if="{{ item.tripStatusCN.indexOf('已付款') === 0 }}"
                    class="pol-trip-order-sum-block"
                >
                    <view class="pol-trip-order-sum">
                        合计：
                    </view>
                    <view class="pol-trip-order-totalprice">
                        <view class="pol-pay-price">¥{{ item.totalPrice }}</view>
                    </view>
                </view>

                <!-- 其他按钮 -->
                <view class="pol-trip-order-btn-block">
                    <view class="pol-order-more">
                        <!-- 更多 -->
                    </view>
                    <view class="pol-trip-order-btns">

                        <view
                            bindtap="concact"
                            class="pol-trip-order-btn"
                        >
                            联系客服
                        </view>
                        
                        <!-- 订金按钮 -->
                        <view
                            bindtap="payLastDepositPrice"
                            data-data="{{ item }}"
                            wx:if="{{ item.tripStatusCN === '待付订金' }}"
                            class="pol-trip-order-btn purple"
                        >
                            订金 {{ item.lastDepositPrice || 0 }}
                        </view>

                        <!-- 尾款按钮 -->
                        <view
                            wx:if="{{ item.tripStatusCN === '待付尾款' }}"
                            class="pol-trip-order-btn purple"
                        >
                            付尾款 ¥{{ item.lastPrice || 0 }}
                        </view>

                        <!-- 查看物流 -->
                        <view
                            bindtap="goDeliver"
                            data-tid="{{ item.tid }}"
                            class="pol-trip-order-btn purple"
                            wx:if="{{ item.tripStatusCN.indexOf('部分发货') === 0 || item.tripStatusCN.indexOf('已发货') === 0 }}"
                        >
                            查看物流 
                        </view>


                    </view>
                </view>

            </view>

        </view>

    </view>

</view>