"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_js_1 = require("../../util/http.js");
var index_js_1 = require("../../lib/vuefy/index.js");
var route_js_1 = require("../../util/route.js");
var app = getApp();
var storageKey = 'trip-has-reward-list';
Page({
    data: {
        tid: '',
        openid: '',
        ipAvatar: '',
        ipName: '',
        isAdm: false,
        isAuth: false,
        loading: true,
        swiperIndex: 0,
        showDanmu: false,
        list: [],
        showHongbao: 'hide',
        hasGet: true
    },
    runComputed: function () {
        index_js_1.computed(this, {
            social$: function () {
                var avatar = 'https://wx.qlogo.cn/mmopen/vi_32/IejMVZTG8WlibHicHIVQhqcNeC4uBxkzH0FFTbRLMicxib8wrxRRWoJY3gvctylATdmAPhiaVicU4sH0NptSszBdyHiaA/132';
                var getRandom = function (n) { return Math.floor(Math.random() * n); };
                var allTexts = [
                    "\u68D2! \u62FC\u56E2\u7684\u7FA4\u53CB\u771F\u7ED9\u529B",
                    "\u54C7! \u548C\u7FA4\u53CB\u62FC\u56E2\u597D\u5212\u7B97",
                    "\u54C8! \u4E0B\u6B21\u7EE7\u7EED\u7528\u7FA4\u62FC\u56E2"
                ];
                var visitors = [
                    avatar,
                    avatar
                ];
                var allVisitors = visitors
                    .map(function (x) {
                    var randomNum = getRandom(allTexts.length);
                    return {
                        avatar: x,
                        text: allTexts[randomNum]
                    };
                });
                return allVisitors;
            },
            others$: function () {
                var _this = this;
                var _a = this.data, list = _a.list, openid = _a.openid;
                var otherList = list
                    .filter(function (x) {
                    return !x.users.find(function (y) { return y.openid === openid; });
                })
                    .sort(function (x, y) {
                    return y.users.length - x.users.length;
                });
                var r = otherList.map(function (sl) { return _this.transferSl(sl); });
                var result = r.map(function (x) {
                    var pid = x.pid, goodImg = x.goodImg, buyer = x.buyer, totalDelta = x.totalDelta, name = x.name, title = x.title;
                    return {
                        pid: pid,
                        img: goodImg,
                        topTips: (buyer.length > 1 ? buyer.length + '人' : '') + "\u7701" + totalDelta + "\u5143",
                        bottomTips: buyer.length + "\u7FA4\u53CB\u62FC\u56E2",
                        avatars: buyer.map(function (y) { return y.avatar; }),
                        title: "" + (name ? name + ' ' : '') + title
                    };
                });
                return result;
            },
            personal$: function () {
                var _this = this;
                var _a = this.data, list = _a.list, openid = _a.openid;
                var allTexts = [
                    "\u771F\u7ED9\u529B",
                    "\u8C22\u8C22\u4F60",
                    "\u5212\u7B97\uFF5E",
                    "\u68D2!",
                    "\u8D5E!",
                    "\u8D5A!"
                ];
                var myList = list
                    .filter(function (x) {
                    return x.users.find(function (y) { return y.openid === openid; });
                })
                    .sort(function (x, y) {
                    return y.users.length - x.users.length;
                });
                var r = myList.map(function (sl) { return _this.transferSl(sl, allTexts); });
                return r;
            },
            all$: function () {
                var _this = this;
                var list = this.data.list;
                var allTexts = [
                    "\u771F\u7ED9\u529B",
                    "\u8C22\u8C22\u4F60",
                    "\u5212\u7B97\uFF5E",
                    "\u68D2!",
                    "\u8D5E!",
                    "\u8D5A!"
                ];
                var r = list.map(function (sl) { return _this.transferSl(sl, allTexts); });
                return r;
            },
            summary$: function () {
                var _this = this;
                var _a = this.data, list = _a.list, openid = _a.openid;
                var allSl = list.map(function (sl) { return _this.transferSl(sl); });
                var mySL = list
                    .filter(function (x) {
                    return x.users.find(function (y) { return y.openid === openid; });
                })
                    .map(function (sl) { return _this.transferSl(sl); });
                var r = {
                    groupTotalDelta: allSl.reduce(function (x, y) {
                        return x + (y.buyer.length > 1 ? y.totalDelta : 0);
                    }, 0),
                    myTotalDelta: mySL.reduce(function (x, y) { return x + y.successDelta; }, 0)
                };
                return r;
            },
            hongbao$: function () {
                var _a = this.data, list = _a.list, openid = _a.openid;
                var myList = list
                    .filter(function (x) {
                    return x.users.find(function (y) { return y.openid === openid; });
                });
                var hasBuy = myList.length > 0;
                var gift = hasBuy ? 1.24 : 0.88;
                var somePinSuccess = myList.some(function (x) { return x.users.length > 1; });
                var title = hasBuy && somePinSuccess ?
                    '拼团成功' :
                    hasBuy && !somePinSuccess ?
                        '差点拼成' :
                        '群拼团 省钱!';
                var summary = hasBuy && somePinSuccess ?
                    '省钱啦！请再接再厉~' :
                    hasBuy && !somePinSuccess ?
                        '莫灰心！多邀请群友拼团' :
                        '下次跟着群友拼';
                return {
                    gift: gift,
                    title: title,
                    summary: summary
                };
            }
        });
    },
    watchStore: function () {
        var _this = this;
        app.watch$('appConfig', function (val) {
            if (!!val) {
                _this.setTitle((val['ip-name'] || '') + "\u7FA4\u62FC\u56E2");
                _this.setData({
                    ipName: val['ip-name'],
                    ipAvatar: "" + (val['ip-avatar'] || '')
                });
            }
        });
        app.watch$('openid', function (val) {
            !!val && _this.setData({
                openid: val
            });
        });
        app.watch$('isUserAuth', function (val) {
            if (val === undefined) {
                return;
            }
            _this.setData({
                isAuth: val
            });
        });
        app.watch$('role', function (val) {
            if (val === 0) {
                wx.hideShareMenu({});
            }
            else {
                wx.showShareMenu({
                    withShareTicket: false
                });
            }
        });
    },
    fetchShopping: function (tid) {
        var _this = this;
        if (!tid) {
            return;
        }
        http_js_1.http({
            url: 'shopping-list_pin',
            data: {
                tid: tid,
                detail: true,
                showUser: true
            },
            success: function (res) {
                var status = res.status, data = res.data;
                if (status !== 200) {
                    return;
                }
                _this.setData({
                    list: data,
                    loading: false,
                    showHongbao: 'show'
                });
            }
        });
    },
    fetchGetGift: function () {
        var _this = this;
        var _a = this.data, tid = _a.tid, hasGet = _a.hasGet;
        var hongbao$ = this.data.hongbao$;
        if (hasGet) {
            wx.showToast({
                title: '已领取'
            });
            return this.toggleHongbao();
        }
        http_js_1.http({
            url: 'common_get-integral',
            data: {
                integral: hongbao$.gift
            },
            loadingMsg: '领取中...',
            success: function (res) {
                var status = res.status;
                if (status !== 200) {
                    return;
                }
                wx.showToast({
                    title: '领取成功'
                });
                _this.toggleHongbao();
                _this.setTripReward(tid);
                _this.checkIsGet(tid);
            }
        });
    },
    setTitle: function (title) {
        if (!title) {
            return;
        }
        wx.setNavigationBarTitle({
            title: title
        });
    },
    transferSl: function (sl, allTexts) {
        if (allTexts === void 0) { allTexts = []; }
        var pid = sl.pid, adjustGroupPrice = sl.adjustGroupPrice, adjustPrice = sl.adjustPrice, users = sl.users, detail = sl.detail;
        var delta = adjustGroupPrice ? Math.ceil(adjustPrice - adjustGroupPrice) : 0;
        var totalDelta = delta * users.length;
        var getRandom = function (n) { return Math.floor(Math.random() * n); };
        return {
            pid: pid,
            price: adjustPrice,
            groupPrice: adjustGroupPrice,
            fadePrice: detail.good.fadePrice,
            title: detail.title,
            name: detail.name || '',
            goodImg: detail.img,
            delta: delta,
            totalDelta: totalDelta,
            successDelta: users.length > 1 ? delta : 0,
            buyer: users.map(function (x) { return ({
                name: x.nickName,
                avatar: x.avatarUrl
            }); }),
            pinSuccess: users.length > 1,
            tips: allTexts[getRandom(allTexts.length)],
            tipsIndex: getRandom(users.length > 4 ? 3 : users.length - 1) + 1
        };
    },
    toggleHongbao: function () {
        var showHongbao = this.data.showHongbao;
        this.setData({
            showHongbao: showHongbao === 'show' ? 'hide' : 'show'
        });
    },
    goGoodDetail: function (e) {
        var data = e.currentTarget.dataset.data;
        route_js_1.navTo("/pages/goods-detail/index?id=" + data.pid);
    },
    goHome: function () {
        route_js_1.navTo("/pages/trip-enter/index");
    },
    onSubscribe: function () {
        app.getSubscribe('buyPin,hongbao,trip');
        this.fetchGetGift();
    },
    getUserAuth: function () {
        var _this = this;
        app.getWxUserInfo(function () {
            _this.fetchGetGift();
        });
    },
    setTripReward: function (tid) {
        var tripSum = 10;
        var hasRewardList = JSON.parse(wx.getStorageSync(storageKey) || '[ ]');
        hasRewardList.unshift(tid);
        wx.setStorageSync(storageKey, JSON.stringify(hasRewardList.slice(0, tripSum)));
    },
    checkIsGet: function (tid) {
        var hasRewardList = JSON.parse(wx.getStorageSync(storageKey) || '[ ]');
        this.setData({
            hasGet: hasRewardList.includes(tid)
        });
    },
    onSwiper: function (e) {
        var current = e.detail.current;
        this.setData({
            swiperIndex: current
        });
    },
    onScroll: function (e) {
        var showDanmu = this.data.showDanmu;
        var scrollTop = e.detail.scrollTop;
        if (!!showDanmu) {
            return;
        }
        if (scrollTop > 100) {
            this.setData({
                showDanmu: true
            });
        }
    },
    onLoad: function (query) {
        var tid = query.tid || "e8f863ba5de6241400076921441bc8d5";
        this.watchStore();
        this.runComputed();
        this.setData({
            tid: tid
        });
        this.checkIsGet(tid);
        this.fetchShopping(tid);
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
    onShareAppMessage: function (e) {
        var _a = this.data, ipName = _a.ipName, tid = _a.tid, isAdm = _a.isAdm;
        return {
            title: (ipName || '群拼团') + "\u56DE\u62A5\u5927\u5BB6\u5566 \u70B9\u51FB\u9886\u53D6\u62B5\u73B0\u91D1",
            imageUrl: 'https://global-1257764567.cos.ap-guangzhou.myqcloud.com/bg-trip-reward-share-colorful.jpg',
            path: "/pages/trip-reward/index?tid=" + tid
        };
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDhDQUEwQztBQUMxQyxxREFBb0Q7QUFFcEQsZ0RBQTRDO0FBRTVDLElBQU0sR0FBRyxHQUFHLE1BQU0sRUFBUSxDQUFDO0FBQzNCLElBQU0sVUFBVSxHQUFHLHNCQUFzQixDQUFDO0FBRTFDLElBQUksQ0FBQztJQUVELElBQUksRUFBRTtRQUVGLEdBQUcsRUFBRSxFQUFFO1FBRVAsTUFBTSxFQUFFLEVBQUU7UUFFVixRQUFRLEVBQUUsRUFBRTtRQUVaLE1BQU0sRUFBRSxFQUFFO1FBRVYsS0FBSyxFQUFFLEtBQUs7UUFLWixNQUFNLEVBQUUsS0FBSztRQUtiLE9BQU8sRUFBRSxJQUFJO1FBS2IsV0FBVyxFQUFFLENBQUM7UUFLZCxTQUFTLEVBQUUsS0FBSztRQUtoQixJQUFJLEVBQUUsRUFBRztRQUtULFdBQVcsRUFBRSxNQUFNO1FBS25CLE1BQU0sRUFBRSxJQUFJO0tBRWY7SUFFRCxXQUFXO1FBQ1AsbUJBQVEsQ0FBRSxJQUFJLEVBQUU7WUFHWixPQUFPO2dCQUNILElBQU0sTUFBTSxHQUFHLG9JQUFvSSxDQUFDO2dCQUNwSixJQUFNLFNBQVMsR0FBRyxVQUFBLENBQUMsSUFBSSxPQUFBLElBQUksQ0FBQyxLQUFLLENBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRyxHQUFHLENBQUMsQ0FBRSxFQUFoQyxDQUFnQyxDQUFDO2dCQUN4RCxJQUFNLFFBQVEsR0FBRztvQkFDYiwwREFBYTtvQkFDYiwwREFBYTtvQkFDYiwwREFBYTtpQkFDaEIsQ0FBQztnQkFFRixJQUFNLFFBQVEsR0FBRztvQkFDYixNQUFNO29CQUNOLE1BQU07aUJBQ1QsQ0FBQztnQkFDRixJQUFNLFdBQVcsR0FBRyxRQUFRO3FCQUN2QixHQUFHLENBQUUsVUFBQSxDQUFDO29CQUNILElBQU0sU0FBUyxHQUFHLFNBQVMsQ0FBRSxRQUFRLENBQUMsTUFBTSxDQUFF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QUFJLEtBQUssK0VBQWU7WUFDeEMsUUFBUSxFQUFFLDJGQUEyRjtZQUNyRyxJQUFJLEVBQUUsa0NBQWdDLEdBQUs7U0FDOUMsQ0FBQztJQUNOLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IGh0dHAgfSBmcm9tICcuLi8uLi91dGlsL2h0dHAuanMnO1xuaW1wb3J0IHsgY29tcHV0ZWQgfSBmcm9tICcuLi8uLi9saWIvdnVlZnkvaW5kZXguanMnO1xuaW1wb3J0IHsgZGVsYXllcmluZ0dvb2QgfSBmcm9tICcuLi8uLi91dGlsL2dvb2RzLmpzJztcbmltcG9ydCB7IG5hdlRvIH0gZnJvbSAnLi4vLi4vdXRpbC9yb3V0ZS5qcyc7XG5cbmNvbnN0IGFwcCA9IGdldEFwcDxhbnk+KCApO1xuY29uc3Qgc3RvcmFnZUtleSA9ICd0cmlwLWhhcy1yZXdhcmQtbGlzdCc7XG5cblBhZ2Uoe1xuXG4gICAgZGF0YToge1xuXG4gICAgICAgIHRpZDogJycsXG5cbiAgICAgICAgb3BlbmlkOiAnJyxcblxuICAgICAgICBpcEF2YXRhcjogJycsXG5cbiAgICAgICAgaXBOYW1lOiAnJyxcblxuICAgICAgICBpc0FkbTogZmFsc2UsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIOaYr+WQpuacieeUqOaIt+aOiOadg1xuICAgICAgICAgKi9cbiAgICAgICAgaXNBdXRoOiBmYWxzZSxcblxuICAgICAgICAvKipcbiAgICAgICAgICog5Yqg6L29XG4gICAgICAgICAqL1xuICAgICAgICBsb2FkaW5nOiB0cnVlLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlhbbku5bkurrmuIXljZXnmoQgc3dpcGVyXG4gICAgICAgICAqL1xuICAgICAgICBzd2lwZXJJbmRleDogMCxcblxuICAgICAgICAvKipcbiAgICAgICAgICog5piv5ZCm5bGV56S65by55bmVXG4gICAgICAgICAqL1xuICAgICAgICBzaG93RGFubXU6IGZhbHNlLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDotK3nianmuIXljZVcbiAgICAgICAgICovXG4gICAgICAgIGxpc3Q6IFsgXSxcblxuICAgICAgICAvKipcbiAgICAgICAgICog5bGV56S657qi5YyFXG4gICAgICAgICAqL1xuICAgICAgICBzaG93SG9uZ2JhbzogJ2hpZGUnLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDmmK/lkKblt7Lnu4/pooblj5bov4fnuqLljIXkuoZcbiAgICAgICAgICovXG4gICAgICAgIGhhc0dldDogdHJ1ZVxuXG4gICAgfSxcblxuICAgIHJ1bkNvbXB1dGVkKCApIHtcbiAgICAgICAgY29tcHV0ZWQoIHRoaXMsIHtcblxuICAgICAgICAgICAgLy8g6LSt5Lmw6K6w5b2VICsg56S+5Lqk5bGe5oCn5qih5Z2XXG4gICAgICAgICAgICBzb2NpYWwkKCApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhdmF0YXIgPSAnaHR0cHM6Ly93eC5xbG9nby5jbi9tbW9wZW4vdmlfMzIvSWVqTVZaVEc4V2xpYkhpY0hJVlFocWNOZUM0dUJ4a3pIMEZGVGJSTE1pY3hpYjh3cnhSUldvSlkzZ3ZjdHlsQVRkbUFQaGlhVmljVTRzSDBOcHRTc3pCZHlIaWFBLzEzMic7XG4gICAgICAgICAgICAgICAgY29uc3QgZ2V0UmFuZG9tID0gbiA9PiBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSggKSAqIG4gKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxUZXh0cyA9IFtcbiAgICAgICAgICAgICAgICAgICAgYOajkiEg5ou85Zui55qE576k5Y+L55yf57uZ5YqbYCxcbiAgICAgICAgICAgICAgICAgICAgYOWThyEg5ZKM576k5Y+L5ou85Zui5aW95YiS566XYCxcbiAgICAgICAgICAgICAgICAgICAgYOWTiCEg5LiL5qyh57un57ut55So576k5ou85ZuiYFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc3QgdmlzaXRvcnMgPSBbXG4gICAgICAgICAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxWaXNpdG9ycyA9IHZpc2l0b3JzXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoIHggPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFuZG9tTnVtID0gZ2V0UmFuZG9tKCBhbGxUZXh0cy5sZW5ndGggKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyOiB4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGFsbFRleHRzWyByYW5kb21OdW0gXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHJldHVybiBhbGxWaXNpdG9ycztcblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLy8g5YW25LuW5Lq655qE6LSt54mp5riF5Y2VXG4gICAgICAgICAgICBvdGhlcnMkKCApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxpc3QsIG9wZW5pZCB9ID0gdGhpcy5kYXRhO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJMaXN0ID0gbGlzdFxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKCB4ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAheC51c2Vycy5maW5kKCB5ID0+IHkub3BlbmlkID09PSBvcGVuaWQgKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQoKCB4LCB5ICkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHkudXNlcnMubGVuZ3RoIC0geC51c2Vycy5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG90aGVyTGlzdC5tYXAoIHNsID0+IHRoaXMudHJhbnNmZXJTbCggc2wgKSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSByLm1hcCggeCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgcGlkLCBnb29kSW1nLCBidXllciwgdG90YWxEZWx0YSwgbmFtZSwgdGl0bGUgfSA9IHg7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGdvb2RJbWcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3BUaXBzOiBgJHtidXllci5sZW5ndGggPiAxID8gYnV5ZXIubGVuZ3RoICsgJ+S6uicgOiAnJ33nnIEke3RvdGFsRGVsdGF95YWDYCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbVRpcHM6IGAke2J1eWVyLmxlbmd0aH3nvqTlj4vmi7zlm6JgLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyczogYnV5ZXIubWFwKCB5ID0+IHkuYXZhdGFyICksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYCR7bmFtZSA/IG5hbWUgKyAnICcgOiAnJ30ke3RpdGxlfWBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIOS4quS6uui0reeJqea4heWNlVxuICAgICAgICAgICAgcGVyc29uYWwkKCApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxpc3QsIG9wZW5pZCB9ID0gdGhpcy5kYXRhO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbFRleHRzID0gW1xuICAgICAgICAgICAgICAgICAgICBg55yf57uZ5YqbYCxcbiAgICAgICAgICAgICAgICAgICAgYOiwouiwouS9oGAsXG4gICAgICAgICAgICAgICAgICAgIGDliJLnrpfvvZ5gLFxuICAgICAgICAgICAgICAgICAgICBg5qOSIWAsXG4gICAgICAgICAgICAgICAgICAgIGDotZ4hYCxcbiAgICAgICAgICAgICAgICAgICAgYOi1miFgXG4gICAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG15TGlzdCA9IGxpc3RcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlciggeCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geC51c2Vycy5maW5kKCB5ID0+IHkub3BlbmlkID09PSBvcGVuaWQgKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQoKCB4LCB5ICkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHkudXNlcnMubGVuZ3RoIC0geC51c2Vycy5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByID0gbXlMaXN0Lm1hcCggc2wgPT4gdGhpcy50cmFuc2ZlclNsKCBzbCwgYWxsVGV4dHMgKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyDmiYDmnInkurrnmoTotK3nianmuIXljZVcbiAgICAgICAgICAgIGFsbCQoICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGlzdCB9ID0gdGhpcy5kYXRhO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbFRleHRzID0gW1xuICAgICAgICAgICAgICAgICAgICBg55yf57uZ5YqbYCxcbiAgICAgICAgICAgICAgICAgICAgYOiwouiwouS9oGAsXG4gICAgICAgICAgICAgICAgICAgIGDliJLnrpfvvZ5gLFxuICAgICAgICAgICAgICAgICAgICBg5qOSIWAsXG4gICAgICAgICAgICAgICAgICAgIGDotZ4hYCxcbiAgICAgICAgICAgICAgICAgICAgYOi1miFgXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gbGlzdC5tYXAoIHNsID0+IHRoaXMudHJhbnNmZXJTbCggc2wsIGFsbFRleHRzICkpO1xuICAgICAgICAgICAgICAgIHJldHVybiByO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLy8g6KGM56iL5riF5Y2V5oC75qaC5Ya1XG4gICAgICAgICAgICBzdW1tYXJ5JCggKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBsaXN0LCBvcGVuaWQgfSA9IHRoaXMuZGF0YTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbFNsID0gbGlzdC5tYXAoIHNsID0+IHRoaXMudHJhbnNmZXJTbCggc2wgKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbXlTTCA9IGxpc3RcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlciggeCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geC51c2Vycy5maW5kKCB5ID0+IHkub3BlbmlkID09PSBvcGVuaWQgKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCggc2wgPT4gdGhpcy50cmFuc2ZlclNsKCBzbCApKTtcblxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIOaJgOaciee+pOWPi++8jOS4gOWFseecgeS6huWkmuWwkVxuICAgICAgICAgICAgICAgICAgICBncm91cFRvdGFsRGVsdGE6IGFsbFNsLnJlZHVjZSgoIHgsIHkgKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geCArICggeS5idXllci5sZW5ndGggPiAxID8geS50b3RhbERlbHRhIDogMCApO1xuICAgICAgICAgICAgICAgICAgICB9LCAwICksXG4gICAgICAgICAgICAgICAgICAgIC8vIOaIkeS4gOWFseecgeS6huWkmuWwkVxuICAgICAgICAgICAgICAgICAgICBteVRvdGFsRGVsdGE6IG15U0wucmVkdWNlKCggeCwgeSApID0+IHggKyB5LnN1Y2Nlc3NEZWx0YSwgMCApXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIOaKteeOsOmHkeeahOWlluWKsemHkeminVxuICAgICAgICAgICAgaG9uZ2JhbyQoICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGlzdCwgb3BlbmlkIH0gPSB0aGlzLmRhdGE7XG5cbiAgICAgICAgICAgICAgICAvLyDmiJHnmoTotK3nianmuIXljZVcbiAgICAgICAgICAgICAgICBjb25zdCBteUxpc3QgPSBsaXN0XG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoIHggPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHgudXNlcnMuZmluZCggeSA9PiB5Lm9wZW5pZCA9PT0gb3BlbmlkICk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8g5piv5ZCm5pyJ5Lmw6L+H5Lic6KW/XG4gICAgICAgICAgICAgICAgY29uc3QgaGFzQnV5ID0gbXlMaXN0Lmxlbmd0aCA+IDA7XG5cbiAgICAgICAgICAgICAgICAvLyDlpZblirHph5Hpop1cbiAgICAgICAgICAgICAgICBjb25zdCBnaWZ0ID0gaGFzQnV5ID8gMS4yNCA6IDAuODg7XG5cbiAgICAgICAgICAgICAgICAvLyDmmK/lkKbmnInmi7zlm6LmiJDlip9cbiAgICAgICAgICAgICAgICBjb25zdCBzb21lUGluU3VjY2VzcyA9IG15TGlzdC5zb21lKCB4ID0+IHgudXNlcnMubGVuZ3RoID4gMSApO1xuXG4gICAgICAgICAgICAgICAgLy8g5paH5qGIMVxuICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gaGFzQnV5ICYmIHNvbWVQaW5TdWNjZXNzID9cbiAgICAgICAgICAgICAgICAgICAgJ+aLvOWbouaIkOWKnycgOlxuICAgICAgICAgICAgICAgICAgICBoYXNCdXkgJiYgIXNvbWVQaW5TdWNjZXNzID9cbiAgICAgICAgICAgICAgICAgICAgICAgICflt67ngrnmi7zmiJAnIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICfnvqTmi7zlm6Ig55yB6ZKxISc7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8g5paH5a6JMlxuICAgICAgICAgICAgICAgIGNvbnN0IHN1bW1hcnkgPSBoYXNCdXkgJiYgc29tZVBpblN1Y2Nlc3MgP1xuICAgICAgICAgICAgICAgICAgICAn55yB6ZKx5ZWm77yB6K+35YaN5o6l5YaN5Y6JficgOlxuICAgICAgICAgICAgICAgICAgICBoYXNCdXkgJiYgIXNvbWVQaW5TdWNjZXNzID9cbiAgICAgICAgICAgICAgICAgICAgICAgICfojqvngbDlv4PvvIHlpJrpgoDor7fnvqTlj4vmi7zlm6InIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICfkuIvmrKHot5/nnYDnvqTlj4vmi7wnO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZ2lmdCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHN1bW1hcnlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOebkeWQrHN0b3JlXG4gICAgICovXG4gICAgd2F0Y2hTdG9yZSggKSB7XG4gICAgICAgIGFwcC53YXRjaCQoJ2FwcENvbmZpZycsIHZhbCA9PiB7XG4gICAgICAgICAgICBpZiAoICEhdmFsICkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGl0bGUoYCR7dmFsWydpcC1uYW1lJ10gfHwgJyd9576k5ou85ZuiYClcbiAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICAgICAgICAgICAgaXBOYW1lOiB2YWxbJ2lwLW5hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgaXBBdmF0YXI6IGAke3ZhbFsnaXAtYXZhdGFyJ10gfHwgJyd9YFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBhcHAud2F0Y2gkKCdvcGVuaWQnLCB2YWwgPT4ge1xuICAgICAgICAgICAgISF2YWwgJiYgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgICAgb3BlbmlkOiB2YWxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgICBhcHAud2F0Y2gkKCdpc1VzZXJBdXRoJywgdmFsID0+IHtcbiAgICAgICAgICAgIGlmICggdmFsID09PSB1bmRlZmluZWQgKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgICAgaXNBdXRoOiB2YWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYXBwLndhdGNoJCgncm9sZScsIHZhbCA9PiB7XG4gICAgICAgICAgICBpZiAoIHZhbCA9PT0gMCApIHtcbiAgICAgICAgICAgICAgICB3eC5oaWRlU2hhcmVNZW51KHsgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHd4LnNob3dTaGFyZU1lbnUoe1xuICAgICAgICAgICAgICAgICAgICB3aXRoU2hhcmVUaWNrZXQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKiogXG4gICAgICog5ouJ5Y+W6KGM56iL55qE6LSt54mp6K+35Y2V5L+h5oGvXG4gICAgICovXG4gICAgZmV0Y2hTaG9wcGluZyggdGlkICkge1xuICAgICAgICBpZiAoICF0aWQgKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGh0dHAoe1xuICAgICAgICAgICAgdXJsOiAnc2hvcHBpbmctbGlzdF9waW4nLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHRpZCxcbiAgICAgICAgICAgICAgICBkZXRhaWw6IHRydWUsXG4gICAgICAgICAgICAgICAgc2hvd1VzZXI6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgc3RhdHVzLCBkYXRhIH0gPSByZXM7XG4gICAgICAgICAgICAgICAgaWYgKCBzdGF0dXMgIT09IDIwMCApIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgICAgICAgIGxpc3Q6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBzaG93SG9uZ2JhbzogJ3Nob3cnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOmihuWPlue6ouWMhVxuICAgICAqL1xuICAgIGZldGNoR2V0R2lmdCggKSB7XG4gICAgICAgIGNvbnN0IHsgdGlkLCBoYXNHZXQgfSA9IHRoaXMuZGF0YTtcbiAgICAgICAgY29uc3QgaG9uZ2JhbyQgPSAodGhpcyBhcyBhbnkpLmRhdGEuaG9uZ2JhbyQ7XG5cbiAgICAgICAgaWYgKCBoYXNHZXQgKSB7XG4gICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAn5bey6aKG5Y+WJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b2dnbGVIb25nYmFvKCApO1xuICAgICAgICB9XG5cbiAgICAgICAgaHR0cCh7XG4gICAgICAgICAgICB1cmw6ICdjb21tb25fZ2V0LWludGVncmFsJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBpbnRlZ3JhbDogaG9uZ2JhbyQuZ2lmdFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxvYWRpbmdNc2c6ICfpooblj5bkuK0uLi4nLFxuICAgICAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHN0YXR1cyB9ID0gcmVzO1xuICAgICAgICAgICAgICAgIGlmICggc3RhdHVzICE9PSAyMDAgKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfpooblj5bmiJDlip8nXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZUhvbmdiYW8oICk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRUcmlwUmV3YXJkKCB0aWQgKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrSXNHZXQoIHRpZCApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqIFxuICAgICAqIOiuvue9ruagh+mimFxuICAgICAqL1xuICAgIHNldFRpdGxlKCB0aXRsZTogc3RyaW5nICkge1xuICAgICAgICBpZiAoICF0aXRsZSApIHsgcmV0dXJuOyB9XG4gICAgICAgIHd4LnNldE5hdmlnYXRpb25CYXJUaXRsZSh7XG4gICAgICAgICAgICB0aXRsZVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6L2s5o2i5qC85byPXG4gICAgICovXG4gICAgdHJhbnNmZXJTbCggc2wsIGFsbFRleHRzID0gWyBdKSB7XG5cbiAgICAgICAgY29uc3QgeyBwaWQsIGFkanVzdEdyb3VwUHJpY2UsIGFkanVzdFByaWNlLCB1c2VycywgZGV0YWlsIH0gPSBzbDtcbiAgICAgICAgY29uc3QgZGVsdGEgPSBhZGp1c3RHcm91cFByaWNlID8gTWF0aC5jZWlsKCBhZGp1c3RQcmljZSAtIGFkanVzdEdyb3VwUHJpY2UgKSA6IDA7XG4gICAgICAgIGNvbnN0IHRvdGFsRGVsdGEgPSBkZWx0YSAqIHVzZXJzLmxlbmd0aDtcblxuICAgICAgICBjb25zdCBnZXRSYW5kb20gPSBuID0+IE1hdGguZmxvb3IoIE1hdGgucmFuZG9tKCApICogbiApO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBwaWQsXG4gICAgICAgICAgICBwcmljZTogYWRqdXN0UHJpY2UsXG4gICAgICAgICAgICBncm91cFByaWNlOiBhZGp1c3RHcm91cFByaWNlLFxuICAgICAgICAgICAgZmFkZVByaWNlOiBkZXRhaWwuZ29vZC5mYWRlUHJpY2UsXG4gICAgICAgICAgICB0aXRsZTogZGV0YWlsLnRpdGxlLFxuICAgICAgICAgICAgbmFtZTogZGV0YWlsLm5hbWUgfHwgJycsXG4gICAgICAgICAgICBnb29kSW1nOiBkZXRhaWwuaW1nLFxuICAgICAgICAgICAgLy8g5oC75beu5YC8XG4gICAgICAgICAgICBkZWx0YSwgXG4gICAgICAgICAgICAvLyDotK3nianmuIXljZXmgLvlt67lgLxcbiAgICAgICAgICAgIHRvdGFsRGVsdGEsXG4gICAgICAgICAgICAvLyDmiJHnmoTmiJDlip/mi7zlm6Llt67lgLxcbiAgICAgICAgICAgIHN1Y2Nlc3NEZWx0YTogdXNlcnMubGVuZ3RoID4gMSA/IGRlbHRhIDogMCxcbiAgICAgICAgICAgIGJ1eWVyOiB1c2Vycy5tYXAoIHggPT4gKHtcbiAgICAgICAgICAgICAgICBuYW1lOiB4Lm5pY2tOYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogeC5hdmF0YXJVcmxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgIHBpblN1Y2Nlc3M6IHVzZXJzLmxlbmd0aCA+IDEsXG4gICAgICAgICAgICB0aXBzOiBhbGxUZXh0c1sgZ2V0UmFuZG9tKCBhbGxUZXh0cy5sZW5ndGggKV0sXG4gICAgICAgICAgICB0aXBzSW5kZXg6IGdldFJhbmRvbSggdXNlcnMubGVuZ3RoID4gNCA/IDMgOiB1c2Vycy5sZW5ndGggLSAxICkgKyAxXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog5byA5YWz57qi5YyFXG4gICAgICovXG4gICAgdG9nZ2xlSG9uZ2JhbyggKSB7XG4gICAgICAgIGNvbnN0IHsgc2hvd0hvbmdiYW8gfSA9IHRoaXMuZGF0YTtcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICBzaG93SG9uZ2Jhbzogc2hvd0hvbmdiYW8gPT09ICdzaG93JyA/ICdoaWRlJyA6ICdzaG93J1xuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDot7PliLDllYblk4Hor6bmg4VcbiAgICAgKi9cbiAgICBnb0dvb2REZXRhaWwoIGUgKSB7XG4gICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XG4gICAgICAgIG5hdlRvKGAvcGFnZXMvZ29vZHMtZGV0YWlsL2luZGV4P2lkPSR7ZGF0YS5waWR9YClcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6L+U5Zue5Li76aG1XG4gICAgICovXG4gICAgZ29Ib21lKCApIHtcbiAgICAgICAgbmF2VG8oYC9wYWdlcy90cmlwLWVudGVyL2luZGV4YCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOiuoumYhVxuICAgICAqL1xuICAgIG9uU3Vic2NyaWJlKCApIHtcbiAgICAgICAgYXBwLmdldFN1YnNjcmliZSgnYnV5UGluLGhvbmdiYW8sdHJpcCcpO1xuICAgICAgICB0aGlzLmZldGNoR2V0R2lmdCggKTtcbiAgICB9LFxuXG4gICAgLyoqIFxuICAgICAqIOiOt+WPlueUqOaIt+aOiOadg1xuICAgICAqL1xuICAgIGdldFVzZXJBdXRoKCApIHtcbiAgICAgICAgYXBwLmdldFd4VXNlckluZm8oKCApID0+IHtcbiAgICAgICAgICAgIHRoaXMuZmV0Y2hHZXRHaWZ0KCApO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6K6+572u5bey6aKG5Y+W57qi5YyFXG4gICAgICog5LuF5L+d55WZMTDkuKrooYznqItpZFxuICAgICAqL1xuICAgIHNldFRyaXBSZXdhcmQoIHRpZCApIHtcbiAgICAgICAgY29uc3QgdHJpcFN1bSA9IDEwO1xuICAgICAgICBjb25zdCBoYXNSZXdhcmRMaXN0ID0gSlNPTi5wYXJzZSggd3guZ2V0U3RvcmFnZVN5bmMoIHN0b3JhZ2VLZXkgKSB8fCAnWyBdJyk7XG4gICAgICAgIGhhc1Jld2FyZExpc3QudW5zaGlmdCggdGlkICk7XG4gICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCBzdG9yYWdlS2V5LCBKU09OLnN0cmluZ2lmeSggaGFzUmV3YXJkTGlzdC5zbGljZSggMCwgdHJpcFN1bSApKSlcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog5qOA5p+l6K+l6Laf6KGM56iL6YeM6Z2iXG4gICAgICog5piv5ZCm5bey57uP6aKG5Y+W6L+H57qi5YyFXG4gICAgICovXG4gICAgY2hlY2tJc0dldCggdGlkICkge1xuICAgICAgICBjb25zdCBoYXNSZXdhcmRMaXN0ID0gSlNPTi5wYXJzZSggd3guZ2V0U3RvcmFnZVN5bmMoIHN0b3JhZ2VLZXkgKSB8fCAnWyBdJyk7XG4gICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgICAgaGFzR2V0OiBoYXNSZXdhcmRMaXN0LmluY2x1ZGVzKCB0aWQgKVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogc3dpcGVy55uR5ZCsXG4gICAgICovXG4gICAgb25Td2lwZXIoIGU6IGFueSApIHtcbiAgICAgICAgY29uc3QgeyBjdXJyZW50IH0gPSBlLmRldGFpbDtcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICBzd2lwZXJJbmRleDogY3VycmVudFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6aG16Z2i5rua5YqoXG4gICAgICovXG4gICAgb25TY3JvbGwoIGU6IGFueSApIHtcbiAgICAgICAgY29uc3QgeyBzaG93RGFubXUgfSA9IHRoaXMuZGF0YTtcbiAgICAgICAgY29uc3QgeyBzY3JvbGxUb3AgfSA9IGUuZGV0YWlsO1xuICAgICAgICBpZiAoICEhc2hvd0Rhbm11ICkgeyByZXR1cm47IH0gXG5cbiAgICAgICAgaWYgKCBzY3JvbGxUb3AgPiAxMDAgKSB7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICAgICAgICBzaG93RGFubXU6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHRpZCDooYznqItpZFxuICAgICAqL1xuICAgIG9uTG9hZDogZnVuY3Rpb24gKCBxdWVyeTogYW55ICkge1xuICAgICAgICBjb25zdCB0aWQgPSBxdWVyeS50aWQgfHwgXCJlOGY4NjNiYTVkZTYyNDE0MDAwNzY5MjE0NDFiYzhkNVwiO1xuICAgICAgICB0aGlzLndhdGNoU3RvcmUoICk7XG4gICAgICAgIHRoaXMucnVuQ29tcHV0ZWQoICk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICAgIHRpZFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmNoZWNrSXNHZXQoIHRpZCApO1xuICAgICAgICB0aGlzLmZldGNoU2hvcHBpbmcoIHRpZCApO1xuXG4gICAgfSxcbiAgXG4gICAgLyoqXG4gICAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliJ3mrKHmuLLmn5PlrozmiJBcbiAgICAgKi9cbiAgICBvblJlYWR5OiBmdW5jdGlvbiAoICkge1xuXG4gICAgfSxcbiAgXG4gICAgLyoqXG4gICAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcbiAgICAgKi9cbiAgICBvblNob3c6IGZ1bmN0aW9uICggKSB7XG5cbiAgICB9LFxuICBcbiAgICAvKipcbiAgICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdoumakOiXj1xuICAgICAqL1xuICAgIG9uSGlkZTogZnVuY3Rpb24gKCkge1xuICBcbiAgICB9LFxuICBcbiAgICAvKipcbiAgICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgICAqL1xuICAgIG9uVW5sb2FkOiBmdW5jdGlvbiAoKSB7XG4gIFxuICAgIH0sXG4gIFxuICAgIC8qKlxuICAgICAqIOmhtemdouebuOWFs+S6i+S7tuWkhOeQhuWHveaVsC0t55uR5ZCs55So5oi35LiL5ouJ5Yqo5L2cXG4gICAgICovXG4gICAgb25QdWxsRG93blJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcbiAgXG4gICAgfSxcbiAgXG4gICAgLyoqXG4gICAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXG4gICAgICovXG4gICAgb25SZWFjaEJvdHRvbTogZnVuY3Rpb24gKCkge1xuICBcbiAgICB9LFxuICBcbiAgICAvKipcbiAgICAgKiDnlKjmiLfngrnlh7vlj7PkuIrop5LliIbkuqtcbiAgICAgKi9cbiAgICBvblNoYXJlQXBwTWVzc2FnZTogZnVuY3Rpb24gKCBlICkge1xuICAgICAgICBjb25zdCB7IGlwTmFtZSwgdGlkLCBpc0FkbSB9ID0gdGhpcy5kYXRhO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IGAke2lwTmFtZSB8fCAn576k5ou85ZuiJ33lm57miqXlpKflrrbllaYg54K55Ye76aKG5Y+W5oq1546w6YeRYCxcbiAgICAgICAgICAgIGltYWdlVXJsOiAnaHR0cHM6Ly9nbG9iYWwtMTI1Nzc2NDU2Ny5jb3MuYXAtZ3Vhbmd6aG91Lm15cWNsb3VkLmNvbS9iZy10cmlwLXJld2FyZC1zaGFyZS1jb2xvcmZ1bC5qcGcnLFxuICAgICAgICAgICAgcGF0aDogYC9wYWdlcy90cmlwLXJld2FyZC9pbmRleD90aWQ9JHt0aWR9YFxuICAgICAgICB9O1xuICAgIH1cbiAgfSkiXX0=