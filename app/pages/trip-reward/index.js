"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_js_1 = require("../../util/http.js");
var index_js_1 = require("../../lib/vuefy/index.js");
var route_js_1 = require("../../util/route.js");
var app = getApp();
Page({
    data: {
        tid: '',
        openid: '',
        ipAvatar: '',
        loading: true,
        swiperIndex: 0,
        showDanmu: false,
        list: [],
        showHongbao: true
    },
    runComputed: function () {
        index_js_1.computed(this, {
            social$: function () {
                var avatar = 'https://wx.qlogo.cn/mmopen/vi_32/IejMVZTG8WlibHicHIVQhqcNeC4uBxkzH0FFTbRLMicxib8wrxRRWoJY3gvctylATdmAPhiaVicU4sH0NptSszBdyHiaA/132';
                var getRandom = function (n) { return Math.floor(Math.random() * n); };
                var allTexts = [
                    "\u68D2! \u62FC\u56E2\u7684\u7FA4\u53CB\u771F\u7ED9\u529B",
                    "\u54C7! \u548C\u7FA4\u53CB\u62FC\u56E2\u597D\u5212\u7B97",
                    "\u54C8! \u4E0B\u6B21\u7EE7\u7EED\u7528\u7FA4\u62FC\u56E2"
                ];
                var visitors = [
                    avatar,
                    avatar
                ];
                var allVisitors = visitors
                    .map(function (x) {
                    var randomNum = getRandom(allTexts.length);
                    return {
                        avatar: x,
                        text: allTexts[randomNum]
                    };
                });
                return allVisitors;
            },
            others$: function () {
                var _this = this;
                var _a = this.data, list = _a.list, openid = _a.openid;
                var otherList = list
                    .filter(function (x) {
                    return !x.users.find(function (y) { return y.openid === openid; });
                })
                    .sort(function (x, y) {
                    return y.users.length - x.users.length;
                });
                var r = otherList.map(function (sl) { return _this.transferSl(sl); });
                return r;
            },
            personal$: function () {
                var _this = this;
                var _a = this.data, list = _a.list, openid = _a.openid;
                var allTexts = [
                    "\u771F\u7ED9\u529B",
                    "\u8C22\u8C22\u4F60",
                    "\u5212\u7B97\uFF5E",
                    "\u68D2!",
                    "\u8D5E!",
                    "\u8D5A!"
                ];
                var myList = list
                    .filter(function (x) {
                    return x.users.find(function (y) { return y.openid === openid; });
                })
                    .sort(function (x, y) {
                    return y.users.length - x.users.length;
                });
                var r = myList.map(function (sl) { return _this.transferSl(sl, allTexts); });
                return r;
            },
            summary$: function () {
                var _this = this;
                var _a = this.data, list = _a.list, openid = _a.openid;
                var allSl = list.map(function (sl) { return _this.transferSl(sl); });
                var mySL = list
                    .filter(function (x) {
                    return x.users.find(function (y) { return y.openid === openid; });
                })
                    .map(function (sl) { return _this.transferSl(sl); });
                var r = {
                    groupTotalDelta: allSl.reduce(function (x, y) { return x + y.totalDelta; }, 0),
                    myTotalDelta: mySL.reduce(function (x, y) { return x + y.successDelta; }, 0)
                };
                return r;
            }
        });
    },
    watchStore: function () {
        var _this = this;
        app.watch$('appConfig', function (val) {
            if (!!val) {
                _this.setTitle((val['ip-name'] || '') + "\u7FA4\u62FC\u56E2");
                _this.setData({
                    ipAvatar: "" + (val['ip-avatar'] || '')
                });
            }
        });
        app.watch$('openid', function (val) {
            !!val && _this.setData({
                openid: val
            });
        });
    },
    fetchShopping: function (tid) {
        var _this = this;
        if (!tid) {
            return;
        }
        http_js_1.http({
            url: 'shopping-list_pin',
            data: {
                tid: tid,
                detail: true,
                showUser: true
            },
            success: function (res) {
                var status = res.status, data = res.data;
                if (status !== 200) {
                    return;
                }
                _this.setData({
                    list: data,
                    loading: false
                });
            }
        });
    },
    setTitle: function (title) {
        if (!title) {
            return;
        }
        wx.setNavigationBarTitle({
            title: title
        });
    },
    transferSl: function (sl, allTexts) {
        if (allTexts === void 0) { allTexts = []; }
        var pid = sl.pid, adjustGroupPrice = sl.adjustGroupPrice, adjustPrice = sl.adjustPrice, users = sl.users, detail = sl.detail;
        var delta = adjustGroupPrice ? Math.ceil(adjustPrice - adjustGroupPrice) : 0;
        var totalDelta = delta * users.length;
        var getRandom = function (n) { return Math.floor(Math.random() * n); };
        return {
            pid: pid,
            price: adjustPrice,
            groupPrice: adjustGroupPrice,
            fadePrice: detail.good.fadePrice,
            title: detail.title,
            name: detail.name || '',
            goodImg: detail.img,
            delta: delta,
            totalDelta: totalDelta,
            successDelta: users.length > 1 ? delta : 0,
            buyer: users.map(function (x) { return ({
                name: x.nickName,
                avatar: x.avatarUrl
            }); }),
            pinSuccess: users.length > 1,
            tips: allTexts[getRandom(allTexts.length)],
            tipsIndex: getRandom(users.length > 4 ? 3 : users.length - 1) + 1
        };
    },
    goGoodDetail: function (e) {
        var data = e.currentTarget.dataset.data;
        route_js_1.navTo("/pages/goods-detail/index?id=" + data.pid);
    },
    onSwiper: function (e) {
        var current = e.detail.current;
        this.setData({
            swiperIndex: current
        });
    },
    onScroll: function (e) {
        var showDanmu = this.data.showDanmu;
        var scrollTop = e.detail.scrollTop;
        if (!!showDanmu) {
            return;
        }
        if (scrollTop > 100) {
            this.setData({
                showDanmu: true
            });
        }
    },
    onLoad: function (query) {
        var tid = query.tid || "e8f863ba5de6241400076921441bc8d5";
        this.watchStore();
        this.runComputed();
        this.setData({
            tid: tid
        });
        this.fetchShopping(tid);
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDhDQUEwQztBQUMxQyxxREFBb0Q7QUFFcEQsZ0RBQTRDO0FBRTVDLElBQU0sR0FBRyxHQUFHLE1BQU0sRUFBUSxDQUFDO0FBRTNCLElBQUksQ0FBQztJQUVELElBQUksRUFBRTtRQUVGLEdBQUcsRUFBRSxFQUFFO1FBRVAsTUFBTSxFQUFFLEVBQUU7UUFFVixRQUFRLEVBQUUsRUFBRTtRQUtaLE9BQU8sRUFBRSxJQUFJO1FBS2IsV0FBVyxFQUFFLENBQUM7UUFLZCxTQUFTLEVBQUUsS0FBSztRQUtoQixJQUFJLEVBQUUsRUFBRztRQUtULFdBQVcsRUFBRSxJQUFJO0tBRXBCO0lBRUQsV0FBVztRQUNQLG1CQUFRLENBQUUsSUFBSSxFQUFFO1lBR1osT0FBTztnQkFDSCxJQUFNLE1BQU0sR0FBRyxvSUFBb0ksQ0FBQztnQkFDcEosSUFBTSxTQUFTLEdBQUcsVUFBQSxDQUFDLElBQUksT0FBQSxJQUFJLENBQUMsS0FBSyxDQUFFLElBQUksQ0FBQyxNQUFNLEVBQUcsR0FBRyxDQUFDLENBQUUsRUFBaEMsQ0FBZ0MsQ0FBQztnQkFDeEQsSUFBTSxRQUFRLEdBQUc7b0JBQ2IsMERBQWE7b0JBQ2IsMERBQWE7b0JBQ2IsMERBQWE7aUJBQ2hCLENBQUM7Z0JBRUYsSUFBTSxRQUFRLEdBQUc7b0JBQ2IsTUFBTTtvQkFDTixNQUFNO2lCQUNULENBQUM7Z0JBQ0YsSUFBTSxXQUFXLEdBQUcsUUFBUTtxQkFDdkIsR0FBRyxDQUFFLFVBQUEsQ0FBQztvQkFDSCxJQUFNLFNBQVMsR0FBRyxTQUFTLENBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBRSxDQUFDO29CQUMvQyxPQUFPO3dCQUNILE1BQU0sRUFBRSxDQUFDO3dCQUNULElBQUksRUFBRSxRQUFRLENBQUUsU0FBUyxDQUFFO3FCQUM5QixDQUFBO2dCQUNMLENBQUMsQ0FBQyxDQUFBO2dCQUNO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U0FDTjtJQUNMLENBQUM7SUFLRCxNQUFNLEVBQUUsVUFBVyxLQUFVO1FBQ3pCLElBQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxHQUFHLElBQUksa0NBQWtDLENBQUM7UUFDNUQsSUFBSSxDQUFDLFVBQVUsRUFBRyxDQUFDO1FBQ25CLElBQUksQ0FBQyxXQUFXLEVBQUcsQ0FBQztRQUVwQixJQUFJLENBQUMsT0FBUSxDQUFDO1lBQ1YsR0FBRyxLQUFBO1NBQ04sQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGFBQWEsQ0FBRSxHQUFHLENBQUUsQ0FBQztJQUU5QixDQUFDO0lBS0QsT0FBTyxFQUFFO0lBRVQsQ0FBQztJQUtELE1BQU0sRUFBRTtJQUVSLENBQUM7SUFLRCxNQUFNLEVBQUU7SUFFUixDQUFDO0lBS0QsUUFBUSxFQUFFO0lBRVYsQ0FBQztJQUtELGlCQUFpQixFQUFFO0lBRW5CLENBQUM7SUFLRCxhQUFhLEVBQUU7SUFFZixDQUFDO0NBUUYsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBodHRwIH0gZnJvbSAnLi4vLi4vdXRpbC9odHRwLmpzJztcbmltcG9ydCB7IGNvbXB1dGVkIH0gZnJvbSAnLi4vLi4vbGliL3Z1ZWZ5L2luZGV4LmpzJztcbmltcG9ydCB7IGRlbGF5ZXJpbmdHb29kIH0gZnJvbSAnLi4vLi4vdXRpbC9nb29kcy5qcyc7XG5pbXBvcnQgeyBuYXZUbyB9IGZyb20gJy4uLy4uL3V0aWwvcm91dGUuanMnO1xuXG5jb25zdCBhcHAgPSBnZXRBcHA8YW55PiggKTtcblxuUGFnZSh7XG5cbiAgICBkYXRhOiB7XG5cbiAgICAgICAgdGlkOiAnJyxcblxuICAgICAgICBvcGVuaWQ6ICcnLFxuXG4gICAgICAgIGlwQXZhdGFyOiAnJyxcblxuICAgICAgICAvKipcbiAgICAgICAgICog5Yqg6L29XG4gICAgICAgICAqL1xuICAgICAgICBsb2FkaW5nOiB0cnVlLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlhbbku5bkurrmuIXljZXnmoQgc3dpcGVyXG4gICAgICAgICAqL1xuICAgICAgICBzd2lwZXJJbmRleDogMCxcblxuICAgICAgICAvKipcbiAgICAgICAgICog5piv5ZCm5bGV56S65by55bmVXG4gICAgICAgICAqL1xuICAgICAgICBzaG93RGFubXU6IGZhbHNlLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDotK3nianmuIXljZVcbiAgICAgICAgICovXG4gICAgICAgIGxpc3Q6IFsgXSxcblxuICAgICAgICAvKipcbiAgICAgICAgICog5bGV56S657qi5YyFXG4gICAgICAgICAqL1xuICAgICAgICBzaG93SG9uZ2JhbzogdHJ1ZVxuXG4gICAgfSxcblxuICAgIHJ1bkNvbXB1dGVkKCApIHtcbiAgICAgICAgY29tcHV0ZWQoIHRoaXMsIHtcblxuICAgICAgICAgICAgLy8g6LSt5Lmw6K6w5b2VICsg56S+5Lqk5bGe5oCn5qih5Z2XXG4gICAgICAgICAgICBzb2NpYWwkKCApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhdmF0YXIgPSAnaHR0cHM6Ly93eC5xbG9nby5jbi9tbW9wZW4vdmlfMzIvSWVqTVZaVEc4V2xpYkhpY0hJVlFocWNOZUM0dUJ4a3pIMEZGVGJSTE1pY3hpYjh3cnhSUldvSlkzZ3ZjdHlsQVRkbUFQaGlhVmljVTRzSDBOcHRTc3pCZHlIaWFBLzEzMic7XG4gICAgICAgICAgICAgICAgY29uc3QgZ2V0UmFuZG9tID0gbiA9PiBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSggKSAqIG4gKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxUZXh0cyA9IFtcbiAgICAgICAgICAgICAgICAgICAgYOajkiEg5ou85Zui55qE576k5Y+L55yf57uZ5YqbYCxcbiAgICAgICAgICAgICAgICAgICAgYOWThyEg5ZKM576k5Y+L5ou85Zui5aW95YiS566XYCxcbiAgICAgICAgICAgICAgICAgICAgYOWTiCEg5LiL5qyh57un57ut55So576k5ou85ZuiYFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc3QgdmlzaXRvcnMgPSBbXG4gICAgICAgICAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxWaXNpdG9ycyA9IHZpc2l0b3JzXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoIHggPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFuZG9tTnVtID0gZ2V0UmFuZG9tKCBhbGxUZXh0cy5sZW5ndGggKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyOiB4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGFsbFRleHRzWyByYW5kb21OdW0gXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHJldHVybiBhbGxWaXNpdG9ycztcblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLy8g5YW25LuW5Lq6KOaIluiAheaYr+aJgOacieS6uueahCnnmoTotK3nianmuIXljZVcbiAgICAgICAgICAgIG90aGVycyQoICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGlzdCwgb3BlbmlkIH0gPSB0aGlzLmRhdGE7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJMaXN0ID0gbGlzdFxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKCB4ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAheC51c2Vycy5maW5kKCB5ID0+IHkub3BlbmlkID09PSBvcGVuaWQgKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQoKCB4LCB5ICkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHkudXNlcnMubGVuZ3RoIC0geC51c2Vycy5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByID0gb3RoZXJMaXN0Lm1hcCggc2wgPT4gdGhpcy50cmFuc2ZlclNsKCBzbCApKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIOS4quS6uui0reeJqea4heWNlVxuICAgICAgICAgICAgcGVyc29uYWwkKCApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxpc3QsIG9wZW5pZCB9ID0gdGhpcy5kYXRhO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbFRleHRzID0gW1xuICAgICAgICAgICAgICAgICAgICBg55yf57uZ5YqbYCxcbiAgICAgICAgICAgICAgICAgICAgYOiwouiwouS9oGAsXG4gICAgICAgICAgICAgICAgICAgIGDliJLnrpfvvZ5gLFxuICAgICAgICAgICAgICAgICAgICBg5qOSIWAsXG4gICAgICAgICAgICAgICAgICAgIGDotZ4hYCxcbiAgICAgICAgICAgICAgICAgICAgYOi1miFgXG4gICAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG15TGlzdCA9IGxpc3RcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlciggeCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geC51c2Vycy5maW5kKCB5ID0+IHkub3BlbmlkID09PSBvcGVuaWQgKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQoKCB4LCB5ICkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHkudXNlcnMubGVuZ3RoIC0geC51c2Vycy5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByID0gbXlMaXN0Lm1hcCggc2wgPT4gdGhpcy50cmFuc2ZlclNsKCBzbCwgYWxsVGV4dHMgKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyDooYznqIvmuIXljZXmgLvmpoLlhrVcbiAgICAgICAgICAgIHN1bW1hcnkkKCApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxpc3QsIG9wZW5pZCB9ID0gdGhpcy5kYXRhO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYWxsU2wgPSBsaXN0Lm1hcCggc2wgPT4gdGhpcy50cmFuc2ZlclNsKCBzbCApKTtcbiAgICAgICAgICAgICAgICBjb25zdCBteVNMID0gbGlzdFxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKCB4ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB4LnVzZXJzLmZpbmQoIHkgPT4geS5vcGVuaWQgPT09IG9wZW5pZCApO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAubWFwKCBzbCA9PiB0aGlzLnRyYW5zZmVyU2woIHNsICkpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHtcbiAgICAgICAgICAgICAgICAgICAgLy8g5omA5pyJ576k5Y+L77yM5LiA5YWx55yB5LqG5aSa5bCRXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwVG90YWxEZWx0YTogYWxsU2wucmVkdWNlKCggeCwgeSApID0+IHggKyB5LnRvdGFsRGVsdGEsIDAgKSxcbiAgICAgICAgICAgICAgICAgICAgLy8g5oiR5LiA5YWx55yB5LqG5aSa5bCRXG4gICAgICAgICAgICAgICAgICAgIG15VG90YWxEZWx0YTogbXlTTC5yZWR1Y2UoKCB4LCB5ICkgPT4geCArIHkuc3VjY2Vzc0RlbHRhLCAwIClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiByO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDnm5HlkKxzdG9yZVxuICAgICAqL1xuICAgIHdhdGNoU3RvcmUoICkge1xuICAgICAgICBhcHAud2F0Y2gkKCdhcHBDb25maWcnLCB2YWwgPT4ge1xuICAgICAgICAgICAgaWYgKCAhIXZhbCApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRpdGxlKGAke3ZhbFsnaXAtbmFtZSddIHx8ICcnfee+pOaLvOWbomApXG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgICAgICAgIGlwQXZhdGFyOiBgJHt2YWxbJ2lwLWF2YXRhciddIHx8ICcnfWBcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYXBwLndhdGNoJCgnb3BlbmlkJywgdmFsID0+IHtcbiAgICAgICAgICAgICEhdmFsICYmIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgICAgICAgIG9wZW5pZDogdmFsXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqIOaLieWPluihjOeoi+eahOi0reeJqeivt+WNleS/oeaBryAqL1xuICAgIGZldGNoU2hvcHBpbmcoIHRpZCApIHtcbiAgICAgICAgaWYgKCAhdGlkICkgeyByZXR1cm47IH1cblxuICAgICAgICBodHRwKHtcbiAgICAgICAgICAgIHVybDogJ3Nob3BwaW5nLWxpc3RfcGluJyxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICB0aWQsXG4gICAgICAgICAgICAgICAgZGV0YWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNob3dVc2VyOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHN0YXR1cywgZGF0YSB9ID0gcmVzO1xuICAgICAgICAgICAgICAgIGlmICggc3RhdHVzICE9PSAyMDAgKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgICAgICAgICAgICBsaXN0OiBkYXRhLFxuICAgICAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICAvKiogXG4gICAgICog6K6+572u5qCH6aKYXG4gICAgICovXG4gICAgc2V0VGl0bGUoIHRpdGxlOiBzdHJpbmcgKSB7XG4gICAgICAgIGlmICggIXRpdGxlICkgeyByZXR1cm47IH1cbiAgICAgICAgd3guc2V0TmF2aWdhdGlvbkJhclRpdGxlKHtcbiAgICAgICAgICAgIHRpdGxlXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDovazmjaLmoLzlvI9cbiAgICAgKi9cbiAgICB0cmFuc2ZlclNsKCBzbCwgYWxsVGV4dHMgPSBbIF0pIHtcblxuICAgICAgICBjb25zdCB7IHBpZCwgYWRqdXN0R3JvdXBQcmljZSwgYWRqdXN0UHJpY2UsIHVzZXJzLCBkZXRhaWwgfSA9IHNsO1xuICAgICAgICBjb25zdCBkZWx0YSA9IGFkanVzdEdyb3VwUHJpY2UgPyBNYXRoLmNlaWwoIGFkanVzdFByaWNlIC0gYWRqdXN0R3JvdXBQcmljZSApIDogMDtcbiAgICAgICAgY29uc3QgdG90YWxEZWx0YSA9IGRlbHRhICogdXNlcnMubGVuZ3RoO1xuXG4gICAgICAgIGNvbnN0IGdldFJhbmRvbSA9IG4gPT4gTWF0aC5mbG9vciggTWF0aC5yYW5kb20oICkgKiBuICk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBpZCxcbiAgICAgICAgICAgIHByaWNlOiBhZGp1c3RQcmljZSxcbiAgICAgICAgICAgIGdyb3VwUHJpY2U6IGFkanVzdEdyb3VwUHJpY2UsXG4gICAgICAgICAgICBmYWRlUHJpY2U6IGRldGFpbC5nb29kLmZhZGVQcmljZSxcbiAgICAgICAgICAgIHRpdGxlOiBkZXRhaWwudGl0bGUsXG4gICAgICAgICAgICBuYW1lOiBkZXRhaWwubmFtZSB8fCAnJyxcbiAgICAgICAgICAgIGdvb2RJbWc6IGRldGFpbC5pbWcsXG4gICAgICAgICAgICAvLyDmgLvlt67lgLxcbiAgICAgICAgICAgIGRlbHRhLCBcbiAgICAgICAgICAgIC8vIOi0reeJqea4heWNleaAu+W3ruWAvFxuICAgICAgICAgICAgdG90YWxEZWx0YSxcbiAgICAgICAgICAgIC8vIOaIkeeahOaIkOWKn+aLvOWbouW3ruWAvFxuICAgICAgICAgICAgc3VjY2Vzc0RlbHRhOiB1c2Vycy5sZW5ndGggPiAxID8gZGVsdGEgOiAwLFxuICAgICAgICAgICAgYnV5ZXI6IHVzZXJzLm1hcCggeCA9PiAoe1xuICAgICAgICAgICAgICAgIG5hbWU6IHgubmlja05hbWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyOiB4LmF2YXRhclVybFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgcGluU3VjY2VzczogdXNlcnMubGVuZ3RoID4gMSxcbiAgICAgICAgICAgIHRpcHM6IGFsbFRleHRzWyBnZXRSYW5kb20oIGFsbFRleHRzLmxlbmd0aCApXSxcbiAgICAgICAgICAgIHRpcHNJbmRleDogZ2V0UmFuZG9tKCB1c2Vycy5sZW5ndGggPiA0ID8gMyA6IHVzZXJzLmxlbmd0aCAtIDEgKSArIDFcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDot7PliLDllYblk4Hor6bmg4VcbiAgICAgKi9cbiAgICBnb0dvb2REZXRhaWwoIGUgKSB7XG4gICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XG4gICAgICAgIG5hdlRvKGAvcGFnZXMvZ29vZHMtZGV0YWlsL2luZGV4P2lkPSR7ZGF0YS5waWR9YClcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogc3dpcGVy55uR5ZCsXG4gICAgICovXG4gICAgb25Td2lwZXIoIGU6IGFueSApIHtcbiAgICAgICAgY29uc3QgeyBjdXJyZW50IH0gPSBlLmRldGFpbDtcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICBzd2lwZXJJbmRleDogY3VycmVudFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6aG16Z2i5rua5YqoXG4gICAgICovXG4gICAgb25TY3JvbGwoIGU6IGFueSApIHtcbiAgICAgICAgY29uc3QgeyBzaG93RGFubXUgfSA9IHRoaXMuZGF0YTtcbiAgICAgICAgY29uc3QgeyBzY3JvbGxUb3AgfSA9IGUuZGV0YWlsO1xuICAgICAgICBpZiAoICEhc2hvd0Rhbm11ICkgeyByZXR1cm47IH0gXG5cbiAgICAgICAgaWYgKCBzY3JvbGxUb3AgPiAxMDAgKSB7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICAgICAgICBzaG93RGFubXU6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHRpZCDooYznqItpZFxuICAgICAqL1xuICAgIG9uTG9hZDogZnVuY3Rpb24gKCBxdWVyeTogYW55ICkge1xuICAgICAgICBjb25zdCB0aWQgPSBxdWVyeS50aWQgfHwgXCJlOGY4NjNiYTVkZTYyNDE0MDAwNzY5MjE0NDFiYzhkNVwiO1xuICAgICAgICB0aGlzLndhdGNoU3RvcmUoICk7XG4gICAgICAgIHRoaXMucnVuQ29tcHV0ZWQoICk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICAgIHRpZFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmZldGNoU2hvcHBpbmcoIHRpZCApO1xuXG4gICAgfSxcbiAgXG4gICAgLyoqXG4gICAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliJ3mrKHmuLLmn5PlrozmiJBcbiAgICAgKi9cbiAgICBvblJlYWR5OiBmdW5jdGlvbiAoICkge1xuXG4gICAgfSxcbiAgXG4gICAgLyoqXG4gICAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcbiAgICAgKi9cbiAgICBvblNob3c6IGZ1bmN0aW9uICggKSB7XG5cbiAgICB9LFxuICBcbiAgICAvKipcbiAgICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdoumakOiXj1xuICAgICAqL1xuICAgIG9uSGlkZTogZnVuY3Rpb24gKCkge1xuICBcbiAgICB9LFxuICBcbiAgICAvKipcbiAgICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgICAqL1xuICAgIG9uVW5sb2FkOiBmdW5jdGlvbiAoKSB7XG4gIFxuICAgIH0sXG4gIFxuICAgIC8qKlxuICAgICAqIOmhtemdouebuOWFs+S6i+S7tuWkhOeQhuWHveaVsC0t55uR5ZCs55So5oi35LiL5ouJ5Yqo5L2cXG4gICAgICovXG4gICAgb25QdWxsRG93blJlZnJlc2g6IGZ1bmN0aW9uICgpIHtcbiAgXG4gICAgfSxcbiAgXG4gICAgLyoqXG4gICAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXG4gICAgICovXG4gICAgb25SZWFjaEJvdHRvbTogZnVuY3Rpb24gKCkge1xuICBcbiAgICB9LFxuICBcbiAgICAvKipcbiAgICAgKiDnlKjmiLfngrnlh7vlj7PkuIrop5LliIbkuqtcbiAgICAgKi9cbiAgICAvLyBvblNoYXJlQXBwTWVzc2FnZTogZnVuY3Rpb24gKCBlICkge1xuXG4gICAgLy8gfVxuICB9KSJdfQ==