"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_js_1 = require("../../util/http.js");
var index_js_1 = require("../../lib/vuefy/index.js");
var route_js_1 = require("../../util/route.js");
var app = getApp();
var storageKey = 'trip-has-reward-list';
Page({
    data: {
        tid: '',
        openid: '',
        ipAvatar: '',
        ipName: '',
        isAdm: false,
        isAuth: false,
        loading: true,
        swiperIndex: 0,
        showDanmu: false,
        list: [],
        showHongbao: 'hide',
        hasGet: true
    },
    runComputed: function () {
        index_js_1.computed(this, {
            social$: function () {
                var avatar = 'https://wx.qlogo.cn/mmopen/vi_32/IejMVZTG8WlibHicHIVQhqcNeC4uBxkzH0FFTbRLMicxib8wrxRRWoJY3gvctylATdmAPhiaVicU4sH0NptSszBdyHiaA/132';
                var getRandom = function (n) { return Math.floor(Math.random() * n); };
                var allTexts = [
                    "\u68D2! \u62FC\u56E2\u7684\u7FA4\u53CB\u771F\u7ED9\u529B",
                    "\u54C7! \u548C\u7FA4\u53CB\u62FC\u56E2\u597D\u5212\u7B97",
                    "\u54C8! \u4E0B\u6B21\u7EE7\u7EED\u7528\u7FA4\u62FC\u56E2"
                ];
                var visitors = [
                    avatar,
                    avatar
                ];
                var allVisitors = visitors
                    .map(function (x) {
                    var randomNum = getRandom(allTexts.length);
                    return {
                        avatar: x,
                        text: allTexts[randomNum]
                    };
                });
                return allVisitors;
            },
            others$: function () {
                var _this = this;
                var _a = this.data, list = _a.list, openid = _a.openid;
                var otherList = list
                    .filter(function (x) {
                    return !x.users.find(function (y) { return y.openid === openid; });
                })
                    .sort(function (x, y) {
                    return y.users.length - x.users.length;
                });
                var r = otherList.map(function (sl) { return _this.transferSl(sl); });
                var result = r.map(function (x) {
                    var pid = x.pid, goodImg = x.goodImg, buyer = x.buyer, totalDelta = x.totalDelta, name = x.name, title = x.title;
                    return {
                        pid: pid,
                        img: goodImg,
                        topTips: (buyer.length > 1 ? buyer.length + '人' : '') + "\u7701" + totalDelta + "\u5143",
                        bottomTips: buyer.length + "\u7FA4\u53CB\u62FC\u56E2",
                        avatars: buyer.map(function (y) { return y.avatar; }),
                        title: "" + (name ? name : '') + title
                    };
                });
                return result;
            },
            personal$: function () {
                var _this = this;
                var _a = this.data, list = _a.list, openid = _a.openid;
                var allTexts = [
                    "\u771F\u7ED9\u529B",
                    "\u8C22\u8C22\u4F60",
                    "\u5212\u7B97\uFF5E",
                    "\u68D2!",
                    "\u8D5E!",
                    "\u8D5A!"
                ];
                var myList = list
                    .filter(function (x) {
                    return x.users.find(function (y) { return y.openid === openid; });
                })
                    .sort(function (x, y) {
                    return y.users.length - x.users.length;
                });
                var r = myList.map(function (sl) { return _this.transferSl(sl, allTexts); });
                return r;
            },
            all$: function () {
                var _this = this;
                var list = this.data.list;
                var allTexts = [
                    "\u771F\u7ED9\u529B",
                    "\u8C22\u8C22\u4F60",
                    "\u5212\u7B97\uFF5E",
                    "\u68D2!",
                    "\u8D5E!",
                    "\u8D5A!"
                ];
                var r = list.map(function (sl) { return _this.transferSl(sl, allTexts); });
                return r;
            },
            summary$: function () {
                var _this = this;
                var _a = this.data, list = _a.list, openid = _a.openid;
                var allSl = list.map(function (sl) { return _this.transferSl(sl); });
                var mySL = list
                    .filter(function (x) {
                    return x.users.find(function (y) { return y.openid === openid; });
                })
                    .map(function (sl) { return _this.transferSl(sl); });
                var r = {
                    groupTotalDelta: allSl.reduce(function (x, y) {
                        return x + (y.buyer.length > 1 ? y.totalDelta : 0);
                    }, 0),
                    myTotalDelta: mySL.reduce(function (x, y) { return x + y.successDelta; }, 0)
                };
                return r;
            },
            hongbao$: function () {
                var _a = this.data, list = _a.list, openid = _a.openid;
                var myList = list
                    .filter(function (x) {
                    return x.users.find(function (y) { return y.openid === openid; });
                });
                var hasBuy = myList.length > 0;
                var gift = hasBuy ? 1.24 : 0.88;
                var somePinSuccess = myList.some(function (x) { return x.users.length > 1; });
                var title = hasBuy && somePinSuccess ?
                    '拼团成功' :
                    hasBuy && !somePinSuccess ?
                        '差点拼成' :
                        '群拼团 省钱!';
                var summary = hasBuy && somePinSuccess ?
                    '省钱啦！请再接再厉~' :
                    hasBuy && !somePinSuccess ?
                        '莫灰心！多邀请群友拼团' :
                        '下次跟着群友拼';
                return {
                    gift: gift,
                    title: title,
                    summary: summary
                };
            }
        });
    },
    watchStore: function () {
        var _this = this;
        app.watch$('appConfig', function (val) {
            if (!!val) {
                _this.setTitle((val['ip-name'] || '') + "\u7FA4\u62FC\u56E2");
                _this.setData({
                    ipName: val['ip-name'],
                    ipAvatar: "" + (val['ip-avatar'] || '')
                });
            }
        });
        app.watch$('openid', function (val) {
            !!val && _this.setData({
                openid: val
            });
        });
        app.watch$('isUserAuth', function (val) {
            if (val === undefined) {
                return;
            }
            _this.setData({
                isAuth: val
            });
        });
        app.watch$('role', function (val) {
            if (val === 0) {
                wx.hideShareMenu({});
            }
            else {
                wx.showShareMenu({
                    withShareTicket: false
                });
            }
        });
    },
    fetchShopping: function (tid) {
        var _this = this;
        if (!tid) {
            return;
        }
        http_js_1.http({
            url: 'shopping-list_pin',
            data: {
                tid: tid,
                detail: true,
                showUser: true
            },
            success: function (res) {
                var status = res.status, data = res.data;
                if (status !== 200) {
                    return;
                }
                _this.setData({
                    list: data,
                    loading: false,
                    showHongbao: 'hide'
                });
            }
        });
    },
    fetchGetGift: function () {
        var _this = this;
        var _a = this.data, tid = _a.tid, hasGet = _a.hasGet;
        var hongbao$ = this.data.hongbao$;
        if (hasGet) {
            wx.showToast({
                title: '已领取过啦'
            });
            return this.toggleHongbao();
        }
        http_js_1.http({
            url: 'common_get-integral',
            data: {
                integral: hongbao$.gift
            },
            loadingMsg: '领取中...',
            success: function (res) {
                var status = res.status;
                if (status !== 200) {
                    return;
                }
                wx.showToast({
                    title: '领取成功'
                });
                _this.toggleHongbao();
                _this.setTripReward(tid);
                _this.checkIsGet(tid);
            }
        });
    },
    setTitle: function (title) {
        if (!title) {
            return;
        }
        wx.setNavigationBarTitle({
            title: title
        });
    },
    transferSl: function (sl, allTexts) {
        if (allTexts === void 0) { allTexts = []; }
        var pid = sl.pid, adjustGroupPrice = sl.adjustGroupPrice, adjustPrice = sl.adjustPrice, users = sl.users, detail = sl.detail;
        var delta = adjustGroupPrice ? Math.ceil(adjustPrice - adjustGroupPrice) : 0;
        var totalDelta = delta * users.length;
        var getRandom = function (n) { return Math.floor(Math.random() * n); };
        return {
            pid: pid,
            price: adjustPrice,
            groupPrice: adjustGroupPrice,
            fadePrice: detail.good.fadePrice,
            title: detail.title,
            name: detail.name || '',
            goodImg: detail.img,
            delta: delta,
            totalDelta: totalDelta,
            successDelta: users.length > 1 ? delta : 0,
            buyer: users.map(function (x) { return ({
                name: x.nickName,
                avatar: x.avatarUrl
            }); }),
            pinSuccess: users.length > 1,
            tips: allTexts[getRandom(allTexts.length)],
            tipsIndex: getRandom(users.length > 4 ? 3 : users.length - 1) + 1
        };
    },
    toggleHongbao: function () {
        var showHongbao = this.data.showHongbao;
        this.setData({
            showHongbao: showHongbao === 'show' ? 'hide' : 'show'
        });
    },
    goGoodDetail: function (e) {
        var data = e.currentTarget.dataset.data;
        route_js_1.navTo("/pages/goods-detail/index?id=" + data.pid);
    },
    onSubscribe: function () {
        app.getSubscribe('buyPin,waitPin,trip');
        this.fetchGetGift();
    },
    getUserAuth: function () {
        var _this = this;
        app.getWxUserInfo(function () {
            _this.fetchGetGift();
        });
    },
    setTripReward: function (tid) {
        var tripSum = 10;
        var hasRewardList = JSON.parse(wx.getStorageSync(storageKey) || '[ ]');
        hasRewardList.unshift(tid);
        wx.setStorageSync(storageKey, JSON.stringify(hasRewardList.slice(0, tripSum)));
    },
    checkIsGet: function (tid) {
        var hasRewardList = JSON.parse(wx.getStorageSync(storageKey) || '[ ]');
        this.setData({
            hasGet: hasRewardList.includes(tid)
        });
    },
    onSwiper: function (e) {
        var current = e.detail.current;
        this.setData({
            swiperIndex: current
        });
    },
    onScroll: function (e) {
        var showDanmu = this.data.showDanmu;
        var scrollTop = e.detail.scrollTop;
        if (!!showDanmu) {
            return;
        }
        if (scrollTop > 100) {
            this.setData({
                showDanmu: true
            });
        }
    },
    onLoad: function (query) {
        var tid = query.tid || "e8f863ba5de6241400076921441bc8d5";
        this.watchStore();
        this.runComputed();
        this.setData({
            tid: tid
        });
        this.checkIsGet(tid);
        this.fetchShopping(tid);
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
    },
    onReachBottom: function () {
    },
    onShareAppMessage: function (e) {
        var _a = this.data, ipName = _a.ipName, tid = _a.tid, isAdm = _a.isAdm;
        return {
            title: (ipName || '群拼团') + "\u56DE\u62A5\u5927\u5BB6\u5566 \u70B9\u51FB\u9886\u53D6\u62B5\u73B0\u91D1",
            imageUrl: 'https://global-1257764567.cos.ap-guangzhou.myqcloud.com/bg-trip-reward-share-colorful.jpg',
            path: "/pages/trip-reward/index?tid=" + tid
        };
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDhDQUEwQztBQUMxQyxxREFBb0Q7QUFFcEQsZ0RBQTRDO0FBRTVDLElBQU0sR0FBRyxHQUFHLE1BQU0sRUFBUSxDQUFDO0FBQzNCLElBQU0sVUFBVSxHQUFHLHNCQUFzQixDQUFDO0FBRTFDLElBQUksQ0FBQztJQUVELElBQUksRUFBRTtRQUVGLEdBQUcsRUFBRSxFQUFFO1FBRVAsTUFBTSxFQUFFLEVBQUU7UUFFVixRQUFRLEVBQUUsRUFBRTtRQUVaLE1BQU0sRUFBRSxFQUFFO1FBRVYsS0FBSyxFQUFFLEtBQUs7UUFLWixNQUFNLEVBQUUsS0FBSztRQUtiLE9BQU8sRUFBRSxJQUFJO1FBS2IsV0FBVyxFQUFFLENBQUM7UUFLZCxTQUFTLEVBQUUsS0FBSztRQUtoQixJQUFJLEVBQUUsRUFBRztRQUtULFdBQVcsRUFBRSxNQUFNO1FBS25CLE1BQU0sRUFBRSxJQUFJO0tBRWY7SUFFRCxXQUFXO1FBQ1AsbUJBQVEsQ0FBRSxJQUFJLEVBQUU7WUFHWixPQUFPO2dCQUNILElBQU0sTUFBTSxHQUFHLG9JQUFvSSxDQUFDO2dCQUNwSixJQUFNLFNBQVMsR0FBRyxVQUFBLENBQUMsSUFBSSxPQUFBLElBQUksQ0FBQyxLQUFLLENBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRyxHQUFHLENBQUMsQ0FBRSxFQUFoQyxDQUFnQyxDQUFDO2dCQUN4RCxJQUFNLFFBQVEsR0FBRztvQkFDYiwwREFBYTtvQkFDYiwwREFBYTtvQkFDYiwwREFBYTtpQkFDaEIsQ0FBQztnQkFFRixJQUFNLFFBQVEsR0FBRztvQkFDYixNQUFNO29CQUNOLE1BQU07aUJBQ1QsQ0FBQztnQkFDRixJQUFNLFdBQVcsR0FBRyxRQUFRO3FCQUN2QixHQUFHLENBQUUsVUFBQSxDQUFDO29CQUNILElBQU0sU0FBUyxHQUFHLFNBQVMsQ0FBRSxRQUFRLENBQUMsTUFBTSxDQUFF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QUs7U0FDOUMsQ0FBQztJQUNOLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IGh0dHAgfSBmcm9tICcuLi8uLi91dGlsL2h0dHAuanMnO1xuaW1wb3J0IHsgY29tcHV0ZWQgfSBmcm9tICcuLi8uLi9saWIvdnVlZnkvaW5kZXguanMnO1xuaW1wb3J0IHsgZGVsYXllcmluZ0dvb2QgfSBmcm9tICcuLi8uLi91dGlsL2dvb2RzLmpzJztcbmltcG9ydCB7IG5hdlRvIH0gZnJvbSAnLi4vLi4vdXRpbC9yb3V0ZS5qcyc7XG5cbmNvbnN0IGFwcCA9IGdldEFwcDxhbnk+KCApO1xuY29uc3Qgc3RvcmFnZUtleSA9ICd0cmlwLWhhcy1yZXdhcmQtbGlzdCc7XG5cblBhZ2Uoe1xuXG4gICAgZGF0YToge1xuXG4gICAgICAgIHRpZDogJycsXG5cbiAgICAgICAgb3BlbmlkOiAnJyxcblxuICAgICAgICBpcEF2YXRhcjogJycsXG5cbiAgICAgICAgaXBOYW1lOiAnJyxcblxuICAgICAgICBpc0FkbTogZmFsc2UsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIOaYr+WQpuacieeUqOaIt+aOiOadg1xuICAgICAgICAgKi9cbiAgICAgICAgaXNBdXRoOiBmYWxzZSxcblxuICAgICAgICAvKipcbiAgICAgICAgICog5Yqg6L29XG4gICAgICAgICAqL1xuICAgICAgICBsb2FkaW5nOiB0cnVlLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDlhbbku5bkurrmuIXljZXnmoQgc3dpcGVyXG4gICAgICAgICAqL1xuICAgICAgICBzd2lwZXJJbmRleDogMCxcblxuICAgICAgICAvKipcbiAgICAgICAgICog5piv5ZCm5bGV56S65by55bmVXG4gICAgICAgICAqL1xuICAgICAgICBzaG93RGFubXU6IGZhbHNlLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDotK3nianmuIXljZVcbiAgICAgICAgICovXG4gICAgICAgIGxpc3Q6IFsgXSxcblxuICAgICAgICAvKipcbiAgICAgICAgICog5bGV56S657qi5YyFXG4gICAgICAgICAqL1xuICAgICAgICBzaG93SG9uZ2JhbzogJ2hpZGUnLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiDmmK/lkKblt7Lnu4/pooblj5bov4fnuqLljIXkuoZcbiAgICAgICAgICovXG4gICAgICAgIGhhc0dldDogdHJ1ZVxuXG4gICAgfSxcblxuICAgIHJ1bkNvbXB1dGVkKCApIHtcbiAgICAgICAgY29tcHV0ZWQoIHRoaXMsIHtcblxuICAgICAgICAgICAgLy8g6LSt5Lmw6K6w5b2VICsg56S+5Lqk5bGe5oCn5qih5Z2XXG4gICAgICAgICAgICBzb2NpYWwkKCApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhdmF0YXIgPSAnaHR0cHM6Ly93eC5xbG9nby5jbi9tbW9wZW4vdmlfMzIvSWVqTVZaVEc4V2xpYkhpY0hJVlFocWNOZUM0dUJ4a3pIMEZGVGJSTE1pY3hpYjh3cnhSUldvSlkzZ3ZjdHlsQVRkbUFQaGlhVmljVTRzSDBOcHRTc3pCZHlIaWFBLzEzMic7XG4gICAgICAgICAgICAgICAgY29uc3QgZ2V0UmFuZG9tID0gbiA9PiBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSggKSAqIG4gKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxUZXh0cyA9IFtcbiAgICAgICAgICAgICAgICAgICAgYOajkiEg5ou85Zui55qE576k5Y+L55yf57uZ5YqbYCxcbiAgICAgICAgICAgICAgICAgICAgYOWThyEg5ZKM576k5Y+L5ou85Zui5aW95YiS566XYCxcbiAgICAgICAgICAgICAgICAgICAgYOWTiCEg5LiL5qyh57un57ut55So576k5ou85ZuiYFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc3QgdmlzaXRvcnMgPSBbXG4gICAgICAgICAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBjb25zdCBhbGxWaXNpdG9ycyA9IHZpc2l0b3JzXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoIHggPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFuZG9tTnVtID0gZ2V0UmFuZG9tKCBhbGxUZXh0cy5sZW5ndGggKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyOiB4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGFsbFRleHRzWyByYW5kb21OdW0gXVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIHJldHVybiBhbGxWaXNpdG9ycztcblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLy8g5YW25LuW5Lq655qE6LSt54mp5riF5Y2VXG4gICAgICAgICAgICBvdGhlcnMkKCApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxpc3QsIG9wZW5pZCB9ID0gdGhpcy5kYXRhO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJMaXN0ID0gbGlzdFxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKCB4ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAheC51c2Vycy5maW5kKCB5ID0+IHkub3BlbmlkID09PSBvcGVuaWQgKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQoKCB4LCB5ICkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHkudXNlcnMubGVuZ3RoIC0geC51c2Vycy5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG90aGVyTGlzdC5tYXAoIHNsID0+IHRoaXMudHJhbnNmZXJTbCggc2wgKSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSByLm1hcCggeCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgcGlkLCBnb29kSW1nLCBidXllciwgdG90YWxEZWx0YSwgbmFtZSwgdGl0bGUgfSA9IHg7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWc6IGdvb2RJbWcsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3BUaXBzOiBgJHtidXllci5sZW5ndGggPiAxID8gYnV5ZXIubGVuZ3RoICsgJ+S6uicgOiAnJ33nnIEke3RvdGFsRGVsdGF95YWDYCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbVRpcHM6IGAke2J1eWVyLmxlbmd0aH3nvqTlj4vmi7zlm6JgLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyczogYnV5ZXIubWFwKCB5ID0+IHkuYXZhdGFyICksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYCR7bmFtZSA/IG5hbWUgOiAnJ30ke3RpdGxlfWBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIOS4quS6uui0reeJqea4heWNlVxuICAgICAgICAgICAgcGVyc29uYWwkKCApIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxpc3QsIG9wZW5pZCB9ID0gdGhpcy5kYXRhO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbFRleHRzID0gW1xuICAgICAgICAgICAgICAgICAgICBg55yf57uZ5YqbYCxcbiAgICAgICAgICAgICAgICAgICAgYOiwouiwouS9oGAsXG4gICAgICAgICAgICAgICAgICAgIGDliJLnrpfvvZ5gLFxuICAgICAgICAgICAgICAgICAgICBg5qOSIWAsXG4gICAgICAgICAgICAgICAgICAgIGDotZ4hYCxcbiAgICAgICAgICAgICAgICAgICAgYOi1miFgXG4gICAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IG15TGlzdCA9IGxpc3RcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlciggeCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geC51c2Vycy5maW5kKCB5ID0+IHkub3BlbmlkID09PSBvcGVuaWQgKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQoKCB4LCB5ICkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHkudXNlcnMubGVuZ3RoIC0geC51c2Vycy5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByID0gbXlMaXN0Lm1hcCggc2wgPT4gdGhpcy50cmFuc2ZlclNsKCBzbCwgYWxsVGV4dHMgKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvLyDmiYDmnInkurrnmoTotK3nianmuIXljZVcbiAgICAgICAgICAgIGFsbCQoICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGlzdCB9ID0gdGhpcy5kYXRhO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbFRleHRzID0gW1xuICAgICAgICAgICAgICAgICAgICBg55yf57uZ5YqbYCxcbiAgICAgICAgICAgICAgICAgICAgYOiwouiwouS9oGAsXG4gICAgICAgICAgICAgICAgICAgIGDliJLnrpfvvZ5gLFxuICAgICAgICAgICAgICAgICAgICBg5qOSIWAsXG4gICAgICAgICAgICAgICAgICAgIGDotZ4hYCxcbiAgICAgICAgICAgICAgICAgICAgYOi1miFgXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gbGlzdC5tYXAoIHNsID0+IHRoaXMudHJhbnNmZXJTbCggc2wsIGFsbFRleHRzICkpO1xuICAgICAgICAgICAgICAgIHJldHVybiByO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLy8g6KGM56iL5riF5Y2V5oC75qaC5Ya1XG4gICAgICAgICAgICBzdW1tYXJ5JCggKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBsaXN0LCBvcGVuaWQgfSA9IHRoaXMuZGF0YTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGFsbFNsID0gbGlzdC5tYXAoIHNsID0+IHRoaXMudHJhbnNmZXJTbCggc2wgKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgbXlTTCA9IGxpc3RcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlciggeCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geC51c2Vycy5maW5kKCB5ID0+IHkub3BlbmlkID09PSBvcGVuaWQgKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCggc2wgPT4gdGhpcy50cmFuc2ZlclNsKCBzbCApKTtcblxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIOaJgOaciee+pOWPi++8jOS4gOWFseecgeS6huWkmuWwkVxuICAgICAgICAgICAgICAgICAgICBncm91cFRvdGFsRGVsdGE6IGFsbFNsLnJlZHVjZSgoIHgsIHkgKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geCArICggeS5idXllci5sZW5ndGggPiAxID8geS50b3RhbERlbHRhIDogMCApO1xuICAgICAgICAgICAgICAgICAgICB9LCAwICksXG4gICAgICAgICAgICAgICAgICAgIC8vIOaIkeS4gOWFseecgeS6huWkmuWwkVxuICAgICAgICAgICAgICAgICAgICBteVRvdGFsRGVsdGE6IG15U0wucmVkdWNlKCggeCwgeSApID0+IHggKyB5LnN1Y2Nlc3NEZWx0YSwgMCApXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8vIOaKteeOsOmHkeeahOWlluWKsemHkeminVxuICAgICAgICAgICAgaG9uZ2JhbyQoICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgbGlzdCwgb3BlbmlkIH0gPSB0aGlzLmRhdGE7XG5cbiAgICAgICAgICAgICAgICAvLyDmiJHnmoTotK3nianmuIXljZVcbiAgICAgICAgICAgICAgICBjb25zdCBteUxpc3QgPSBsaXN0XG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoIHggPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHgudXNlcnMuZmluZCggeSA9PiB5Lm9wZW5pZCA9PT0gb3BlbmlkICk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8g5piv5ZCm5pyJ5Lmw6L+H5Lic6KW/XG4gICAgICAgICAgICAgICAgY29uc3QgaGFzQnV5ID0gbXlMaXN0Lmxlbmd0aCA+IDA7XG5cbiAgICAgICAgICAgICAgICAvLyDlpZblirHph5Hpop1cbiAgICAgICAgICAgICAgICBjb25zdCBnaWZ0ID0gaGFzQnV5ID8gMS4yNCA6IDAuODg7XG5cbiAgICAgICAgICAgICAgICAvLyDmmK/lkKbmnInmi7zlm6LmiJDlip9cbiAgICAgICAgICAgICAgICBjb25zdCBzb21lUGluU3VjY2VzcyA9IG15TGlzdC5zb21lKCB4ID0+IHgudXNlcnMubGVuZ3RoID4gMSApO1xuXG4gICAgICAgICAgICAgICAgLy8g5paH5qGIMVxuICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gaGFzQnV5ICYmIHNvbWVQaW5TdWNjZXNzID9cbiAgICAgICAgICAgICAgICAgICAgJ+aLvOWbouaIkOWKnycgOlxuICAgICAgICAgICAgICAgICAgICBoYXNCdXkgJiYgIXNvbWVQaW5TdWNjZXNzID9cbiAgICAgICAgICAgICAgICAgICAgICAgICflt67ngrnmi7zmiJAnIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICfnvqTmi7zlm6Ig55yB6ZKxISc7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8g5paH5a6JMlxuICAgICAgICAgICAgICAgIGNvbnN0IHN1bW1hcnkgPSBoYXNCdXkgJiYgc29tZVBpblN1Y2Nlc3MgP1xuICAgICAgICAgICAgICAgICAgICAn55yB6ZKx5ZWm77yB6K+35YaN5o6l5YaN5Y6JficgOlxuICAgICAgICAgICAgICAgICAgICBoYXNCdXkgJiYgIXNvbWVQaW5TdWNjZXNzID9cbiAgICAgICAgICAgICAgICAgICAgICAgICfojqvngbDlv4PvvIHlpJrpgoDor7fnvqTlj4vmi7zlm6InIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICfkuIvmrKHot5/nnYDnvqTlj4vmi7wnO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgZ2lmdCxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICAgICAgICAgIHN1bW1hcnlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOebkeWQrHN0b3JlXG4gICAgICovXG4gICAgd2F0Y2hTdG9yZSggKSB7XG4gICAgICAgIGFwcC53YXRjaCQoJ2FwcENvbmZpZycsIHZhbCA9PiB7XG4gICAgICAgICAgICBpZiAoICEhdmFsICkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGl0bGUoYCR7dmFsWydpcC1uYW1lJ10gfHwgJyd9576k5ou85ZuiYClcbiAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICAgICAgICAgICAgaXBOYW1lOiB2YWxbJ2lwLW5hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgaXBBdmF0YXI6IGAke3ZhbFsnaXAtYXZhdGFyJ10gfHwgJyd9YFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBhcHAud2F0Y2gkKCdvcGVuaWQnLCB2YWwgPT4ge1xuICAgICAgICAgICAgISF2YWwgJiYgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgICAgb3BlbmlkOiB2YWxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgICBhcHAud2F0Y2gkKCdpc1VzZXJBdXRoJywgdmFsID0+IHtcbiAgICAgICAgICAgIGlmICggdmFsID09PSB1bmRlZmluZWQgKSB7IHJldHVybjsgfVxuICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgICAgaXNBdXRoOiB2YWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYXBwLndhdGNoJCgncm9sZScsIHZhbCA9PiB7XG4gICAgICAgICAgICBpZiAoIHZhbCA9PT0gMCApIHtcbiAgICAgICAgICAgICAgICB3eC5oaWRlU2hhcmVNZW51KHsgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHd4LnNob3dTaGFyZU1lbnUoe1xuICAgICAgICAgICAgICAgICAgICB3aXRoU2hhcmVUaWNrZXQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKiogXG4gICAgICog5ouJ5Y+W6KGM56iL55qE6LSt54mp6K+35Y2V5L+h5oGvXG4gICAgICovXG4gICAgZmV0Y2hTaG9wcGluZyggdGlkICkge1xuICAgICAgICBpZiAoICF0aWQgKSB7IHJldHVybjsgfVxuXG4gICAgICAgIGh0dHAoe1xuICAgICAgICAgICAgdXJsOiAnc2hvcHBpbmctbGlzdF9waW4nLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHRpZCxcbiAgICAgICAgICAgICAgICBkZXRhaWw6IHRydWUsXG4gICAgICAgICAgICAgICAgc2hvd1VzZXI6IHRydWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgc3RhdHVzLCBkYXRhIH0gPSByZXM7XG4gICAgICAgICAgICAgICAgaWYgKCBzdGF0dXMgIT09IDIwMCApIHsgcmV0dXJuOyB9XG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgICAgICAgIGxpc3Q6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAvLyBzaG93SG9uZ2JhbzogJ3Nob3cnXG4gICAgICAgICAgICAgICAgICAgIHNob3dIb25nYmFvOiAnaGlkZSdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog6aKG5Y+W57qi5YyFXG4gICAgICovXG4gICAgZmV0Y2hHZXRHaWZ0KCApIHtcbiAgICAgICAgY29uc3QgeyB0aWQsIGhhc0dldCB9ID0gdGhpcy5kYXRhO1xuICAgICAgICBjb25zdCBob25nYmFvJCA9ICh0aGlzIGFzIGFueSkuZGF0YS5ob25nYmFvJDtcblxuICAgICAgICBpZiAoIGhhc0dldCApIHtcbiAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICflt7Lpooblj5bov4fllaYnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRvZ2dsZUhvbmdiYW8oICk7XG4gICAgICAgIH1cblxuICAgICAgICBodHRwKHtcbiAgICAgICAgICAgIHVybDogJ2NvbW1vbl9nZXQtaW50ZWdyYWwnLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGludGVncmFsOiBob25nYmFvJC5naWZ0XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbG9hZGluZ01zZzogJ+mihuWPluS4rS4uLicsXG4gICAgICAgICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgc3RhdHVzIH0gPSByZXM7XG4gICAgICAgICAgICAgICAgaWYgKCBzdGF0dXMgIT09IDIwMCApIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+mihuWPluaIkOWKnydcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlSG9uZ2JhbyggKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRyaXBSZXdhcmQoIHRpZCApO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tJc0dldCggdGlkICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKiogXG4gICAgICog6K6+572u5qCH6aKYXG4gICAgICovXG4gICAgc2V0VGl0bGUoIHRpdGxlOiBzdHJpbmcgKSB7XG4gICAgICAgIGlmICggIXRpdGxlICkgeyByZXR1cm47IH1cbiAgICAgICAgd3guc2V0TmF2aWdhdGlvbkJhclRpdGxlKHtcbiAgICAgICAgICAgIHRpdGxlXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDovazmjaLmoLzlvI9cbiAgICAgKi9cbiAgICB0cmFuc2ZlclNsKCBzbCwgYWxsVGV4dHMgPSBbIF0pIHtcblxuICAgICAgICBjb25zdCB7IHBpZCwgYWRqdXN0R3JvdXBQcmljZSwgYWRqdXN0UHJpY2UsIHVzZXJzLCBkZXRhaWwgfSA9IHNsO1xuICAgICAgICBjb25zdCBkZWx0YSA9IGFkanVzdEdyb3VwUHJpY2UgPyBNYXRoLmNlaWwoIGFkanVzdFByaWNlIC0gYWRqdXN0R3JvdXBQcmljZSApIDogMDtcbiAgICAgICAgY29uc3QgdG90YWxEZWx0YSA9IGRlbHRhICogdXNlcnMubGVuZ3RoO1xuXG4gICAgICAgIGNvbnN0IGdldFJhbmRvbSA9IG4gPT4gTWF0aC5mbG9vciggTWF0aC5yYW5kb20oICkgKiBuICk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBpZCxcbiAgICAgICAgICAgIHByaWNlOiBhZGp1c3RQcmljZSxcbiAgICAgICAgICAgIGdyb3VwUHJpY2U6IGFkanVzdEdyb3VwUHJpY2UsXG4gICAgICAgICAgICBmYWRlUHJpY2U6IGRldGFpbC5nb29kLmZhZGVQcmljZSxcbiAgICAgICAgICAgIHRpdGxlOiBkZXRhaWwudGl0bGUsXG4gICAgICAgICAgICBuYW1lOiBkZXRhaWwubmFtZSB8fCAnJyxcbiAgICAgICAgICAgIGdvb2RJbWc6IGRldGFpbC5pbWcsXG4gICAgICAgICAgICAvLyDmgLvlt67lgLxcbiAgICAgICAgICAgIGRlbHRhLCBcbiAgICAgICAgICAgIC8vIOi0reeJqea4heWNleaAu+W3ruWAvFxuICAgICAgICAgICAgdG90YWxEZWx0YSxcbiAgICAgICAgICAgIC8vIOaIkeeahOaIkOWKn+aLvOWbouW3ruWAvFxuICAgICAgICAgICAgc3VjY2Vzc0RlbHRhOiB1c2Vycy5sZW5ndGggPiAxID8gZGVsdGEgOiAwLFxuICAgICAgICAgICAgYnV5ZXI6IHVzZXJzLm1hcCggeCA9PiAoe1xuICAgICAgICAgICAgICAgIG5hbWU6IHgubmlja05hbWUsXG4gICAgICAgICAgICAgICAgYXZhdGFyOiB4LmF2YXRhclVybFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgcGluU3VjY2VzczogdXNlcnMubGVuZ3RoID4gMSxcbiAgICAgICAgICAgIHRpcHM6IGFsbFRleHRzWyBnZXRSYW5kb20oIGFsbFRleHRzLmxlbmd0aCApXSxcbiAgICAgICAgICAgIHRpcHNJbmRleDogZ2V0UmFuZG9tKCB1c2Vycy5sZW5ndGggPiA0ID8gMyA6IHVzZXJzLmxlbmd0aCAtIDEgKSArIDFcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDlvIDlhbPnuqLljIVcbiAgICAgKi9cbiAgICB0b2dnbGVIb25nYmFvKCApIHtcbiAgICAgICAgY29uc3QgeyBzaG93SG9uZ2JhbyB9ID0gdGhpcy5kYXRhO1xuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICAgIHNob3dIb25nYmFvOiBzaG93SG9uZ2JhbyA9PT0gJ3Nob3cnID8gJ2hpZGUnIDogJ3Nob3cnXG4gICAgICAgIH0pXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOi3s+WIsOWVhuWTgeivpuaDhVxuICAgICAqL1xuICAgIGdvR29vZERldGFpbCggZSApIHtcbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldDtcbiAgICAgICAgbmF2VG8oYC9wYWdlcy9nb29kcy1kZXRhaWwvaW5kZXg/aWQ9JHtkYXRhLnBpZH1gKVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDorqLpmIVcbiAgICAgKi9cbiAgICBvblN1YnNjcmliZSggKSB7XG4gICAgICAgIGFwcC5nZXRTdWJzY3JpYmUoJ2J1eVBpbix3YWl0UGluLHRyaXAnKTtcbiAgICAgICAgdGhpcy5mZXRjaEdldEdpZnQoICk7XG4gICAgfSxcblxuICAgIC8qKiBcbiAgICAgKiDojrflj5bnlKjmiLfmjojmnYNcbiAgICAgKi9cbiAgICBnZXRVc2VyQXV0aCggKSB7XG4gICAgICAgIGFwcC5nZXRXeFVzZXJJbmZvKCggKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZldGNoR2V0R2lmdCggKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOiuvue9ruW3sumihuWPlue6ouWMhVxuICAgICAqIOS7heS/neeVmTEw5Liq6KGM56iLaWRcbiAgICAgKi9cbiAgICBzZXRUcmlwUmV3YXJkKCB0aWQgKSB7XG4gICAgICAgIGNvbnN0IHRyaXBTdW0gPSAxMDtcbiAgICAgICAgY29uc3QgaGFzUmV3YXJkTGlzdCA9IEpTT04ucGFyc2UoIHd4LmdldFN0b3JhZ2VTeW5jKCBzdG9yYWdlS2V5ICkgfHwgJ1sgXScpO1xuICAgICAgICBoYXNSZXdhcmRMaXN0LnVuc2hpZnQoIHRpZCApO1xuICAgICAgICB3eC5zZXRTdG9yYWdlU3luYyggc3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoIGhhc1Jld2FyZExpc3Quc2xpY2UoIDAsIHRyaXBTdW0gKSkpXG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOajgOafpeivpei2n+ihjOeoi+mHjOmdolxuICAgICAqIOaYr+WQpuW3sue7j+mihuWPlui/h+e6ouWMhVxuICAgICAqL1xuICAgIGNoZWNrSXNHZXQoIHRpZCApIHtcbiAgICAgICAgY29uc3QgaGFzUmV3YXJkTGlzdCA9IEpTT04ucGFyc2UoIHd4LmdldFN0b3JhZ2VTeW5jKCBzdG9yYWdlS2V5ICkgfHwgJ1sgXScpO1xuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICAgIGhhc0dldDogaGFzUmV3YXJkTGlzdC5pbmNsdWRlcyggdGlkIClcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHN3aXBlcuebkeWQrFxuICAgICAqL1xuICAgIG9uU3dpcGVyKCBlOiBhbnkgKSB7XG4gICAgICAgIGNvbnN0IHsgY3VycmVudCB9ID0gZS5kZXRhaWw7XG4gICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgICAgc3dpcGVySW5kZXg6IGN1cnJlbnRcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIOmhtemdoua7muWKqFxuICAgICAqL1xuICAgIG9uU2Nyb2xsKCBlOiBhbnkgKSB7XG4gICAgICAgIGNvbnN0IHsgc2hvd0Rhbm11IH0gPSB0aGlzLmRhdGE7XG4gICAgICAgIGNvbnN0IHsgc2Nyb2xsVG9wIH0gPSBlLmRldGFpbDtcbiAgICAgICAgaWYgKCAhIXNob3dEYW5tdSApIHsgcmV0dXJuOyB9IFxuXG4gICAgICAgIGlmICggc2Nyb2xsVG9wID4gMTAwICkge1xuICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICAgICAgc2hvd0Rhbm11OiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiB0aWQg6KGM56iLaWRcbiAgICAgKi9cbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICggcXVlcnk6IGFueSApIHtcbiAgICAgICAgY29uc3QgdGlkID0gcXVlcnkudGlkIHx8IFwiZThmODYzYmE1ZGU2MjQxNDAwMDc2OTIxNDQxYmM4ZDVcIjtcbiAgICAgICAgdGhpcy53YXRjaFN0b3JlKCApO1xuICAgICAgICB0aGlzLnJ1bkNvbXB1dGVkKCApO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICB0aWRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5jaGVja0lzR2V0KCB0aWQgKTtcbiAgICAgICAgdGhpcy5mZXRjaFNob3BwaW5nKCB0aWQgKTtcblxuICAgIH0sXG4gIFxuICAgIC8qKlxuICAgICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yid5qyh5riy5p+T5a6M5oiQXG4gICAgICovXG4gICAgb25SZWFkeTogZnVuY3Rpb24gKCApIHtcblxuICAgIH0sXG4gIFxuICAgIC8qKlxuICAgICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5pi+56S6XG4gICAgICovXG4gICAgb25TaG93OiBmdW5jdGlvbiAoICkge1xuXG4gICAgfSxcbiAgXG4gICAgLyoqXG4gICAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cbiAgICAgKi9cbiAgICBvbkhpZGU6IGZ1bmN0aW9uICgpIHtcbiAgXG4gICAgfSxcbiAgXG4gICAgLyoqXG4gICAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLljbjovb1cbiAgICAgKi9cbiAgICBvblVubG9hZDogZnVuY3Rpb24gKCkge1xuICBcbiAgICB9LFxuICBcbiAgICAvKipcbiAgICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxuICAgICAqL1xuICAgIG9uUHVsbERvd25SZWZyZXNoOiBmdW5jdGlvbiAoKSB7XG4gIFxuICAgIH0sXG4gIFxuICAgIC8qKlxuICAgICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxuICAgICAqL1xuICAgIG9uUmVhY2hCb3R0b206IGZ1bmN0aW9uICgpIHtcbiAgXG4gICAgfSxcbiAgXG4gICAgLyoqXG4gICAgICog55So5oi354K55Ye75Y+z5LiK6KeS5YiG5LqrXG4gICAgICovXG4gICAgb25TaGFyZUFwcE1lc3NhZ2U6IGZ1bmN0aW9uICggZSApIHtcbiAgICAgICAgY29uc3QgeyBpcE5hbWUsIHRpZCwgaXNBZG0gfSA9IHRoaXMuZGF0YTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRpdGxlOiBgJHtpcE5hbWUgfHwgJ+e+pOaLvOWboid95Zue5oql5aSn5a625ZWmIOeCueWHu+mihuWPluaKteeOsOmHkWAsXG4gICAgICAgICAgICBpbWFnZVVybDogJ2h0dHBzOi8vZ2xvYmFsLTEyNTc3NjQ1NjcuY29zLmFwLWd1YW5nemhvdS5teXFjbG91ZC5jb20vYmctdHJpcC1yZXdhcmQtc2hhcmUtY29sb3JmdWwuanBnJyxcbiAgICAgICAgICAgIHBhdGg6IGAvcGFnZXMvdHJpcC1yZXdhcmQvaW5kZXg/dGlkPSR7dGlkfWBcbiAgICAgICAgfTtcbiAgICB9XG4gIH0pIl19