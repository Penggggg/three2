<!--components/active-form/index.wxml-->
<view class='c-active-form'>

  <form>
  
    <view
      wx:for="{{ meta }}"
      wx:key="{{ index }}"
    >

      <!-- 标题类型 -->
      <view
        class="caf-title"
        wx:if="{{ item.title }}"
      >
        <text class='caf-title-big'>{{ item.title }}</text>
        <text class='caf-title-desc'>{{ item.desc }}</text>
      </view>

      <!-- 文本输入类型 -->
      <view
        class='caf-inputs caf-item'
        wx:elif="{{ item.type === 'input' }}"
      >
        <text class='caf-item-label'>{{ item.label }}</text>
        <input
          class='caf-item-input'
          data-key="{{ item.key }}"
          value="{{ formData[ item.key ]}}"
          maxlength='{{ item.max || 99999 }}'
          placeholder="{{ item.placeholder || '' }}"
          bindinput='textInput'
        />
      </view>

      <!-- 多行文本 -->
      <view
        class='caf-inputs caf-item'
        wx:elif="{{ item.type === 'textarea' }}"
      >
        <text class='caf-item-label'>{{ item.label }}</text>
        <textarea
          auto-height
          class='caf-item-input'
          data-key="{{ item.key }}"
          value="{{ formData[ item.key ]}}"
          placeholder="{{ item.placeholder || '' }}"
          bindinput='textInput'
        />
      </view>

      <!-- 标签 -->
      <view
        class='caf-inputs caf-item'
        wx:elif="{{ item.type === 'tag' }}"
      >
        <text class='caf-item-label'>{{ item.label }}</text>
        <view class='caf-item-input'>
          <view
            wx:for="{{ formData[ item.key ]}}"
            wx:for-item="label"
            wx:for-index="k"
            wx:key="{{ k }}"
            data-tagkey="{{ item.key }}"
            data-tagindex="{{ k }}"
            class='label inline'
            bindtap='toogleTag'
          >
            <wxc-label
              text="{{ label }}"
            />
          </view>
          <view
            class='label inline'
            data-tagkey="{{ item.key }}"
            bindtap='toogleTag'
          >
            <wxc-label
              text="点我添加+"
              class='label'
              wx:if="{{ formData[ item.key ].length < item.max }}"
            />
          </view>
        </view>
      </view>

      <!-- select -->
      <view
        class='caf-inputs caf-item'
        wx:elif="{{ item.type === 'select' }}"
      >
        <picker
          class='picker'
          range-key="label"
          range="{{ item.options }}"
          bindchange="selectChange"
          data-formkey="{{ item.key }}"
          value='{{ selectFormItemIndex[ item.key ] }}'
        >
          <view class="picker">
            <text class='caf-item-label'>{{ item.label }}</text>
            <text class='caf-item-input'>{{ item.options[ selectFormItemIndex[ item.key ]].label }}</text>
          </view>
        </picker>
      </view>

      <!-- 图片上传 -->
      <view 
        class='caf-img-block'
        wx:elif="{{ item.type === 'img' }}"
      > 
        <my-img-upload
          data-key="{{ item.key }}"
          max="{{ item.max || 9 }}"
          hasBeenUploaded="{{ item.value }}"
          bindchange="onImgChange"
        />
      </view>

      <!-- 数字类 -->
      <view
        class='caf-inputs caf-item'
        wx:elif="{{ item.type === 'number' }}"
      >
        <text class='caf-item-label'>{{ item.label }}</text>
        <input
          type="digit"
          class='caf-item-input'
          data-key="{{ item.key }}"
          value="{{ formData[ item.key ]}}"
          placeholder="{{ item.placeholder || '' }}"
        />
      </view>

    </view>

  </form>

  <!-- 增加标签 -->
  <i-modal
    title="{{ selectingTagIndex !== null ? '编辑标签' : '新的标签' }} "
    visible="{{ tagging }}"
    bind:cancel="toogleTag"
    bind:ok="editOrCreateTag"
  >
    <wxc-input
      mode="none"
      type="text"
      value="{{ selecingTag }}"
      bind:input="editingTag"
      placeholder="请输入新的标签名"
    />
  </i-modal>

</view>
